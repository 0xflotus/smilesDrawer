(function g(d,e,t){function a(i,r){if(!e[i]){if(!d[i]){var o="function"==typeof require&&require;if(!r&&o)return o(i,!0);if(n)return n(i,!0);var s=new Error("Cannot find module '"+i+"'");throw s.code="MODULE_NOT_FOUND",s}var h=e[i]={exports:{}};d[i][0].call(h.exports,function(t){var e=d[i][1][t];return a(e?e:t)},h,h.exports,g,d,e,t)}return e[i].exports}for(var n="function"==typeof require&&require,i=0;i<t.length;i++)a(t[i]);return a})({1:[function(e){"use strict";function t(e){return e&&e.__esModule?e:{default:e}}var n=Math.min,i=e("./src/Drawer"),a=t(i),r=e("./src/Parser"),o=t(r);window.SmilesDrawer={Version:"1.0.0"},window.SmilesDrawer.Drawer=a.default,window.SmilesDrawer.Parser=o.default,window.SmilesDrawer.clean=function(e){return e.replace(/[^A-Za-z0-9@\.\+\-\?!\(\)\[\]\{\}/\\=#\$:\*]/g,"")},window.SmilesDrawer.apply=function(e){for(var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"canvas[data-smiles]",n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:"light",r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null,o=new a.default(e),l=document.querySelectorAll(t),s=function(){var e=l[g];SmilesDrawer.parse(e.getAttribute("data-smiles"),function(t){o.draw(t,e,n,!1)},function(e){r&&r(e)})},g=0;g<l.length;g++)s()},window.SmilesDrawer.parse=function(e,t,n){try{t&&t(o.default.parse(e))}catch(e){n&&n(e)}},Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{value:function(e){var t=Math.max;if(null==this)throw new TypeError("this is null or not defined");for(var i=Object(this),a=i.length>>>0,r=arguments[1],o=r>>0,l=0>o?t(a+o,0):n(o,a),s=arguments[2],g=void 0===s?a:s>>0,d=0>g?t(a+g,0):n(g,a);l<d;)i[l]=e,l++;return i}})},{"./src/Drawer":5,"./src/Parser":10}],2:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(){function e(e,t){for(var n=0,i;n<t.length;n++)i=t[n],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(){i(this,e)}return r(e,null,[{key:"clone",value:function(t){var n=Array.isArray(t)?[]:{};for(var i in t){var r=t[i];n[i]="function"==typeof r.clone?r.clone():"object"===("undefined"==typeof r?"undefined":a(r))?e.clone(r):r}return n}},{key:"print",value:function(e){if(0==e.length)return"";for(var t="(",n=0;n<e.length;n++)t+=e[n].id?e[n].id+", ":e[n]+", ";return t=t.substring(0,t.length-2),t+")"}},{key:"each",value:function(e,t){for(var n=0;n<e.length;n++)t(e[n])}},{key:"get",value:function(e,t,n){for(var a=0;a<e.length;a++)if(e[a][t]==n)return e[a]}},{key:"contains",value:function(e,t){if(!t.property&&!t.func){for(var n=0;n<e.length;n++)if(e[n]==t.value)return!0;}else if(t.func){for(var i=0;i<e.length;i++)if(t.func(e[i]))return!0;}else for(var a=0;a<e.length;a++)if(e[a][t.property]==t.value)return!0;return!1}},{key:"intersection",value:function(e,t){for(var n=[],a=0;a<e.length;a++)for(var i=0;i<t.length;i++)e[a]===t[i]&&n.push(e[a]);return n}},{key:"unique",value:function(e){var t={};return e.filter(function(e){return void 0===t[e]&&(t[e]=!0)})}},{key:"count",value:function(e,t){for(var n=0,a=0;a<e.length;a++)e[a]===t&&n++;return n}},{key:"toggle",value:function(e,t){for(var n=[],a=!1,r=0;r<e.length;r++)e[r]===t?a=!0:n.push(e[r]);return a||n.push(t),n}},{key:"remove",value:function(e,t){for(var n=[],a=0;a<e.length;a++)e[a]!==t&&n.push(e[a]);return n}},{key:"removeUnique",value:function(e,t){var n=e.indexOf(t);return-1<n&&e.splice(n,1),e}},{key:"removeAll",value:function(e,t){return e.filter(function(e){return-1===t.indexOf(e)})}},{key:"merge",value:function(e,t){for(var n=Array(e.length+t.length),a=0;a<e.length;a++)n[a]=e[a];for(var i=0;i<t.length;i++)n[e.length+i]=t[i];return n}},{key:"containsAll",value:function(e,t){for(var n=0,a=0;a<e.length;a++)for(var i=0;i<t.length;i++)e[a]===t[i]&&n++;return n===t.length}},{key:"sortByAtomicNumberDesc",value:function(t){var e=t.map(function(t,e){return{index:e,value:t.atomicNumber.split(".").map(Number)}});return e.sort(function(e,t){for(var n=Math.min(t.value.length,e.value.length),a=0;a<n&&t.value[a]===e.value[a];)a++;return a===n?t.value.length-e.value.length:t.value[a]-e.value[a]}),e.map(function(n){return t[n.index]})}},{key:"deepCopy",value:function(t){for(var n=[],a=0,i;a<t.length;a++)i=t[a],n[a]=i instanceof Array?e.deepCopy(i):i;return n}}]),e}();n.default=o},{}],3:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0,i;n<t.length;n++)i=t[n],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=e("./ArrayHelper"),l=i(o),s=e("./Vertex"),g=i(s),d=e("./Ring"),u=i(d),h=function(){function e(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"-";a(this,e),this.element=1===t.length?t.toUpperCase():t,this.drawExplicit=!1,this.ringbonds=[],this.rings=[],this.bondType=n,this.branchBond=null,this.isBridge=!1,this.isBridgeNode=!1,this.originalRings=[],this.bridgedRing=null,this.anchoredRings=[],this.bracket=null,this.plane=0,this.order={},this.attachedPseudoElements={},this.hasAttachedPseudoElements=!1,this.isDrawn=!0,this.isConnectedToRing=!1,this.neighbouringElements=[],this.isPartOfAromaticRing=t!==this.element,this.bondCount=0}return r(e,[{key:"addNeighbouringElement",value:function(e){this.neighbouringElements.push(e)}},{key:"attachPseudoElement",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=n+e;this.attachedPseudoElements[i]?this.attachedPseudoElements[i].count+=1:this.attachedPseudoElements[i]={element:e,count:1,hydrogenCount:n,previousElement:t},this.hasAttachedPseudoElements=!0}},{key:"getAttachedPseudoElements",value:function(){var e={},t=this;return Object.keys(this.attachedPseudoElements).sort().forEach(function(n){e[n]=t.attachedPseudoElements[n]}),e}},{key:"getAttachedPseudoElementsCount",value:function(){return Object.keys(this.attachedPseudoElements).length}},{key:"addAnchoredRing",value:function(e){l.default.contains(this.anchoredRings,{value:e})||this.anchoredRings.push(e)}},{key:"getRingbondCount",value:function(){return this.ringbonds.length}},{key:"backupRings",value:function(){this.originalRings=Array(this.rings.length);for(var e=0;e<this.rings.length;e++)this.originalRings[e]=this.rings[e]}},{key:"restoreRings",value:function(){this.rings=Array(this.originalRings.length);for(var e=0;e<this.originalRings.length;e++)this.rings[e]=this.originalRings[e]}},{key:"haveCommonRingbond",value:function(e,t){for(var n=0;n<e.ringbonds.length;n++)for(var i=0;i<t.ringbonds.length;i++)if(e.ringbonds[n].id==t.ringbonds[i].id)return!0;return!1}},{key:"getOrder",value:function(e){return this.order[e]}},{key:"setOrder",value:function(e,t){this.order[e]=t}},{key:"neighbouringElementsEqual",value:function(e){if(e.length!==this.neighbouringElements.length)return!1;e.sort(),this.neighbouringElements.sort();for(var t=0;t<this.neighbouringElements.length;t++)if(e[t]!==this.neighbouringElements[t])return!1;return!0}},{key:"getAtomicNumber",value:function(){return e.atomicNumbers[this.element]}}],[{key:"sortByAtomicNumber",value:function(t,n){for(var a=Array(t.length),r=0;r<t.length;r++){var i=n[t[r]],o=e.atomicNumbers[i.value.element];a[r]={atomicNumber:o.toString(),vertexId:i.id}}return l.default.sortByAtomicNumberDesc(a)}},{key:"hasDuplicateAtomicNumbers",value:function(e){for(var t={},n=0,i;n<e.length;n++){if(i=e[n],void 0!==t[i.atomicNumber])return!0;t[i.atomicNumber]=!0}return!1}},{key:"getDuplicateAtomicNumbers",value:function(e){for(var t={},n=[],a=0,i;a<e.length;a++)i=e[a],void 0===t[i.atomicNumber]&&(t[i.atomicNumber]=[]),t[i.atomicNumber].push(a);for(var r in t){var o=t[r];1<o.length&&n.push(o)}return n}},{key:"maxBonds",get:function(){return{C:4,N:3,O:2,P:3,S:2,B:3,F:1,I:1,Cl:1,Br:1}}},{key:"atomicNumbers",get:function(){return{H:1,He:2,Li:3,Be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,Ne:10,Na:11,Mg:12,Al:13,Si:14,P:15,p:15,S:16,s:16,Cl:17,Ar:18,K:19,Ca:20,Sc:21,Ti:22,V:23,Cr:24,Mn:25,Fe:26,Co:27,Ni:28,Cu:29,Zn:30,Ga:31,Ge:32,As:33,Se:34,Br:35,Kr:36,Rb:37,Sr:38,Y:39,Zr:40,Nb:41,Mo:42,Tc:43,Ru:44,Rh:45,Pd:46,Ag:47,Cd:48,In:49,Sn:50,Sb:51,Te:52,I:53,Xe:54,Cs:55,Ba:56,La:57,Ce:58,Pr:59,Nd:60,Pm:61,Sm:62,Eu:63,Gd:64,Tb:65,Dy:66,Ho:67,Er:68,Tm:69,Yb:70,Lu:71,Hf:72,Ta:73,W:74,Re:75,Os:76,Ir:77,Pt:78,Au:79,Hg:80,Tl:81,Pb:82,Bi:83,Po:84,At:85,Rn:86,Fr:87,Ra:88,Ac:89,Th:90,Pa:91,U:92,Np:93,Pu:94,Am:95,Cm:96,Bk:97,Cf:98,Es:99,Fm:100,Md:101,No:102,Lr:103,Rf:104,Db:105,Sg:106,Bh:107,Hs:108,Mt:109,Ds:110,Rg:111,Cn:112,Uut:113,Uuq:114,Uup:115,Uuh:116,Uus:117,Uuo:118}}},{key:"mass",get:function(){return{H:1,He:2,Li:3,Be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,Ne:10,Na:11,Mg:12,Al:13,Si:14,P:15,p:15,S:16,s:16,Cl:17,Ar:18,K:19,Ca:20,Sc:21,Ti:22,V:23,Cr:24,Mn:25,Fe:26,Co:27,Ni:28,Cu:29,Zn:30,Ga:31,Ge:32,As:33,Se:34,Br:35,Kr:36,Rb:37,Sr:38,Y:39,Zr:40,Nb:41,Mo:42,Tc:43,Ru:44,Rh:45,Pd:46,Ag:47,Cd:48,In:49,Sn:50,Sb:51,Te:52,I:53,Xe:54,Cs:55,Ba:56,La:57,Ce:58,Pr:59,Nd:60,Pm:61,Sm:62,Eu:63,Gd:64,Tb:65,Dy:66,Ho:67,Er:68,Tm:69,Yb:70,Lu:71,Hf:72,Ta:73,W:74,Re:75,Os:76,Ir:77,Pt:78,Au:79,Hg:80,Tl:81,Pb:82,Bi:83,Po:84,At:85,Rn:86,Fr:87,Ra:88,Ac:89,Th:90,Pa:91,U:92,Np:93,Pu:94,Am:95,Cm:96,Bk:97,Cf:98,Es:99,Fm:100,Md:101,No:102,Lr:103,Rf:104,Db:105,Sg:106,Bh:107,Hs:108,Mt:109,Ds:110,Rg:111,Cn:112,Uut:113,Uuq:114,Uup:115,Uuh:116,Uus:117,Uuo:118}}}]),e}();n.default=h},{"./ArrayHelper":2,"./Ring":11,"./Vertex":15}],4:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=Number.MAX_VALUE;Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0,i;n<t.length;n++)i=t[n],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),l=e("./MathHelper"),s=i(l),g=e("./Vector2"),d=i(g),u=e("./Line"),h=i(u),c=e("./Vertex"),p=i(c),v=e("./Ring"),f=i(v),y=function(){function e(t,n,i){a(this,e),this.canvas="string"==typeof t||t instanceof String?document.getElementById(t):t,this.ctx=this.canvas.getContext("2d"),this.colors=n,this.opts=i,this.drawingWidth=0,this.drawingHeight=0,this.offsetX=0,this.offsetY=0,this.fontLarge=this.opts.fontSizeLarge+"pt Helvetica, Arial, sans-serif",this.fontSmall=this.opts.fontSizeSmall+"pt Helvetica, Arial, sans-serif",this.updateSize(this.opts.width,this.opts.height),this.ctx.font=this.fontLarge,this.hydrogenWidth=this.ctx.measureText("H").width,this.halfHydrogenWidth=this.hydrogenWidth/2}return o(e,[{key:"updateSize",value:function(e,t){this.devicePixelRatio=window.devicePixelRatio||1,this.backingStoreRatio=this.ctx.webkitBackingStorePixelRatio||this.ctx.mozBackingStorePixelRatio||this.ctx.msBackingStorePixelRatio||this.ctx.oBackingStorePixelRatio||this.ctx.backingStorePixelRatio||1,this.ratio=this.devicePixelRatio/this.backingStoreRatio,1===this.ratio?(this.canvas.width=e*this.ratio,this.canvas.height=t*this.ratio):(this.canvas.width=e*this.ratio,this.canvas.height=t*this.ratio,this.canvas.style.width=e+"px",this.canvas.style.height=t+"px",this.ctx.setTransform(this.ratio,0,0,this.ratio,0,0))}},{key:"setTheme",value:function(e){this.colors=e}},{key:"scale",value:function(e){for(var t=-r,n=-r,a=r,o=r,l=0,i;l<e.length;l++)i=e[l].position,t<i.x&&(t=i.x),n<i.y&&(n=i.y),a>i.x&&(a=i.x),o>i.y&&(o=i.y);var s=20;t+=s,n+=s,a-=s,o-=s,this.drawingWidth=t-a,this.drawingHeight=n-o;var g=this.canvas.offsetWidth/this.drawingWidth,d=this.canvas.offsetHeight/this.drawingHeight,u=g<d?g:d;this.ctx.scale(u,u),this.offsetX=-a,this.offsetY=-o,g<d?this.offsetY+=this.canvas.offsetHeight/(2*u)-this.drawingHeight/2:this.offsetX+=this.canvas.offsetWidth/(2*u)-this.drawingWidth/2}},{key:"reset",value:function(){this.ctx.setTransform(1,0,0,1,0,0)}},{key:"getColor",value:function(e){return e=e.toUpperCase(),e in this.colors?this.colors[e]:this.colors.C}},{key:"drawCircle",value:function(e,t,n,i){var a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:!0,r=5<arguments.length&&void 0!==arguments[5]&&arguments[5],o=6<arguments.length&&void 0!==arguments[6]?arguments[6]:"",l=this.ctx,g=this.offsetX,d=this.offsetY;l.save(),l.lineWidth=1.5,l.beginPath(),l.arc(e+g,t+d,n,0,s.default.twoPI,!0),l.closePath(),r?(a?(l.fillStyle="#f00",l.fill()):(l.strokeStyle="#f00",l.stroke()),this.drawDebugText(e,t,o)):a?(l.fillStyle=i,l.fill()):(l.strokeStyle=i,l.stroke()),l.restore()}},{key:"drawLine",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,i=this.ctx,a=this.offsetX,o=this.offsetY,s=e.clone().shorten(4),g=s.getLeftVector().clone(),l=s.getRightVector().clone();g.x+=a,g.y+=o,l.x+=a,l.y+=o,t||(i.save(),i.globalCompositeOperation="destination-out",i.beginPath(),i.moveTo(g.x,g.y),i.lineTo(l.x,l.y),i.lineCap="round",i.lineWidth=2.5*this.opts.bondThickness,i.strokeStyle=this.getColor("BACKGROUND"),i.stroke(),i.globalCompositeOperation="source-over",i.restore()),g=e.getLeftVector().clone(),l=e.getRightVector().clone(),g.x+=a,g.y+=o,l.x+=a,l.y+=o,i.save(),i.beginPath(),i.moveTo(g.x,g.y),i.lineTo(l.x,l.y),i.lineCap="round",i.lineWidth=this.opts.bondThickness;var r=this.ctx.createLinearGradient(g.x,g.y,l.x,l.y);r.addColorStop(0.4,this.getColor(e.getLeftElement())||this.getColor("C")),r.addColorStop(0.6,this.getColor(e.getRightElement())||this.getColor("C")),t&&(i.setLineDash([1,1]),i.lineWidth=this.opts.bondThickness),1>n&&(i.globalAlpha=n),i.strokeStyle=r,i.stroke(),i.restore()}},{key:"drawWedge",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:3;if(!(isNaN(e.from.x)||isNaN(e.from.y)||isNaN(e.to.x)||isNaN(e.to.y))){var i=this.ctx,a=this.offsetX,o=this.offsetY,s=e.clone().shorten(5),g=s.getLeftVector().clone(),l=s.getRightVector().clone();g.x+=a,g.y+=o,l.x+=a,l.y+=o,g=e.getLeftVector().clone(),l=e.getRightVector().clone(),g.x+=a,g.y+=o,l.x+=a,l.y+=o,i.save();var r=d.default.normals(g,l);r[0].normalize(),r[1].normalize();var h=e.getRightChiral(),c=g,p=l;h&&(c=l,p=g);var f=d.default.add(c,d.default.multiplyScalar(r[0],0.75)),t=d.default.add(p,d.default.multiplyScalar(r[0],n)),u=d.default.add(p,d.default.multiplyScalar(r[1],n)),v=d.default.add(c,d.default.multiplyScalar(r[1],0.75));i.beginPath(),i.moveTo(f.x,f.y),i.lineTo(t.x,t.y),i.lineTo(u.x,u.y),i.lineTo(v.x,v.y);var y=this.ctx.createRadialGradient(l.x,l.y,this.opts.bondLength,l.x,l.y,0);y.addColorStop(0.4,this.getColor(e.getLeftElement())||this.getColor("C")),y.addColorStop(0.6,this.getColor(e.getRightElement())||this.getColor("C")),i.fillStyle=y,i.fill(),i.restore()}}},{key:"drawDashedWedge",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:6;if(!(isNaN(e.from.x)||isNaN(e.from.y)||isNaN(e.to.x)||isNaN(e.to.y))){var i=this.ctx,a=this.offsetX,o=this.offsetY,s=e.getLeftVector().clone(),l=e.getRightVector().clone();s.x+=a,s.y+=o,l.x+=a,l.y+=o,i.save();var r=d.default.normals(s,l);r[0].normalize(),r[1].normalize();var g=e.getRightChiral(),h=e.clone(),c,p,f,y;g?(c=l,p=s,h.shortenRight(3),f=h.getRightVector().clone(),y=h.getLeftVector().clone()):(c=s,p=l,h.shortenLeft(3),f=h.getLeftVector().clone(),y=h.getRightVector().clone()),f.x+=a,f.y+=o,y.x+=a,y.y+=o;var m=d.default.add(c,d.default.multiplyScalar(r[0],0.75)),t=d.default.add(p,d.default.multiplyScalar(r[0],n/2)),u=d.default.add(p,d.default.multiplyScalar(r[1],n/2)),v=d.default.add(c,d.default.multiplyScalar(r[1],0.75));i.beginPath(),i.moveTo(m.x,m.y),i.lineTo(t.x,t.y),i.lineTo(u.x,u.y),i.lineTo(v.x,v.y);var b=this.ctx.createRadialGradient(l.x,l.y,this.opts.bondLength,l.x,l.y,0);b.addColorStop(0.4,this.getColor(e.getLeftElement())||this.getColor("C")),b.addColorStop(0.6,this.getColor(e.getRightElement())||this.getColor("C")),i.fillStyle=b,i.fill(),i.globalCompositeOperation="destination-out",i.beginPath(),i.moveTo(f.x,f.y),i.lineTo(y.x,y.y),i.lineCap="butt",i.lineWidth=n,i.setLineDash([1,1]),i.strokeStyle=this.getColor("BACKGROUND"),i.stroke(),i.globalCompositeOperation="source-over",i.restore()}}},{key:"drawDebugText",value:function(e,t,n){var i=this.ctx;i.save(),i.font="5px Droid Sans, sans-serif",i.textAlign="start",i.textBaseline="top",i.fillStyle="#ff0000",i.fillText(n,e+this.offsetX,t+this.offsetY),i.restore()}},{key:"drawBall",value:function(e,t,n){var i=this.ctx;i.save(),i.beginPath(),i.arc(e+this.offsetX,t+this.offsetY,this.opts.bondLength/4.5,0,s.default.twoPI,!1),i.fillStyle=this.getColor(n),i.fill(),i.restore()}},{key:"drawPoint",value:function(e,t,n){var i=this.ctx,a=this.offsetX,r=this.offsetY;i.save(),i.globalCompositeOperation="destination-out",i.beginPath(),i.arc(e+a,t+r,1.5,0,s.default.twoPI,!0),i.closePath(),i.fill(),i.globalCompositeOperation="source-over",i.beginPath(),i.arc(e+this.offsetX,t+this.offsetY,0.75,0,s.default.twoPI,!1),i.fillStyle=this.getColor(n),i.fill(),i.restore()}},{key:"drawText",value:function(e,t,n,i,a,o,l,g){var d=8<arguments.length&&void 0!==arguments[8]?arguments[8]:{},u=this.ctx,h=this.offsetX,c=this.offsetY;u.save(),u.textAlign="start",u.textBaseline="alphabetic";var p="+",v=0;l&&(2===l?p="2+":-1===l?p="-":-2===l&&(p="2-"),u.font=this.fontSmall,v=u.measureText(p).width);var f="0",y=0;0<g&&(f=g.toString(),u.font=this.fontSmall,y=u.measureText(f).width),u.font=this.fontLarge,u.fillStyle=this.getColor("BACKGROUND");var m=u.measureText(n);m.totalWidth=m.width+v,m.height=parseInt(this.fontLarge,10);var b=m.width>this.opts.fontSizeLarge?m.width:this.opts.fontSizeLarge;b/=1.25,u.globalCompositeOperation="destination-out",u.beginPath(),u.arc(e+h,t+c,b,0,s.default.twoPI,!0),u.closePath(),u.fill(),u.globalCompositeOperation="source-over";var r=-m.width/2,x=-m.width/2;u.fillStyle=this.getColor(n),u.fillText(n,e+h+r,t+this.opts.halfFontSizeLarge+c),r+=m.width,l&&(u.font=this.fontSmall,u.fillText(p,e+h+r,t-this.opts.fifthFontSizeSmall+c),r+=v),0<g&&(u.font=this.fontSmall,u.fillText(f,e+h+x-y,t-this.opts.fifthFontSizeSmall+c),x-=y),u.font=this.fontLarge;var k=0,S=0;if(1===i){var C=e+h,R=t+c+this.opts.halfFontSizeLarge;k=this.hydrogenWidth,x-=k,"left"===a?C+=x:"right"===a?C+=r:"up"===a&&o?C+=r:"down"===a&&o?C+=r:"up"!==a||o?"down"===a&&!o&&(R+=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,C-=this.halfHydrogenWidth):(R-=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,C-=this.halfHydrogenWidth),u.fillText("H",C,R),r+=k}else if(1<i){var A=e+h,P=t+c+this.opts.halfFontSizeLarge;k=this.hydrogenWidth,u.font=this.fontSmall,S=u.measureText(i).width,x-=k+S,"left"===a?A+=x:"right"===a?A+=r:"up"===a&&o?A+=r:"down"===a&&o?A+=r:"up"!==a||o?"down"===a&&!o&&(P+=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,A-=this.halfHydrogenWidth):(P-=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,A-=this.halfHydrogenWidth),u.font=this.fontLarge,u.fillText("H",A,P),u.font=this.fontSmall,u.fillText(i,A+this.halfHydrogenWidth+S,P+this.opts.fifthFontSizeSmall),r+=k+this.halfHydrogenWidth+S}for(var T in d)if(d.hasOwnProperty(T)){var j=0,I=0,w=d[T].element,L=d[T].count,B=d[T].hydrogenCount;u.font=this.fontLarge,1<L&&0<B&&(j=u.measureText("(").width,I=u.measureText(")").width);var N=u.measureText(w).width,E=0;k=0,0<B&&(k=this.hydrogenWidth),u.font=this.fontSmall,1<L&&(E=u.measureText(L).width),S=0,1<B&&(S=u.measureText(B).width),u.font=this.fontLarge;var _=e+h,O=t+c+this.opts.halfFontSizeLarge;u.fillStyle=this.getColor(w),0<L&&(x-=E),1<L&&0<B&&("left"===a?(x-=I,u.fillText(")",_+x,O)):(u.fillText("(",_+r,O),r+=j)),"left"===a?(x-=N,u.fillText(w,_+x,O)):(u.fillText(w,_+r,O),r+=N),0<B&&("left"===a?(x-=k+S,u.fillText("H",_+x,O),1<B&&(u.font=this.fontSmall,u.fillText(B,_+x+k,O+this.opts.fifthFontSizeSmall))):(u.fillText("H",_+r,O),r+=k,1<B&&(u.font=this.fontSmall,u.fillText(B,_+r,O+this.opts.fifthFontSizeSmall),r+=S))),u.font=this.fontLarge,1<L&&0<B&&("left"===a?(x-=j,u.fillText("(",_+x,O)):(u.fillText(")",_+r,O),r+=I)),u.font=this.fontSmall,1<L&&("left"===a?u.fillText(L,_+x+j+I+k+S+N,O+this.opts.fifthFontSizeSmall):(u.fillText(L,_+r,O+this.opts.fifthFontSizeSmall),r+=E))}u.restore()}},{key:"drawDebugPoint",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"#f00";this.drawCircle(e,t,2,i,!0,!0,n)}},{key:"drawAromaticityRing",value:function(e){var t=this.ctx,n=s.default.apothemFromSideLength(this.opts.bondLength,e.getSize());t.save(),t.strokeStyle=this.getColor("C"),t.lineWidth=this.opts.bondThickness,t.beginPath(),t.arc(e.center.x+this.offsetX,e.center.y+this.offsetY,n-this.opts.bondSpacing,0,2*Math.PI,!0),t.closePath(),t.stroke(),t.restore()}},{key:"clear",value:function(){this.ctx.clearRect(0,0,this.canvas.offsetWidth,this.canvas.offsetHeight)}}]),e}();n.default=y},{"./Line":8,"./MathHelper":9,"./Ring":11,"./Vector2":14,"./Vertex":15}],5:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=Math.PI;Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0,i;n<t.length;n++)i=t[n],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=e("./MathHelper"),g=i(s),d=e("./ArrayHelper"),u=i(d),h=e("./Vector2"),c=i(h),p=e("./Line"),v=i(p),f=e("./Vertex"),y=i(f),m=e("./Edge"),b=i(m),x=e("./Atom"),k=i(x),S=e("./Ring"),C=i(S),R=e("./RingConnection"),A=i(R),P=e("./CanvasWrapper"),T=i(P),j=e("./Graph"),I=i(j),w=e("./SSSR"),L=i(w),B=function(){function e(t){r(this,e),this.graph=null,this.ringIdCounter=0,this.ringConnectionIdCounter=0,this.canvasWrapper=null,this.totalOverlapScore=0,this.defaultOptions={width:500,height:500,bondThickness:0.6,bondLength:14.4,shortBondLength:0.85*14.4,bondSpacing:0.18*14.4,atomVisualization:"default",isomeric:!1,debug:!1,terminalCarbons:!1,explicitHydrogens:!1,compactDrawing:!0,fontSizeLarge:6,fontSizeSmall:4,themes:{dark:{C:"#fff",O:"#e74c3c",N:"#3498db",F:"#27ae60",CL:"#16a085",BR:"#d35400",I:"#8e44ad",P:"#d35400",S:"#f1c40f",B:"#e67e22",SI:"#e67e22",H:"#fff",BACKGROUND:"#141414"},light:{C:"#222",O:"#e74c3c",N:"#3498db",F:"#27ae60",CL:"#16a085",BR:"#d35400",I:"#8e44ad",P:"#d35400",S:"#f1c40f",B:"#e67e22",SI:"#e67e22",H:"#222",BACKGROUND:"#fff"}}},this.opts=this.extend(!0,this.defaultOptions,t),this.opts.halfBondSpacing=this.opts.bondSpacing/2,this.opts.bondLengthSq=this.opts.bondLength*this.opts.bondLength,this.opts.halfFontSizeLarge=this.opts.fontSizeLarge/2,this.opts.quarterFontSizeLarge=this.opts.fontSizeLarge/4,this.opts.fifthFontSizeSmall=this.opts.fontSizeSmall/5,this.theme=this.opts.themes.dark}return l(e,[{key:"extend",value:function(){var e=this,t={},n=!1,a=0,i=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(n=arguments[0],a++);for(var r=function(i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(t[a]=n&&"[object Object]"===Object.prototype.toString.call(i[a])?e.extend(!0,t[a],i[a]):i[a])},o;a<i;a++)o=arguments[a],r(o);return t}},{key:"draw",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"light",r=3<arguments.length&&void 0!==arguments[3]&&arguments[3];if(this.data=e,this.canvasWrapper=new T.default(t,this.opts.themes[n],this.opts),this.infoOnly=r,this.ringIdCounter=0,this.ringConnectionIdCounter=0,this.graph=new I.default(e,this.opts.isomeric),this.rings=[],this.ringConnections=[],this.originalRings=[],this.originalRingConnections=[],this.bridgedRing=!1,this.initRings(),this.annotateStereochemistry(),!this.opts.explicitHydrogens)for(var o=0;o<this.graph.vertices.length;o++)"H"===this.graph.vertices[o].value.element&&(this.graph.vertices[o].value.isDrawn=!1);if(this.opts.isomeric&&this.annotateStereochemistry(),!this.infoOnly){this.position(),this.restoreRingInformation(),this.resolvePrimaryOverlaps();var i=this.getOverlapScore();this.totalOverlapScore=this.getOverlapScore().total;for(var o=0,l;o<this.graph.edges.length;o++)if(l=this.graph.edges[o],this.isEdgeRotatable(l)){var s=this.graph.getTreeDepth(l.sourceId,l.targetId),d=this.graph.getTreeDepth(l.targetId,l.sourceId),u=l.targetId,a=l.sourceId;s>d&&(u=l.sourceId,a=l.targetId);var h=this.getSubtreeOverlapScore(a,u,i.vertexScores);if(1<h.value){var c=this.graph.vertices[u],p=this.graph.vertices[a],v=p.getNeighbours(u);if(1===v.length){var f=this.graph.vertices[v[0]],y=f.position.getRotateAwayFromAngle(c.position,p.position,g.default.toRad(120));this.rotateSubtree(f.id,p.id,y,p.position);var m=this.getOverlapScore().total;m>this.totalOverlapScore?this.rotateSubtree(f.id,p.id,-y,p.position):this.totalOverlapScore=m}else if(2==v.length){if(0<p.value.rings.length+c.value.rings.length)continue;var b=this.graph.vertices[v[0]],x=this.graph.vertices[v[1]],k=b.position.getRotateAwayFromAngle(c.position,p.position,g.default.toRad(120)),S=x.position.getRotateAwayFromAngle(c.position,p.position,g.default.toRad(120));this.rotateSubtree(b.id,p.id,k,p.position),this.rotateSubtree(x.id,p.id,S,p.position);var C=this.getOverlapScore().total;C>this.totalOverlapScore?(this.rotateSubtree(b.id,p.id,-k,p.position),this.rotateSubtree(x.id,p.id,-S,p.position)):this.totalOverlapScore=C}i=this.getOverlapScore()}}this.resolveSecondaryOverlaps(i.scores),this.canvasWrapper.scale(this.graph.vertices),this.opts.compactDrawing&&"default"===this.opts.atomVisualization&&this.initPseudoElements(),this.drawEdges(this.opts.debug),this.drawVertices(this.opts.debug),this.canvasWrapper.reset()}}},{key:"edgeRingCount",value:function(e){var t=this.graph.edges[e],n=this.graph.vertices[t.sourceId],i=this.graph.vertices[t.targetId];return Math.min(n.value.rings.length,i.value.rings.length)}},{key:"getBridgedRings",value:function(){for(var e=[],t=0;t<this.rings.length;t++)this.rings[t].isBridged&&e.push(this.rings[t]);return e}},{key:"getFusedRings",value:function(){for(var e=[],t=0;t<this.rings.length;t++)this.rings[t].isFused&&e.push(this.rings[t]);return e}},{key:"getSpiros",value:function(){for(var e=[],t=0;t<this.rings.length;t++)this.rings[t].isSpiro&&e.push(this.rings[t]);return e}},{key:"printRingInfo",value:function(){for(var e="",t=0,n;t<this.rings.length;t++)n=this.rings[t],e+=n.id+";",e+=n.members.length+";",e+=n.neighbours.length+";",e+=n.isSpiro?"true;":"false;",e+=n.isFused?"true;":"false;",e+=n.isBridged?"true;":"false;",e+=n.rings.length+";",e+="\n";return e}},{key:"getTotalOverlapScore",value:function(){return this.totalOverlapScore}},{key:"getRingCount",value:function(){return this.rings.length}},{key:"hasBridgedRing",value:function(){return this.bridgedRing}},{key:"getHeavyAtomCount",value:function(){for(var e=0,t=0;t<this.graph.vertices.length;t++)"H"!==this.graph.vertices[t].value.element&&e++;return e}},{key:"getRingbondType",value:function(e,t){if(1>e.value.getRingbondCount()||1>t.value.getRingbondCount())return null;for(var n=0;n<e.value.ringbonds.length;n++)for(var i=0;i<t.value.ringbonds.length;i++)if(e.value.ringbonds[n].id===t.value.ringbonds[i].id)return"-"===e.value.ringbonds[n].bondType?t.value.ringbonds[i].bond:e.value.ringbonds[n].bond;return null}},{key:"initRings",value:function(){for(var e=new Map,t=this.graph.vertices.length-1,n;0<=t;t--)if(n=this.graph.vertices[t],0!==n.value.ringbonds.length)for(var i=0,r;i<n.value.ringbonds.length;i++)if(r=n.value.ringbonds[i].id,!e.has(r))e.set(r,n.id);else{var o=n.id,l=e.get(r),s=this.graph.addEdge(new b.default(o,l,1)),g=this.graph.vertices[l];n.addAsSecondChild(l),n.value.addNeighbouringElement(g.value.element),g.addAsSecondChild(o),g.value.addNeighbouringElement(n.value.element),n.edges.push(s),g.edges.push(s),e.delete(r)}var d=L.default.getRings(this.graph);if(null!==d){for(var t=0;t<d.length;t++)for(var u=[].concat(a(d[t])),h=this.addRing(new C.default(u)),i=0;i<u.length;i++)this.graph.vertices[u[i]].value.rings.push(h);for(var t=0;t<this.rings.length-1;t++)for(var i=t+1;i<this.rings.length;i++){var c=this.rings[t],p=this.rings[i],v=new A.default(c,p);0<v.vertices.size&&this.addRingConnection(v)}for(var t=0,f;t<this.rings.length;t++)f=this.rings[t],f.neighbours=A.default.getNeighbours(this.ringConnections,f.id);for(var t=0,y;t<this.rings.length;t++)y=this.rings[t],this.graph.vertices[y.members[0]].value.addAnchoredRing(y.id);for(this.backupRingInformation();0<this.rings.length;){for(var m=-1,t=0,x;t<this.rings.length;t++)x=this.rings[t],this.isPartOfBridgedRing(x.id)&&!x.isBridged&&(m=x.id);if(-1===m)break;var k=this.getRing(m),S=this.getBridgedRingRings(k.id);this.bridgedRing=!0,this.createBridgedRing(S,k.members[0]);for(var t=0;t<S.length;t++)this.removeRing(S[t])}}}},{key:"getBridgedRingRings",value:function(e){var t=[],a=this;return function e(o){var r=a.getRing(o);t.push(o);for(var l=0,i;l<r.neighbours.length;l++)i=r.neighbours[l],-1===t.indexOf(i)&&i!==o&&A.default.isBridge(a.ringConnections,a.graph.vertices,o,i)&&e(i)}(e),u.default.unique(t)}},{key:"isPartOfBridgedRing",value:function(e){for(var t=0;t<this.ringConnections.length;t++)if(this.ringConnections[t].containsRing(e)&&this.ringConnections[t].isBridge(this.graph.vertices))return!0;return!1}},{key:"createBridgedRing",value:function(e){for(var t=new Set,n=new Set,r=new Set,o=0,i;o<e.length;o++){i=this.getRing(e[o]),i.isPartOfBridged=!0;for(var l=0;l<i.members.length;l++)n.add(i.members[l]);for(var l=0,s;l<i.neighbours.length;l++)s=i.neighbours[l],-1===e.indexOf(s)&&r.add(i.neighbours[l])}var g=new Set,d=!0,h=!1,c;try{for(var p=n[Symbol.iterator](),v;!(d=(v=p.next()).done);d=!0){var f=v.value,y=this.graph.vertices[f],m=u.default.intersection(e,y.value.rings);1===y.value.rings.length||1===m.length?t.add(y.id):g.add(y.id)}}catch(e){h=!0,c=e}finally{try{!d&&p.return&&p.return()}finally{if(h)throw c}}var b=[],x=!0,k=!1,S;try{for(var R=g[Symbol.iterator](),A;!(x=(A=R.next()).done);x=!0){for(var P=A.value,T=this.graph.vertices[P],j=!1,I=0;I<T.edges.length;I++)1===this.edgeRingCount(T.edges[I])&&(j=!0);j?(T.value.isBridgeNode=!0,t.add(T.id)):(T.value.isBridge=!0,t.add(T.id))}}catch(e){k=!0,S=e}finally{try{!x&&R.return&&R.return()}finally{if(k)throw S}}var w=new C.default([].concat(a(t)));w.isBridged=!0,w.neighbours=[].concat(a(r));for(var o=0;o<e.length;o++)w.rings.push(this.getRing(e[o]).clone());this.addRing(w);for(var o=0;o<w.members.length;o++)this.graph.vertices[w.members[o]].value.bridgedRing=w.id;for(var o=0,L;o<b.length;o++)L=this.graph.vertices[b[o]],L.value.rings=[];var B=!0,N=!1,E;try{for(var _=t[Symbol.iterator](),O;!(B=(O=_.next()).done);B=!0){var D=O.value,V=this.graph.vertices[D];V.value.rings=u.default.removeAll(V.value.rings,e),V.value.rings.push(w.id)}}catch(e){N=!0,E=e}finally{try{!B&&_.return&&_.return()}finally{if(N)throw E}}for(var o=0;o<e.length;o++)for(var l=o+1;l<e.length;l++)this.removeRingConnectionsBetween(e[o],e[l]);var z=!0,F=!1,H;try{for(var W=r[Symbol.iterator](),M;!(z=(M=W.next()).done);z=!0){for(var q=M.value,U=this.getRingConnections(q,e),l=0;l<U.length;l++)this.getRingConnection(U[l]).updateOther(w.id,q);this.getRing(q).neighbours.push(w.id)}}catch(e){F=!0,H=e}finally{try{!z&&W.return&&W.return()}finally{if(F)throw H}}return w}},{key:"areVerticesInSameRing",value:function(e,t){for(var n=0;n<e.value.rings.length;n++)for(var i=0;i<t.value.rings.length;i++)if(e.value.rings[n]===t.value.rings[i])return!0;return!1}},{key:"getCommonRings",value:function(e,t){for(var n=[],a=0;a<e.value.rings.length;a++)for(var i=0;i<t.value.rings.length;i++)e.value.rings[a]==t.value.rings[i]&&n.push(e.value.rings[a]);return n}},{key:"getLargestOrAromaticCommonRing",value:function(e,t){for(var n=this.getCommonRings(e,t),a=0,r=null,o=0;o<n.length;o++){var i=this.getRing(n[o]),l=i.getSize();if(i.isBenzeneLike(this.graph.vertices))return i;l>a&&(a=l,r=i)}return r}},{key:"getVerticesAt",value:function(e,t,n){for(var a=[],r=0,i;r<this.graph.vertices.length;r++)if(i=this.graph.vertices[r],i.id!==n&&i.positioned){var o=e.distanceSq(i.position);o<=t*t&&a.push(i.id)}return a}},{key:"getClosestVertex",value:function(e){for(var t=99999,n=null,a=0,i;a<this.graph.vertices.length;a++)if(i=this.graph.vertices[a],i.id!==e.id){var r=e.position.distanceSq(i.position);r<t&&(t=r,n=i)}return n}},{key:"addRing",value:function(e){return e.id=this.ringIdCounter++,this.rings.push(e),e.id}},{key:"removeRing",value:function(e){this.rings=this.rings.filter(function(t){return t.id!==e}),this.ringConnections=this.ringConnections.filter(function(t){return t.firstRingId!==e&&t.secondRingId!==e});for(var t=0,n;t<this.rings.length;t++)n=this.rings[t],n.neighbours=n.neighbours.filter(function(t){return t!==e})}},{key:"getRing",value:function(e){for(var t=0;t<this.rings.length;t++)if(this.rings[t].id==e)return this.rings[t]}},{key:"addRingConnection",value:function(e){return e.id=this.ringConnectionIdCounter++,this.ringConnections.push(e),e.id}},{key:"removeRingConnection",value:function(e){this.ringConnections=this.ringConnections.filter(function(t){return t.id!==e})}},{key:"removeRingConnectionsBetween",value:function(e,t){for(var n=[],a=0,i;a<this.ringConnections.length;a++)i=this.ringConnections[a],(i.firstRingId===e&&i.secondRingId===t||i.firstRingId===t&&i.secondRingId===e)&&n.push(i.id);for(var a=0;a<n.length;a++)this.removeRingConnection(n[a])}},{key:"getRingConnection",value:function(e){for(var t=0;t<this.ringConnections.length;t++)if(this.ringConnections[t].id==e)return this.ringConnections[t]}},{key:"getRingConnections",value:function(e,t){for(var n=[],a=0,i;a<this.ringConnections.length;a++){i=this.ringConnections[a];for(var r=0,o;r<t.length;r++)o=t[r],(i.firstRingId===e&&i.secondRingId===o||i.firstRingId===o&&i.secondRingId===e)&&n.push(i.id)}return n}},{key:"getOverlapScore",value:function(){for(var e=0,t=new Float32Array(this.graph.vertices.length),n=0;n<this.graph.vertices.length;n++)t[n]=0;for(var n=0,r;n<this.graph.vertices.length;n++)for(r=this.graph.vertices.length;--r>n;){var o=this.graph.vertices[n],a=this.graph.vertices[r];if(o.value.isDrawn&&a.value.isDrawn){var l=c.default.subtract(o.position,a.position).lengthSq();if(l<this.opts.bondLengthSq){var s=(this.opts.bondLength-Math.sqrt(l))/this.opts.bondLength;e+=s,t[n]+=s,t[r]+=s}}}for(var g=[],n=0;n<this.graph.vertices.length;n++)g.push({id:n,score:t[n]});return g.sort(function(e,t){return t.score-e.score}),{total:e,scores:g,vertexScores:t}}},{key:"chooseSide",value:function(e,t,n){for(var a=e.getNeighbours(t.id),r=t.getNeighbours(e.id),o=a.length,l=r.length,s=u.default.merge(a,r),g=[0,0],d=0,i;d<s.length;d++)i=this.graph.vertices[s[d]].position,i.sameSideAs(e.position,t.position,n[0])?g[0]++:g[1]++;for(var h=[0,0],d=0,c;d<this.graph.vertices.length;d++)c=this.graph.vertices[d].position,c.sameSideAs(e.position,t.position,n[0])?h[0]++:h[1]++;return{totalSideCount:h,totalPosition:h[0]>h[1]?0:1,sideCount:g,position:g[0]>g[1]?0:1,anCount:o,bnCount:l}}},{key:"setRingCenter",value:function(e){for(var t=e.getSize(),n=new c.default(0,0),a=0;a<t;a++)n.add(this.graph.vertices[e.members[a]].position);e.center=n.divide(t)}},{key:"getSubringCenter",value:function(e,t){for(var n=t.value.originalRings,a=e.center,r=Number.MAX_VALUE,o=0;o<n.length;o++)for(var i=0;i<e.rings.length;i++)n[o]===e.rings[i].id&&e.rings[i].getSize()<r&&(a=e.rings[i].center,r=e.rings[i].getSize());return a}},{key:"drawEdges",value:function(e){var t=this,n=Array(this.graph.edges.length);if(n.fill(!1),this.graph.traverseBF(0,function(a){for(var r=t.graph.getEdges(a.id),o=0,i;o<r.length;o++)i=r[o],n[i]||(n[i]=!0,t.drawEdge(i,e))}),!this.bridgedRing)for(var a=0,i;a<this.rings.length;a++)i=this.rings[a],this.isRingAromatic(i)&&this.canvasWrapper.drawAromaticityRing(i)}},{key:"drawEdge",value:function(e,t){var n=this,i=this.graph.edges[e],r=this.graph.vertices[i.sourceId],o=this.graph.vertices[i.targetId],l=r.value.element,g=o.value.element;if(r.value.isDrawn&&o.value.isDrawn||"default"!==this.opts.atomVisualization){var d=r.position,a=o.position,h=this.getEdgeNormals(i),p=u.default.clone(h);if(p[0].multiplyScalar(10).add(d),p[1].multiplyScalar(10).add(d),"="===i.bondType||"="===this.getRingbondType(r,o)||i.isPartOfAromaticRing&&this.bridgedRing){var f=this.areVerticesInSameRing(r,o),y=this.chooseSide(r,o,p);if(f){var s=this.getLargestOrAromaticCommonRing(r,o),m=s.center;h[0].multiplyScalar(n.opts.bondSpacing),h[1].multiplyScalar(n.opts.bondSpacing);var b=null;b=m.sameSideAs(r.position,o.position,c.default.add(d,h[0]))?new v.default(c.default.add(d,h[0]),c.default.add(a,h[0]),l,g):new v.default(c.default.add(d,h[1]),c.default.add(a,h[1]),l,g),b.shorten(this.opts.bondLength-this.opts.shortBondLength),i.isPartOfAromaticRing?this.canvasWrapper.drawLine(b,!0):this.canvasWrapper.drawLine(b),this.canvasWrapper.drawLine(new v.default(d,a,l,g))}else if(i.center){h[0].multiplyScalar(n.opts.halfBondSpacing),h[1].multiplyScalar(n.opts.halfBondSpacing);var x=new v.default(c.default.add(d,h[0]),c.default.add(a,h[0]),l,g),k=new v.default(c.default.add(d,h[1]),c.default.add(a,h[1]),l,g);this.canvasWrapper.drawLine(x),this.canvasWrapper.drawLine(k)}else if(0==y.anCount&&1<y.bnCount||0==y.bnCount&&1<y.anCount){h[0].multiplyScalar(n.opts.halfBondSpacing),h[1].multiplyScalar(n.opts.halfBondSpacing);var S=new v.default(c.default.add(d,h[0]),c.default.add(a,h[0]),l,g),C=new v.default(c.default.add(d,h[1]),c.default.add(a,h[1]),l,g);this.canvasWrapper.drawLine(S),this.canvasWrapper.drawLine(C)}else if(y.sideCount[0]>y.sideCount[1]){h[0].multiplyScalar(n.opts.bondSpacing),h[1].multiplyScalar(n.opts.bondSpacing);var R=new v.default(c.default.add(d,h[0]),c.default.add(a,h[0]),l,g);R.shorten(this.opts.bondLength-this.opts.shortBondLength),this.canvasWrapper.drawLine(R),this.canvasWrapper.drawLine(new v.default(d,a,l,g))}else if(y.sideCount[0]<y.sideCount[1]){h[0].multiplyScalar(n.opts.bondSpacing),h[1].multiplyScalar(n.opts.bondSpacing);var A=new v.default(c.default.add(d,h[1]),c.default.add(a,h[1]),l,g);A.shorten(this.opts.bondLength-this.opts.shortBondLength),this.canvasWrapper.drawLine(A),this.canvasWrapper.drawLine(new v.default(d,a,l,g))}else if(y.totalSideCount[0]>y.totalSideCount[1]){h[0].multiplyScalar(n.opts.bondSpacing),h[1].multiplyScalar(n.opts.bondSpacing);var P=new v.default(c.default.add(d,h[0]),c.default.add(a,h[0]),l,g);P.shorten(this.opts.bondLength-this.opts.shortBondLength),this.canvasWrapper.drawLine(P),this.canvasWrapper.drawLine(new v.default(d,a,l,g))}else if(y.totalSideCount[0]<=y.totalSideCount[1]){h[0].multiplyScalar(n.opts.bondSpacing),h[1].multiplyScalar(n.opts.bondSpacing);var T=new v.default(c.default.add(d,h[1]),c.default.add(a,h[1]),l,g);T.shorten(this.opts.bondLength-this.opts.shortBondLength),this.canvasWrapper.drawLine(T),this.canvasWrapper.drawLine(new v.default(d,a,l,g))}else;}else if("#"===i.bondType){h[0].multiplyScalar(n.opts.bondSpacing/1.5),h[1].multiplyScalar(n.opts.bondSpacing/1.5);var j=new v.default(c.default.add(d,h[0]),c.default.add(a,h[0]),l,g),I=new v.default(c.default.add(d,h[1]),c.default.add(a,h[1]),l,g);this.canvasWrapper.drawLine(j),this.canvasWrapper.drawLine(I),this.canvasWrapper.drawLine(new v.default(d,a,l,g))}else if("."===i.bondType);else{var w=r.value.bracket&&r.value.bracket.chirality,L=o.value.bracket&&o.value.bracket.chirality;"up"===i.chiral?this.canvasWrapper.drawWedge(new v.default(d,a,l,g,w,L)):"down"===i.chiral?this.canvasWrapper.drawDashedWedge(new v.default(d,a,l,g,w,L)):this.canvasWrapper.drawLine(new v.default(d,a,l,g,w,L))}if(t){var B=c.default.midpoint(d,a);this.canvasWrapper.drawDebugText(B.x,B.y,"e: "+e)}}}},{key:"drawVertices",value:function(e){for(var t=this.graph.vertices.length,t=0;t<this.graph.vertices.length;t++){var n=this.graph.vertices[t],i=n.value,r=0,l=0,s=this.getBondCount(n),g=i.element,d=k.default.maxBonds[g]-s,h=n.getTextDirection(this.graph.vertices),p=(this.opts.terminalCarbons||"C"!==g||i.hasAttachedPseudoElements)&&n.isTerminal(),v="C"===i.element;if(i.bracket&&(d=i.bracket.hcount,r=i.bracket.charge,l=i.bracket.isotope),"allballs"===this.opts.atomVisualization)this.canvasWrapper.drawBall(n.position.x,n.position.y,g);else if(i.isDrawn&&(!v||i.drawExplicit||p||i.hasAttachedPseudoElements))"default"===this.opts.atomVisualization?this.canvasWrapper.drawText(n.position.x,n.position.y,g,d,h,p,r,l,i.getAttachedPseudoElements()):"balls"===this.opts.atomVisualization&&this.canvasWrapper.drawBall(n.position.x,n.position.y,g);else if(2===n.getNeighbourCount()&&!0==n.forcePositioned){var f=this.graph.vertices[n.neighbours[0]].position,a=this.graph.vertices[n.neighbours[1]].position,y=c.default.threePointangle(n.position,f,a);0.1>Math.abs(o-y)&&this.canvasWrapper.drawPoint(n.position.x,n.position.y,g)}if(e){var m="v: "+n.id+" "+u.default.print(i.ringbonds);this.canvasWrapper.drawDebugText(n.position.x,n.position.y,m)}}if(this.opts.debug)for(var t=0,b;t<this.rings.length;t++)b=this.rings[t].center,this.canvasWrapper.drawDebugPoint(b.x,b.y,"r: "+this.rings[t].id)}},{key:"position",value:function(){for(var e=null,t=0;t<this.graph.vertices.length;t++)if(null!==this.graph.vertices[t].value.bridgedRing){e=this.graph.vertices[t];break}for(var t=0;t<this.rings.length;t++)this.rings[t].isBridged&&(e=this.graph.vertices[this.rings[t].members[0]]);0<this.rings.length&&null===e&&(e=this.graph.vertices[this.rings[0].members[0]]),null===e&&(e=this.graph.vertices[0]),this.createNextBond(e)}},{key:"backupRingInformation",value:function(){this.originalRings=[],this.originalRingConnections=[];for(var e=0;e<this.rings.length;e++)this.originalRings.push(this.rings[e]);for(var e=0;e<this.ringConnections.length;e++)this.originalRingConnections.push(this.ringConnections[e]);for(var e=0;e<this.graph.vertices.length;e++)this.graph.vertices[e].value.backupRings()}},{key:"restoreRingInformation",value:function(){var e=this.getBridgedRings();this.rings=[],this.ringConnections=[];for(var t=0,n;t<e.length;t++){n=e[t];for(var i=0,a;i<n.rings.length;i++)a=n.rings[i],this.originalRings[a.id].center=a.center}for(var t=0;t<this.originalRings.length;t++)this.rings.push(this.originalRings[t]);for(var t=0;t<this.originalRingConnections.length;t++)this.ringConnections.push(this.originalRingConnections[t]);for(var t=0;t<this.graph.vertices.length;t++)this.graph.vertices[t].value.restoreRings()}},{key:"createRing",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;if(!e.positioned){t=t?t:new c.default(0,0);var l=e.getOrderedNeighbours(this.ringConnections),s=n?c.default.subtract(n.position,t).angle():0,d=g.default.polyCircumradius(this.opts.bondLength,e.getSize()),h=g.default.centralAngle(e.getSize());e.centralAngle=h;var p=s,a=this,f=n?n.id:null;-1===e.members.indexOf(f)&&(n&&(n.positioned=!1),f=e.members[0]);var y=[];if(e.isBridged){this.graph.kkLayout(e.members.slice(),y,t,n.id,e,this.opts.bondLength),e.positioned=!0,this.setRingCenter(e),t=e.center;for(var m=0;m<e.rings.length;m++)this.setRingCenter(e.rings[m])}else e.eachMember(this.graph.vertices,function(n){var i=a.graph.vertices[n];i.positioned||i.setPosition(t.x+Math.cos(p)*d,t.y+Math.sin(p)*d),p+=h,(!e.isBridged||3>e.rings.length)&&(i.positioned=!0)},f,o?o.id:null);e.positioned=!0,e.center=t;for(var m=0,i;m<l.length;m++)if(i=this.getRing(l[m].neighbour),!i.positioned){var b=A.default.getVertices(this.ringConnections,e.id,i.id);if(2===b.length){e.isFused=!0,i.isFused=!0;var x=this.graph.vertices[b[0]],k=this.graph.vertices[b[1]],S=c.default.midpoint(x.position,k.position),C=c.default.normals(x.position,k.position);C[0].normalize(),C[1].normalize();var R=g.default.polyCircumradius(this.opts.bondLength,i.getSize()),r=g.default.apothem(R,i.getSize());C[0].multiplyScalar(r).add(S),C[1].multiplyScalar(r).add(S);var P=C[0];c.default.subtract(t,C[1]).lengthSq()>c.default.subtract(t,C[0]).lengthSq()&&(P=C[1]);var T=c.default.subtract(x.position,P),I=c.default.subtract(k.position,P);-1===T.clockwise(I)?!i.positioned&&this.createRing(i,P,x,k):!i.positioned&&this.createRing(i,P,k,x)}else if(1===b.length){e.isSpiro=!0,i.isSpiro=!0;var w=this.graph.vertices[b[0]],L=c.default.subtract(t,w.position);L.invert(),L.normalize();var B=g.default.polyCircumradius(this.opts.bondLength,i.getSize());L.multiplyScalar(B),L.add(w.position),i.positioned||this.createRing(i,L,w)}}for(var m=0;m<e.members.length;m++)for(var N=this.graph.vertices[e.members[m]],E=N.neighbours,_=0,j;_<E.length;_++)(j=this.graph.vertices[E[_]],!j.positioned)&&(j.value.isConnectedToRing=!0,this.createNextBond(j,N));for(var m=0;m<y.length;m++){var v=this.graph.vertices[y[m][1]],u=this.graph.vertices[y[m][0]];u.previousPosition=v.position,this.createNextBond(u,v,0,0,!0)}}}},{key:"rotateSubtree",value:function(e,t,n,a){var r=this;this.graph.traverseTree(e,t,function(e){e.position.rotateAround(n,a);for(var t=0,i;t<e.value.anchoredRings.length;t++)i=r.rings[e.value.anchoredRings[t]],i&&i.center.rotateAround(n,a)})}},{key:"getSubtreeOverlapScore",value:function(e,t,n){var i=this,a=0,r=new c.default(0,0);return this.graph.traverseTree(e,t,function(e){var t=n[e.id];a+=t;var o=i.graph.vertices[e.id].position.clone();o.multiplyScalar(t),r.add(o)}),r.divide(a),{value:a,center:r}}},{key:"getCurrentCenterOfMass",value:function(){for(var e=new c.default(0,0),t=0,n=0,i;n<this.graph.vertices.length;n++)i=this.graph.vertices[n],i.positioned&&(e.add(i.position),t++);return e.divide(t)}},{key:"getCurrentCenterOfMassInNeigbourhood",value:function(e){for(var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:2*this.opts.bondLength,n=new c.default(0,0),a=0,r=0,i;r<this.graph.vertices.length;r++)i=this.graph.vertices[r],i.positioned&&e.distanceSq(i.position)<t*t&&(n.add(i.position),a++);return n.divide(a)}},{key:"resolvePrimaryOverlaps",value:function(){for(var e=[],t=Array(this.graph.vertices.length),n=0,i;n<this.rings.length;n++){i=this.rings[n];for(var r=0,l;r<i.members.length;r++)if(l=this.graph.vertices[i.members[r]],!t[l.id]){t[l.id]=!0;var s=this.getNonRingNeighbours(l.id);if(1<s.length){for(var g=[],d=0;d<l.value.rings.length;d++)g.push(l.value.rings[d]);e.push({common:l,rings:g,vertices:s})}}}for(var n=0,u;n<e.length;n++)if(u=e[n],2===u.vertices.length){var h=u.vertices[0],a=u.vertices[1];if(!h.value.isDrawn||!a.value.isDrawn)continue;var c=(2*o-this.getRing(u.rings[0]).getAngle())/6;this.rotateSubtree(h.id,u.common.id,c,u.common.position),this.rotateSubtree(a.id,u.common.id,-c,u.common.position);var p=this.getOverlapScore(),v=this.getSubtreeOverlapScore(h.id,u.common.id,p.vertexScores),f=this.getSubtreeOverlapScore(a.id,u.common.id,p.vertexScores),y=v.value+f.value;this.rotateSubtree(h.id,u.common.id,-2*c,u.common.position),this.rotateSubtree(a.id,u.common.id,2*c,u.common.position),p=this.getOverlapScore(),v=this.getSubtreeOverlapScore(h.id,u.common.id,p.vertexScores),f=this.getSubtreeOverlapScore(a.id,u.common.id,p.vertexScores),v.value+f.value>y&&(this.rotateSubtree(h.id,u.common.id,2*c,u.common.position),this.rotateSubtree(a.id,u.common.id,-2*c,u.common.position))}}},{key:"resolveSecondaryOverlaps",value:function(e){for(var t=0;t<e.length;t++)if(e[t].score>this.opts.bondLength/(4*this.opts.bondLength)){var n=this.graph.vertices[e[t].id];if(n.isTerminal()){var i=this.getClosestVertex(n);if(i){var a=null;a=i.isTerminal()?0===i.id?this.graph.vertices[1].position:i.previousPosition:0===i.id?this.graph.vertices[1].position:i.position;var r=0===n.id?this.graph.vertices[1].position:n.previousPosition;n.position.rotateAwayFrom(a,r,g.default.toRad(20))}}}}},{key:"createNextBond",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,o=4<arguments.length&&void 0!==arguments[4]&&arguments[4];if(!e.positioned||o){if(!o)if(!t){var d=new c.default(this.opts.bondLength,0);d.rotate(g.default.toRad(-120)),e.previousPosition=d,e.setPosition(this.opts.bondLength,0),e.angle=g.default.toRad(-120),e.globalAngle=e.angle,null===e.value.bridgedRing&&(e.positioned=!0)}else if(1===t.value.originalRings.length){for(var h=[],p=t.neighbours,f=0,i;f<p.length;f++)i=this.graph.vertices[p[f]],i.positioned&&0<i.value.originalRings.length&&h.push(c.default.subtract(i.position,t.position));var m=c.default.averageDirection(h);e.setPositionFromVector(m.invert().multiplyScalar(this.opts.bondLength).add(t.position)),e.previousPosition=t.position,e.positioned=!0}else if(1<t.value.originalRings.length){for(var b=[],k=t.neighbours,f=0,S;f<k.length;f++)S=this.graph.vertices[k[f]],S.positioned&&1<S.value.originalRings.length&&b.push(c.default.subtract(S.position,t.position));var C=c.default.averageDirection(b);C.invert().multiplyScalar(this.opts.bondLength).add(t.position);for(var f=0,R;f<k.length;f++)if((R=this.graph.vertices[k[f]],!!R.positioned)&&3.1<c.default.threePointangle(C,t.position,R.position)){C.rotateAround(Math.PI,t.position);break}e.previousPosition=t.position,e.setPositionFromVector(C),e.positioned=!0}else{var A=new c.default(this.opts.bondLength,0);A.rotate(n),A.add(t.position),e.globalAngle=n,e.setPositionFromVector(A),e.previousPosition=t.position,e.positioned=!0}if(null!==e.value.bridgedRing){var v=this.getRing(e.value.bridgedRing),P=c.default.subtract(e.previousPosition,e.position);P.invert(),P.normalize();var T=g.default.polyCircumradius(this.opts.bondLength,v.members.length);P.multiplyScalar(T),P.add(e.position),v.positioned||this.createRing(v,P,e)}else if(0<e.value.rings.length){var r=this.getRing(e.value.rings[0]),j=c.default.subtract(e.previousPosition,e.position);j.invert(),j.normalize();var I=g.default.polyCircumradius(this.opts.bondLength,r.getSize());j.multiplyScalar(I),j.add(e.position),r.positioned||this.createRing(r,j,e)}else{for(var L=e.getNeighbours(),B=[],f=0;f<L.length;f++)this.graph.vertices[L[f]].value.isDrawn&&B.push(L[f]);t&&(B=u.default.remove(B,t.id));var N=e.getAngle();if(1===B.length){var E=this.graph.vertices[B[0]];if("#"===e.value.bondType||t&&"#"===t.value.bondType||"="===e.value.bondType&&t&&"="===t.value.bondType){if(e.value.drawExplicit=!1,t){var _=this.graph.getEdge(e.id,t.id);_.center=!0}var O=this.graph.getEdge(e.id,E.id);O.center=!0,E.drawExplicit=!0,E.globalAngle=N,E.angle=0,this.createNextBond(E,e,E.globalAngle,-a)}else if(t&&0<t.value.rings.length){var D=g.default.toRad(60),V=-D,F=new c.default(this.opts.bondLength,0),H=new c.default(this.opts.bondLength,0);F.rotate(D).add(e.position),H.rotate(V).add(e.position);var W=this.getCurrentCenterOfMass(),M=F.distanceSq(W),q=H.distanceSq(W);E.angle=M<q?V:D,a=0<E.angle?-1:1,E.globalAngle=N+E.angle,this.createNextBond(E,e,E.globalAngle,a)}else{if(!a){var U=g.default.toRad(60),G=-U,X=new c.default(this.opts.bondLength,0),Y=new c.default(this.opts.bondLength,0);X.rotate(U).add(e.position),Y.rotate(G).add(e.position);var K=this.getCurrentCenterOfMass(),Z=X.distanceSq(K),$=Y.distanceSq(K);E.angle=Z<$?G:U,a=0<E.angle?-1:1}else E.angle=g.default.toRad(60)*a,a=-a;E.globalAngle=N+E.angle,this.createNextBond(E,e,E.globalAngle,a)}}else if(2===B.length){var Q=this.graph.getTreeDepth(B[0],e.id),J=this.graph.getTreeDepth(B[1],e.id),ee=this.graph.getTreeDepth(t?t.id:null,e.id),te=0,ne=1;Q>J&&(te=1,ne=0);var ie=this.graph.vertices[B[te]],ae=this.graph.vertices[B[ne]];ee<Q&&ee<J?1===e.position.clockwise(e.previousPosition)?(ae.angle=g.default.toRad(60),ie.angle=-g.default.toRad(60),ae.globalAngle=N+ae.angle,ie.globalAngle=N+ie.angle,this.createNextBond(ae,e,ae.globalAngle,-a),this.createNextBond(ie,e,ie.globalAngle,a)):(ae.angle=-g.default.toRad(60),ie.angle=g.default.toRad(60),ae.globalAngle=N+ae.angle,ie.globalAngle=N+ie.angle,this.createNextBond(ie,e,ie.globalAngle,a),this.createNextBond(ae,e,ae.globalAngle,-a)):1===e.position.clockwise(e.previousPosition)?(ae.angle=g.default.toRad(60),ie.angle=-g.default.toRad(60),ae.globalAngle=N+ae.angle,ie.globalAngle=N+ie.angle,this.createNextBond(ae,e,ae.globalAngle,-a),this.createNextBond(ie,e,ie.globalAngle,-a)):(ae.angle=-g.default.toRad(60),ie.angle=g.default.toRad(60),ae.globalAngle=N+ae.angle,ie.globalAngle=N+ie.angle,this.createNextBond(ie,e,ie.globalAngle,-a),this.createNextBond(ae,e,ae.globalAngle,-a))}else if(3===B.length){var re=this.graph.getTreeDepth(B[0],e.id),oe=this.graph.getTreeDepth(B[1],e.id),le=this.graph.getTreeDepth(B[2],e.id),se=this.graph.vertices[B[0]],s=this.graph.vertices[B[1]],l=this.graph.vertices[B[2]];if(oe>re&&oe>le?(se=this.graph.vertices[B[1]],s=this.graph.vertices[B[0]],l=this.graph.vertices[B[2]]):le>re&&le>oe&&(se=this.graph.vertices[B[2]],s=this.graph.vertices[B[0]],l=this.graph.vertices[B[1]]),1===this.graph.getTreeDepth(s.id,e.id)&&1===this.graph.getTreeDepth(l.id,e.id)&&1<this.graph.getTreeDepth(se.id,e.id)){if(!a){var ge=g.default.toRad(60),de=-ge,ue=new c.default(this.opts.bondLength,0),he=new c.default(this.opts.bondLength,0);ue.rotate(ge).add(e.position),he.rotate(de).add(e.position);var ce=this.getCurrentCenterOfMass(),pe=ue.distanceSq(ce),ve=he.distanceSq(ce);se.angle=pe<ve?de:ge,a=0<se.angle?-1:1}else se.angle=g.default.toRad(60)*a,a=-a;se.globalAngle=N+se.angle,this.createNextBond(se,e,se.globalAngle,-a),e.value.bracket&&"@@"===e.value.bracket.chirality?(l.angle=g.default.toRad(30)*a,s.angle=g.default.toRad(90)*a,l.globalAngle=N+l.angle,s.globalAngle=N+s.angle,this.createNextBond(l,e,l.globalAngle),this.createNextBond(s,e,s.globalAngle)):(s.angle=g.default.toRad(30)*a,l.angle=g.default.toRad(90)*a,s.globalAngle=N+s.angle,l.globalAngle=N+l.angle,this.createNextBond(s,e,s.globalAngle),this.createNextBond(l,e,l.globalAngle))}else se.angle=0,s.angle=g.default.toRad(90),l.angle=-g.default.toRad(90),se.globalAngle=N+se.angle,s.globalAngle=N+s.angle,l.globalAngle=N+l.angle,this.createNextBond(se,e,se.globalAngle),this.createNextBond(s,e,s.globalAngle),this.createNextBond(l,e,l.globalAngle)}else if(4===B.length){var fe=this.graph.getTreeDepth(B[0],e.id),ye=this.graph.getTreeDepth(B[1],e.id),me=this.graph.getTreeDepth(B[2],e.id),be=this.graph.getTreeDepth(B[3],e.id),xe=this.graph.vertices[B[0]],w=this.graph.vertices[B[1]],x=this.graph.vertices[B[2]],y=this.graph.vertices[B[3]];ye>fe&&ye>me&&ye>be?(xe=this.graph.vertices[B[1]],w=this.graph.vertices[B[0]],x=this.graph.vertices[B[2]],y=this.graph.vertices[B[3]]):me>fe&&me>ye&&me>be?(xe=this.graph.vertices[B[2]],w=this.graph.vertices[B[0]],x=this.graph.vertices[B[1]],y=this.graph.vertices[B[3]]):be>fe&&be>ye&&be>me&&(xe=this.graph.vertices[B[3]],w=this.graph.vertices[B[0]],x=this.graph.vertices[B[1]],y=this.graph.vertices[B[2]]),xe.angle=-g.default.toRad(36),w.angle=g.default.toRad(36),x.angle=-g.default.toRad(108),y.angle=g.default.toRad(108),xe.globalAngle=N+xe.angle,w.globalAngle=N+w.angle,x.globalAngle=N+x.angle,y.globalAngle=N+y.angle,this.createNextBond(xe,e,xe.globalAngle),this.createNextBond(w,e,w.globalAngle),this.createNextBond(x,e,x.globalAngle),this.createNextBond(y,e,y.globalAngle)}}}}},{key:"getCommonRingbondNeighbour",value:function(e){for(var t=e.neighbours,n=0,i;n<t.length;n++)if(i=this.graph.vertices[t[n]],u.default.containsAll(i.value.rings,e.value.rings))return i;return null}},{key:"isPointInRing",value:function(e){for(var t=0,n;t<this.rings.length;t++)if(n=this.rings[t],!!n.positioned){var i=g.default.polyCircumradius(this.opts.bondLength,n.getSize());if(e.distanceSq(n.center)<i*i)return!0}return!1}},{key:"isEdgeInRing",value:function(e){var t=this.graph.vertices[e.sourceId],n=this.graph.vertices[e.targetId];return this.areVerticesInSameRing(t,n)}},{key:"isEdgeRotatable",value:function(e){var t=this.graph.vertices[e.sourceId],n=this.graph.vertices[e.targetId];return"-"===e.bondType&&!(5>t.getNeighbourCount()+n.getNeighbourCount())&&(0<t.value.rings.length&&0<n.value.rings.length&&this.areVerticesInSameRing(t,n)?!1:!0)}},{key:"isRingAromatic",value:function(e){for(var t=0,n;t<e.members.length;t++)if(n=this.graph.vertices[e.members[t]],!n.value.isPartOfAromaticRing)return!1;return!0}},{key:"getEdgeNormals",value:function(e){var t=this.graph.vertices[e.sourceId].position,n=this.graph.vertices[e.targetId].position,i=c.default.units(t,n);return i}},{key:"getBondCount",value:function(e){for(var t=0,n=0;n<e.edges.length;n++)t+=this.graph.edges[e.edges[n]].weight;return t}},{key:"getNonRingNeighbours",value:function(e){for(var t=[],n=this.graph.vertices[e],a=n.neighbours,r=0;r<a.length;r++){var i=this.graph.vertices[a[r]],o=u.default.intersection(n.value.rings,i.value.rings).length;0===o&&!1==i.value.isBridge&&t.push(i)}return t}},{key:"annotateStereochemistry",value:function(){for(var e=10,t=0,n;t<this.graph.vertices.length;t++)if(n=this.graph.vertices[t],n.value.bracket&&n.value.bracket.chirality){var i=n.getNeighbours();console.log(i);for(var a=i.length,r=Array(a),o=0;o<a;o++){var l=new Uint8Array(this.graph.vertices.length),s=new Uint16Array(2*e+1);l[n.id]=1,this.visitStereochemistry(i[o],null,l,s,e,0),s[2*e]=i[o],r[o]=[o,s]}r.sort(function(t,n){for(var i=0;i<2*e;i++){if(t[1][i]>n[1][i])return-1;if(t[1][i]<n[1][i])return 1}return 0}),console.log(r);for(var d=new Uint8Array(a),o=0;o<a;o++)d[o]=r[o][0];var u="@"===n.value.bracket.chirality?-1:1,h=1==g.default.parityOfPermutation(d)*u?"R":"S";console.log(n.id,h)}}},{key:"visitStereochemistry",value:function(e,t,n,a,r,o){n[e]=1;var l=this.graph.vertices[e].value.getAtomicNumber();null!==t&&(l*=this.graph.getEdge(e,t).weight),a[2*(0.5*o)]+=l,a[2*o]=l;for(var s=this.graph.vertices[e].neighbours,g=0;g<s.length;g++)1!==n[s[g]]&&o<r-1&&this.visitStereochemistry(s[g],e,n.slice(),a,r,o+1)}},{key:"initPseudoElements",value:function(){for(var e=0;e<this.graph.vertices.length;e++){for(var t=this.graph.vertices[e],n=t.neighbours,i=Array(n.length),a=0;a<n.length;a++)i[a]=this.graph.vertices[n[a]];if(!(3>t.getNeighbourCount()||0<t.value.rings.length)){for(var r=0,o=0,a=0;a<i.length;a++){var l=i[a],s=l.value.element,g=l.getNeighbourCount();"C"!==s&&"H"!==s&&1===g&&r++,1<g&&o++}if(!(1<o||2>r)){for(var d=null,a=0,u;a<i.length;a++)u=i[a],1<u.getNeighbourCount()&&(d=u);for(var a=0,h;a<i.length;a++)if(h=i[a],!(1<h.getNeighbourCount())){h.value.isDrawn=!1;var c=k.default.maxBonds[h.value.element]-this.getBondCount(h);h.value.bracket&&(c=h.value.bracket.hcount),t.value.attachPseudoElement(h.value.element,d?d.value.element:null,c)}}}}for(var e=0;e<this.graph.vertices.length;e++){var p=this.graph.vertices[e],v=p.value,f=v.element;if("C"!==f&&"H"!==f&&v.isDrawn){for(var y=p.neighbours,m=Array(y.length),a=0;a<y.length;a++)m[a]=this.graph.vertices[y[a]];for(var a=0,b;a<m.length;a++)if(b=m[a].value,b.hasAttachedPseudoElements&&2===b.getAttachedPseudoElementsCount()){var x=b.getAttachedPseudoElements();x.hasOwnProperty("0O")&&x.hasOwnProperty("3C")&&(b.isDrawn=!1,p.value.attachPseudoElement("Ac","",0))}}}}}]),e}();n.default=B},{"./ArrayHelper":2,"./Atom":3,"./CanvasWrapper":4,"./Edge":6,"./Graph":7,"./Line":8,"./MathHelper":9,"./Ring":11,"./RingConnection":12,"./SSSR":13,"./Vector2":14,"./Vertex":15}],6:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0,i;n<t.length;n++)i=t[n],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=function(){function e(t,n){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;i(this,e),this.id=null,this.sourceId=t,this.targetId=n,this.weight=a,this.bondType="-",this.isPartOfAromaticRing=!1,this.center=!1,this.chiral=""}return a(e,[{key:"setBondType",value:function(t){this.bondType=t,this.weight=e.bonds[t]}}],[{key:"bonds",get:function(){return{"-":1,"/":1,"\\":1,"=":2,"#":3,$:4}}}]),e}();n.default=r},{}],7:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=Math.pow,o=Math.sqrt,l=Math.min;Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){var n=[],i=!0,a=!1,r;try{for(var o=e[Symbol.iterator](),l;!(i=(l=o.next()).done)&&(n.push(l.value),!(t&&n.length===t));i=!0);}catch(e){a=!0,r=e}finally{try{!i&&o["return"]&&o["return"]()}finally{if(a)throw r}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),g=function(){function e(e,t){for(var n=0,i;n<t.length;n++)i=t[n],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),d=e("./MathHelper"),u=i(d),h=e("./Vector2"),c=i(h),p=e("./Vertex"),v=i(p),f=e("./Edge"),y=i(f),m=e("./Ring"),b=i(m),x=e("./Atom"),k=i(x),S=function(){function e(t){var n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];a(this,e),this.vertices=[],this.edges=[],this.vertexIdsToEdgeId={},this.elementCount={},this.isomeric=n,this._time=0,this._init(t),this._initInfos()}return g(e,[{key:"_init",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,a=3<arguments.length&&void 0!==arguments[3]&&arguments[3],r=new k.default(e.atom.element?e.atom.element:e.atom,e.bond);r.branchBond=e.branchBond,r.ringbonds=e.ringbonds,r.bracket=e.atom.element?e.atom:null,r.setOrder(n,t);var o=new v.default(r),l=this.vertices[n];if(this.addVertex(o),null!==n){o.setParentVertexId(n),o.value.addNeighbouringElement(l.value.element),l.addChild(o.id),l.value.addNeighbouringElement(r.element),l.spanningTreeChildren.push(o.id);var s=new y.default(n,o.id,1);a?s.setBondType(o.value.branchBond||"-"):s.setBondType(l.value.bondType||"-");var g=this.addEdge(s);o.edges.push(g),l.edges.push(g)}var d=e.ringbondCount+1;r.bracket&&(d+=r.bracket.hcount);var u=0;if(r.bracket&&r.bracket.chirality){u=r.bracket.hcount;for(var h=0;h<u;h++)this._init({atom:"H",isBracket:"false",branches:[],branchCount:0,ringbonds:[],ringbondCount:!1,next:null,hasNext:!1,bond:"-"},h,o.id,!0)}for(var h=0;h<e.branchCount;h++)this._init(e.branches[h],h+d,o.id,!0);e.hasNext&&this._init(e.next,e.branchCount+d,o.id)}},{key:"_initInfos",value:function(){for(var e=0,t;e<this.vertices.length;e++)t=this.vertices[e].value,"undefined"==typeof this.elementCount[t.element]?this.elementCount[t.element]=0:this.elementCount[t.element]+=1}},{key:"clear",value:function(){this.vertices=[],this.edges=[],this.vertexIdsToEdgeId={}}},{key:"addVertex",value:function(e){return e.id=this.vertices.length,this.vertices.push(e),e.id}},{key:"addEdge",value:function(e){return e.id=this.edges.length,this.edges.push(e),this.vertexIdsToEdgeId[e.sourceId+"_"+e.targetId]=e.id,this.vertexIdsToEdgeId[e.targetId+"_"+e.sourceId]=e.id,e.isPartOfAromaticRing=this.vertices[e.sourceId].value.isPartOfAromaticRing&&this.vertices[e.targetId].value.isPartOfAromaticRing,e.id}},{key:"getEdge",value:function(e,t){var n=this.vertexIdsToEdgeId[e+"_"+t];return void 0===n?null:this.edges[n]}},{key:"getEdges",value:function(e){for(var t=[],n=this.vertices[e],a=0;a<n.neighbours.length;a++)t.push(this.vertexIdsToEdgeId[e+"_"+n.neighbours[a]]);return t}},{key:"hasEdge",value:function(e,t){return void 0!==this.vertexIdsToEdgeId[e+"_"+t]}},{key:"getVertexList",value:function(){for(var e=[this.vertices.length],t=0;t<this.vertices.length;t++)e[t]=this.vertices[t].id;return e}},{key:"getEdgeList",value:function(){for(var e=Array(this.edges.length),t=0;t<this.edges.length;t++)e[t]=[this.edges[t].sourceId,this.edges[t].targetId];return e}},{key:"getAdjacencyMatrix",value:function(){for(var e=this.vertices.length,t=Array(e),n=0;n<e;n++)t[n]=Array(e),t[n].fill(0);for(var n=0,i;n<this.edges.length;n++)i=this.edges[n],t[i.sourceId][i.targetId]=1,t[i.targetId][i.sourceId]=1;return t}},{key:"getComponentsAdjacencyMatrix",value:function(){for(var e=this.vertices.length,t=Array(e),n=this.getBridges(),a=0;a<e;a++)t[a]=Array(e),t[a].fill(0);for(var a=0,i;a<this.edges.length;a++)i=this.edges[a],t[i.sourceId][i.targetId]=1,t[i.targetId][i.sourceId]=1;for(var a=0;a<n.length;a++)t[n[a][0]][n[a][1]]=0,t[n[a][1]][n[a][0]]=0;return t}},{key:"getSubgraphAdjacencyMatrix",value:function(e){for(var t=e.length,n=Array(t),a=0;a<t;a++){n[a]=Array(t),n[a].fill(0);for(var i=0;i<t;i++)a!==i&&this.hasEdge(e[a],e[i])&&(n[a][i]=1)}return n}},{key:"getDistanceMatrix",value:function(){for(var e=this.vertices.length,t=this.getAdjacencyMatrix(),n=Array(e),a=0;a<e;a++)n[a]=Array(e),n[a].fill(Infinity);for(var a=0;a<e;a++)for(var i=0;i<e;i++)1===t[a][i]&&(n[a][i]=1);for(var r=0;r<e;r++)for(var a=0;a<e;a++)for(var i=0;i<e;i++)n[a][i]>n[a][r]+n[r][i]&&(n[a][i]=n[a][r]+n[r][i]);return n}},{key:"getSubgraphDistanceMatrix",value:function(e){for(var t=e.length,n=this.getSubgraphAdjacencyMatrix(e),a=Array(t),r=0;r<t;r++)a[r]=Array(t),a[r].fill(Infinity);for(var r=0;r<t;r++)for(var i=0;i<t;i++)1===n[r][i]&&(a[r][i]=1);for(var o=0;o<t;o++)for(var r=0;r<t;r++)for(var i=0;i<t;i++)a[r][i]>a[r][o]+a[o][i]&&(a[r][i]=a[r][o]+a[o][i]);return a}},{key:"getAdjacencyList",value:function(){for(var e=this.vertices.length,t=Array(e),n=0;n<e;n++){t[n]=[];for(var i=0;i<e;i++)n!==i&&this.hasEdge(this.vertices[n].id,this.vertices[i].id)&&t[n].push(i)}return t}},{key:"getSubgraphAdjacencyList",value:function(e){for(var t=e.length,n=Array(t),a=0;a<t;a++){n[a]=[];for(var i=0;i<t;i++)a!==i&&this.hasEdge(e[a],e[i])&&n[a].push(i)}return n}},{key:"getBridges",value:function(){var e=this.vertices.length,t=Array(e),n=Array(e),a=Array(e),r=Array(e),o=this.getAdjacencyList(),l=[];t.fill(!1),r.fill(null),this._time=0;for(var s=0;s<e;s++)t[s]||this._bridgeDfs(s,t,n,a,r,o,l);return l}},{key:"traverseBF",value:function(e,t){var n=this.vertices.length,a=Array(n);a.fill(!1);for(var r=[e];0<r.length;){var o=r.shift(),l=this.vertices[o];t(l);for(var s=0,i;s<l.neighbours.length;s++)i=l.neighbours[s],a[i]||(a[i]=!0,r.push(i))}}},{key:"getTreeDepth",value:function(e,t){if(null===e||null===t)return 0;for(var n=this.vertices[e].getSpanningTreeNeighbours(t),a=0,r=0;r<n.length;r++){var i=n[r],o=this.getTreeDepth(i,e);o>a&&(a=o)}return a+1}},{key:"traverseTree",value:function(e,t,n){var a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:Number.MAX_SAFE_INTEGER,r=4<arguments.length&&void 0!==arguments[4]&&arguments[4],o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:1,l=6<arguments.length&&void 0!==arguments[6]?arguments[6]:null;if(null===l&&(l=new Uint8Array(this.vertices.length)),!(o>a+1||1===l[e])){l[e]=1;var s=this.vertices[e],g=s.getNeighbours(t);(!r||1<o)&&n(s);for(var d=0;d<g.length;d++)this.traverseTree(g[d],e,n,a,r,o+1,l)}}},{key:"kkLayout",value:function(e,t,n,l,g,d){for(var h=d,c=e.length;c--;)for(var i=this.vertices[e[c]],p=i.neighbours.length,v;p--;)v=this.vertices[i.neighbours[p]],0===v.value.rings.length&&-1===e.indexOf(v.id)&&(e.push(v.id),t.push([v.id,i.id]));var f=this.getSubgraphDistanceMatrix(e),y=e.length,m=u.default.polyCircumradius(500,y),b=u.default.centralAngle(y),x=0,a=new Float32Array(y),S=new Float32Array(y),k=Array(y);for(c=y;c--;){var C=this.vertices[e[c]];C.positioned?(a[c]=C.position.x,S[c]=C.position.y):(a[c]=n.x+Math.cos(x)*m,S[c]=n.y+Math.sin(x)*m),k[c]=C.positioned,x+=b}var R=Array(y);for(c=y;c--;){R[c]=Array(y);for(var p=y;p--;)R[c][p]=d*f[c][p]}var A=Array(y);for(c=y;c--;){A[c]=Array(y);for(var p=y;p--;)A[c][p]=h*r(f[c][p],-2)}var P=Array(y),T=new Float32Array(y),j=new Float32Array(y);for(c=y;c--;)P[c]=Array(y);c=y;for(var I,w,L,B,N,E,_;c--;){I=a[c],w=S[c],L=0,B=0;for(var O=y;O--;)c!==O&&(N=a[O],E=S[O],_=1/o((I-N)*(I-N)+(w-E)*(w-E)),P[c][O]=[A[c][O]*(I-N-R[c][O]*(I-N)*_),A[c][O]*(w-E-R[c][O]*(w-E)*_)],P[O][c]=P[c][O],L+=P[c][O][0],B+=P[c][O][1]);T[c]=L,j[c]=B}for(var D=function(e){return[T[e]*T[e]+j[e]*j[e],T[e],j[e]]},V=function(){var e=0,t=0,n=0,i=0;for(c=y;c--;){var a=D(c),r=s(a,3),o=r[0],l=r[1],g=r[2];o>e&&!1===k[c]&&(e=o,t=c,n=l,i=g)}return[t,e,n,i]},z=function(e,t,n){var i=0,s=0,g=0,d=a[e],u=S[e],h=R[e],p=A[e];for(c=y;c--;)if(c!==e){var v=a[c],f=S[c],b=h[c],l=p[c],x=(d-v)*(d-v),m=1/r(x+(u-f)*(u-f),1.5);i+=l*(1-b*(u-f)*(u-f)*m),s+=l*(1-b*x*m),g+=l*(b*(d-v)*(u-f)*m)}0==i&&(i=0.1),0==s&&(s=0.1),0==g&&(g=0.1);var k=t/i+n/g;k/=g/i-s/g;var C=-(g*k+t)/i;a[e]+=C,S[e]+=k;var I=P[e];t=0,n=0,d=a[e],u=S[e];var w,L,B,N,E;for(c=y;c--;)e!==c&&(w=a[c],L=S[c],B=I[c][0],N=I[c][1],E=1/o((d-w)*(d-w)+(u-L)*(u-L)),C=p[c]*(d-w-h[c]*(d-w)*E),k=p[c]*(u-L-h[c]*(u-L)*E),I[c]=[C,k],t+=C,n+=k,T[c]+=C-B,j[c]+=k-N);T[e]=t,j[e]=n},F=1e9,H=0,W=0,M=0,q=0,U=0,G=0;F>0.1&&1e3>U;){U++;var X=V(),Y=s(X,4);for(H=Y[0],F=Y[1],W=Y[2],M=Y[3],q=F,G=0;q>0.1&&50>G;){G++,z(H,W,M);var K=D(H),Z=s(K,3);q=Z[0],W=Z[1],M=Z[2]}}for(c=y;c--;){var $=e[c],Q=this.vertices[$];Q.position.x=a[c],Q.position.y=S[c],Q.positioned=!0,Q.forcePositioned=!0}}},{key:"_bridgeDfs",value:function(e,t,n,a,r,o,s){t[e]=!0,n[e]=a[e]=++this._time;for(var g=0,i;g<o[e].length;g++)i=o[e][g],t[i]?i!==r[e]&&(a[e]=l(a[e],n[i])):(r[i]=e,this._bridgeDfs(i,t,n,a,r,o,s),a[e]=l(a[e],a[i]),a[i]>n[e]&&s.push([e,i]))}}],[{key:"getConnectedComponents",value:function(t){var n=t.length,i=Array(n),a=[],r=0;i.fill(!1);for(var o=0;o<n;o++)if(!i[o]){var l=[];i[o]=!0,l.push(o),r++,e._ccGetDfs(o,i,t,l),1<l.length&&a.push(l)}return a}},{key:"getConnectedComponentCount",value:function(t){var n=t.length,i=Array(n),a=0;i.fill(!1);for(var r=0;r<n;r++)i[r]||(i[r]=!0,a++,e._ccCountDfs(r,i,t));return a}},{key:"_ccCountDfs",value:function(t,n,i){for(var a=0,r;a<i[t].length;a++)(r=i[t][a],r&&!n[a]&&t!==a)&&(n[a]=!0,e._ccCountDfs(a,n,i))}},{key:"_ccGetDfs",value:function(t,n,i,a){for(var r=0,o;r<i[t].length;r++)(o=i[t][r],o&&!n[r]&&t!==r)&&(n[r]=!0,a.push(r),e._ccGetDfs(r,n,i,a))}}]),e}();n.default=S},{"./Atom":3,"./Edge":6,"./MathHelper":9,"./Ring":11,"./Vector2":14,"./Vertex":15}],8:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=Math.pow;Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0,i;n<t.length;n++)i=t[n],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=e("./Vector2"),l=function(e){return e&&e.__esModule?e:{default:e}}(o),s=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new l.default(0,0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new l.default(0,0),a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,o=4<arguments.length&&void 0!==arguments[4]&&arguments[4],s=5<arguments.length&&void 0!==arguments[5]&&arguments[5];i(this,e),this.from=t,this.to=n,this.elementFrom=a,this.elementTo=r,this.chiralFrom=o,this.chiralTo=s}return r(e,[{key:"clone",value:function(){return new e(this.from.clone(),this.to.clone(),this.elementFrom,this.elementTo)}},{key:"getLength",value:function(){return Math.sqrt(a(this.to.x-this.from.x,2)+a(this.to.y-this.from.y,2))}},{key:"getAngle",value:function(){var e=l.default.subtract(this.getRightVector(),this.getLeftVector());return e.angle()}},{key:"getRightVector",value:function(){return this.from.x<this.to.x?this.to:this.from}},{key:"getLeftVector",value:function(){return this.from.x<this.to.x?this.from:this.to}},{key:"getRightElement",value:function(){return this.from.x<this.to.x?this.elementTo:this.elementFrom}},{key:"getLeftElement",value:function(){return this.from.x<this.to.x?this.elementFrom:this.elementTo}},{key:"getRightChiral",value:function(){return this.from.x<this.to.x?this.chiralTo:this.chiralFrom}},{key:"getLeftChiral",value:function(){return this.from.x<this.to.x?this.chiralFrom:this.chiralTo}},{key:"setRightVector",value:function(e,t){return this.from.x<this.to.x?(this.to.x=e,this.to.y=t):(this.from.x=e,this.from.y=t),this}},{key:"setLeftVector",value:function(e,t){return this.from.x<this.to.x?(this.from.x=e,this.from.y=t):(this.to.x=e,this.to.y=t),this}},{key:"rotateToXAxis",value:function(){var e=this.getLeftVector();return this.setRightVector(e.x+this.getLength(),e.y),this}},{key:"rotate",value:function(e){var t=this.getLeftVector(),n=this.getRightVector(),i=Math.sin(e),a=Math.cos(e),r=a*(n.x-t.x)-i*(n.y-t.y)+t.x,o=i*(n.x-t.x)-a*(n.y-t.y)+t.y;return this.setRightVector(r,o),this}},{key:"shortenFrom",value:function(e){var t=l.default.subtract(this.to,this.from);return t.normalize(),t.multiplyScalar(e),this.from.add(t),this}},{key:"shortenTo",value:function(e){var t=l.default.subtract(this.from,this.to);return t.normalize(),t.multiplyScalar(e),this.to.add(t),this}},{key:"shortenRight",value:function(e){return this.from.x<this.to.x?this.shortenTo(e):this.shortenFrom(e),this}},{key:"shortenLeft",value:function(e){return this.from.x<this.to.x?this.shortenFrom(e):this.shortenTo(e),this}},{key:"shorten",value:function(e){var t=l.default.subtract(this.from,this.to);return t.normalize(),t.multiplyScalar(e/2),this.to.add(t),this.from.subtract(t),this}}]),e}();n.default=s},{"./Vector2":14}],9:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=Math.sin,o=Math.cos,l=Math.PI;Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0,i;n<t.length;n++)i=t[n],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=function(){function e(){i(this,e)}return r(e,null,[{key:"round",value:function(e,t){return t=t?t:1,+(Math.round(e+"e"+t)+"e-"+t)}},{key:"meanAngle",value:function(e){for(var t=0,n=0,r=0;r<e.length;r++)t+=a(e[r]),n+=o(e[r]);return Math.atan2(t/e.length,n/e.length)}},{key:"innerAngle",value:function(t){return e.toRad(180*(t-2)/t)}},{key:"polyCircumradius",value:function(e,t){return e/(2*a(l/t))}},{key:"apothem",value:function(e,t){return e*o(l/t)}},{key:"apothemFromSideLength",value:function(t,i){var n=e.polyCircumradius(t,i);return e.apothem(n,i)}},{key:"centralAngle",value:function(t){return e.toRad(360/t)}},{key:"toDeg",value:function(t){return t*e.degFactor}},{key:"toRad",value:function(t){return t*e.radFactor}},{key:"parityOfPermutation",value:function(e){for(var t=new Uint8Array(e.length),n=0,a=function n(a){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return 1===t[a]?i:(i++,t[a]=1,n(e[a],i))},r=0;r<e.length;r++)if(1!==t[r]){var i=a(r);n+=1-i%2}return n%2?-1:1}},{key:"radFactor",get:function(){return l/180}},{key:"degFactor",get:function(){return 180/l}},{key:"twoPI",get:function(){return 2*l}}]),e}();n.default=s},{}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(){function e(t,n,i,a){this.message=t,this.expected=n,this.found=i,this.location=a,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}return function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}(e,Error),{SyntaxError:e,parse:function(t){function n(e){var n=tt[e],i,a;if(n)return n;for(i=e-1;!tt[i];)i--;for(n=tt[i],n={line:n.line,column:n.column,seenCR:n.seenCR};i<e;)a=t.charAt(i),"\n"===a?(!n.seenCR&&n.line++,n.column=1,n.seenCR=!1):"\r"===a||"\u2028"===a||"\u2029"===a?(n.line++,n.column=1,n.seenCR=!0):(n.column++,n.seenCR=!1),i++;return tt[e]=n,n}function i(e,t){var i=n(e),a=n(t);return{start:{offset:e,line:i.line,column:i.column},end:{offset:t,line:a.line,column:a.column}}}function a(e){Je<nt||(Je>nt&&(nt=Je,it=[]),it.push(e))}function r(){var e,t,n,i,a,g,d,u,h,c;if(e=Je,t=Je,n=l(),n!==R){for(i=[],a=o();a!==R;)i.push(a),a=o();if(i!==R){for(a=[],g=Je,d=s(),d===R&&(d=null),d===R?(Je=g,g=R):(u=p(),u===R?(Je=g,g=R):(d=[d,u],g=d));g!==R;)a.push(g),g=Je,d=s(),d===R&&(d=null),d===R?(Je=g,g=R):(u=p(),u===R?(Je=g,g=R):(d=[d,u],g=d));if(a!==R){for(g=[],d=o();d!==R;)g.push(d),d=o();if(g===R)Je=t,t=R;else if(d=s(),d===R&&(d=null),d===R)Je=t,t=R;else if(u=r(),u===R&&(u=null),u!==R){for(h=[],c=o();c!==R;)h.push(c),c=o();h===R?(Je=t,t=R):(n=[n,i,a,g,d,u,h],t=n)}else Je=t,t=R}else Je=t,t=R}else Je=t,t=R}else Je=t,t=R;return t!==R&&(et=e,t=T(t)),e=t,e}function o(){var e,n,i,o,l,g;return e=Je,n=Je,40===t.charCodeAt(Je)?(i=j,Je++):(i=R,a(I)),i===R?(Je=n,n=R):(o=s(),o===R&&(o=null),o===R?(Je=n,n=R):(l=r(),l===R?(Je=n,n=R):(41===t.charCodeAt(Je)?(g=w,Je++):(g=R,a(L)),g===R?(Je=n,n=R):(i=[i,o,l,g],n=i)))),n!==R&&(et=e,n=B(n)),e=n,e}function l(){var e,t;return e=Je,t=d(),t===R&&(t=u(),t===R&&(t=g(),t===R&&(t=h()))),t!==R&&(et=e,t=N(t)),e=t,e}function s(){var e,n;return e=Je,E.test(t.charAt(Je))?(n=t.charAt(Je),Je++):(n=R,a(_)),n!==R&&(et=e,n=O(n)),e=n,e}function g(){var e,n,i,r,o,l,s,g,d,p;return e=Je,n=Je,91===t.charCodeAt(Je)?(i=D,Je++):(i=R,a(V)),i===R?(Je=n,n=R):(r=k(),r===R&&(r=null),r===R?(Je=n,n=R):(t.substr(Je,2)===z?(o=z,Je+=2):(o=R,a(F)),o===R&&(t.substr(Je,2)===H?(o=H,Je+=2):(o=R,a(W)),o===R&&(o=u(),o===R&&(o=c(),o===R&&(o=h())))),o===R?(Je=n,n=R):(l=v(),l===R&&(l=null),l===R?(Je=n,n=R):(s=b(),s===R&&(s=null),s===R?(Je=n,n=R):(g=f(),g===R&&(g=null),g===R?(Je=n,n=R):(d=x(),d===R&&(d=null),d===R?(Je=n,n=R):(93===t.charCodeAt(Je)?(p=M,Je++):(p=R,a(q)),p===R?(Je=n,n=R):(i=[i,r,o,l,s,g,d,p],n=i)))))))),n!==R&&(et=e,n=U(n)),e=n,e}function d(){var e,n,i,r;return e=Je,n=Je,66===t.charCodeAt(Je)?(i=G,Je++):(i=R,a(X)),i===R?(Je=n,n=R):(114===t.charCodeAt(Je)?(r=Y,Je++):(r=R,a(K)),r===R&&(r=null),r===R?(Je=n,n=R):(i=[i,r],n=i)),n===R&&(n=Je,67===t.charCodeAt(Je)?(i=Z,Je++):(i=R,a($)),i===R?(Je=n,n=R):(108===t.charCodeAt(Je)?(r=Q,Je++):(r=R,a(J)),r===R&&(r=null),r===R?(Je=n,n=R):(i=[i,r],n=i)),n===R&&(ee.test(t.charAt(Je))?(n=t.charAt(Je),Je++):(n=R,a(te)))),n!==R&&(et=e,n=ne(n)),e=n,e}function u(){var e,n;return e=Je,ie.test(t.charAt(Je))?(n=t.charAt(Je),Je++):(n=R,a(ae)),n!==R&&(et=e,n=N(n)),e=n,e}function h(){var e,n;return e=Je,42===t.charCodeAt(Je)?(n=re,Je++):(n=R,a(oe)),n!==R&&(et=e,n=le(n)),e=n,e}function c(){var e,n,i,r;return e=Je,n=Je,se.test(t.charAt(Je))?(i=t.charAt(Je),Je++):(i=R,a(ge)),i===R?(Je=n,n=R):(de.test(t.charAt(Je))?(r=t.charAt(Je),Je++):(r=R,a(ue)),r===R&&(r=null),r===R?(Je=n,n=R):(i=[i,r],n=i)),n!==R&&(et=e,n=he(n)),e=n,e}function p(){var e,n,i,r,o;return e=Je,n=Je,37===t.charCodeAt(Je)?(i=ce,Je++):(i=R,a(pe)),i===R?(Je=n,n=R):(ve.test(t.charAt(Je))?(r=t.charAt(Je),Je++):(r=R,a(fe)),r===R?(Je=n,n=R):(ye.test(t.charAt(Je))?(o=t.charAt(Je),Je++):(o=R,a(me)),o===R?(Je=n,n=R):(i=[i,r,o],n=i))),n===R&&(ye.test(t.charAt(Je))?(n=t.charAt(Je),Je++):(n=R,a(me))),n!==R&&(et=e,n=be(n)),e=n,e}function v(){var e,n,i,r,o,l,s;return e=Je,n=Je,64===t.charCodeAt(Je)?(i=xe,Je++):(i=R,a(ke)),i===R?(Je=n,n=R):(64===t.charCodeAt(Je)?(r=xe,Je++):(r=R,a(ke)),r===R&&(r=Je,t.substr(Je,2)===Se?(o=Se,Je+=2):(o=R,a(Ce)),o===R?(Je=r,r=R):(Re.test(t.charAt(Je))?(l=t.charAt(Je),Je++):(l=R,a(Ae)),l===R?(Je=r,r=R):(o=[o,l],r=o)),r===R&&(r=Je,t.substr(Je,2)===Pe?(o=Pe,Je+=2):(o=R,a(Te)),o===R?(Je=r,r=R):(Re.test(t.charAt(Je))?(l=t.charAt(Je),Je++):(l=R,a(Ae)),l===R?(Je=r,r=R):(o=[o,l],r=o)),r===R&&(r=Je,t.substr(Je,2)===je?(o=je,Je+=2):(o=R,a(Ie)),o===R?(Je=r,r=R):(we.test(t.charAt(Je))?(l=t.charAt(Je),Je++):(l=R,a(Le)),l===R?(Je=r,r=R):(o=[o,l],r=o)),r===R&&(r=Je,t.substr(Je,2)===Be?(o=Be,Je+=2):(o=R,a(Ne)),o===R?(Je=r,r=R):(ve.test(t.charAt(Je))?(l=t.charAt(Je),Je++):(l=R,a(fe)),l===R?(Je=r,r=R):(ye.test(t.charAt(Je))?(s=t.charAt(Je),Je++):(s=R,a(me)),s===R&&(s=null),s===R?(Je=r,r=R):(o=[o,l,s],r=o))),r===R&&(r=Je,t.substr(Je,2)===Ee?(o=Ee,Je+=2):(o=R,a(_e)),o===R?(Je=r,r=R):(ve.test(t.charAt(Je))?(l=t.charAt(Je),Je++):(l=R,a(fe)),l===R?(Je=r,r=R):(ye.test(t.charAt(Je))?(s=t.charAt(Je),Je++):(s=R,a(me)),s===R&&(s=null),s===R?(Je=r,r=R):(o=[o,l,s],r=o)))))))),r===R&&(r=null),r===R?(Je=n,n=R):(i=[i,r],n=i)),n!==R&&(et=e,n=Oe(n)),e=n,e}function f(){var e,t;return e=Je,t=y(),t===R&&(t=m()),t!==R&&(et=e,t=De(t)),e=t,e}function y(){var e,n,i,r,o,l;return e=Je,n=Je,43===t.charCodeAt(Je)?(i=Ve,Je++):(i=R,a(ze)),i===R?(Je=n,n=R):(43===t.charCodeAt(Je)?(r=Ve,Je++):(r=R,a(ze)),r===R&&(r=Je,ve.test(t.charAt(Je))?(o=t.charAt(Je),Je++):(o=R,a(fe)),o===R?(Je=r,r=R):(ye.test(t.charAt(Je))?(l=t.charAt(Je),Je++):(l=R,a(me)),l===R&&(l=null),l===R?(Je=r,r=R):(o=[o,l],r=o))),r===R&&(r=null),r===R?(Je=n,n=R):(i=[i,r],n=i)),n!==R&&(et=e,n=Fe(n)),e=n,e}function m(){var e,n,i,r,o,l;return e=Je,n=Je,45===t.charCodeAt(Je)?(i=He,Je++):(i=R,a(We)),i===R?(Je=n,n=R):(45===t.charCodeAt(Je)?(r=He,Je++):(r=R,a(We)),r===R&&(r=Je,ve.test(t.charAt(Je))?(o=t.charAt(Je),Je++):(o=R,a(fe)),o===R?(Je=r,r=R):(ye.test(t.charAt(Je))?(l=t.charAt(Je),Je++):(l=R,a(me)),l===R&&(l=null),l===R?(Je=r,r=R):(o=[o,l],r=o))),r===R&&(r=null),r===R?(Je=n,n=R):(i=[i,r],n=i)),n!==R&&(et=e,n=Me(n)),e=n,e}function b(){var e,n,i,r;return e=Je,n=Je,72===t.charCodeAt(Je)?(i=qe,Je++):(i=R,a(Ue)),i===R?(Je=n,n=R):(ye.test(t.charAt(Je))?(r=t.charAt(Je),Je++):(r=R,a(me)),r===R&&(r=null),r===R?(Je=n,n=R):(i=[i,r],n=i)),n!==R&&(et=e,n=Ge(n)),e=n,e}function x(){var e,n,i,r,o,l,s;if(e=Je,n=Je,58===t.charCodeAt(Je)?(i=Xe,Je++):(i=R,a(Ye)),i!==R){if(r=Je,ve.test(t.charAt(Je))?(o=t.charAt(Je),Je++):(o=R,a(fe)),o!==R){for(l=[],ye.test(t.charAt(Je))?(s=t.charAt(Je),Je++):(s=R,a(me));s!==R;)l.push(s),ye.test(t.charAt(Je))?(s=t.charAt(Je),Je++):(s=R,a(me));l===R?(Je=r,r=R):(o=[o,l],r=o)}else Je=r,r=R;r===R&&(Ke.test(t.charAt(Je))?(r=t.charAt(Je),Je++):(r=R,a(Ze))),r===R?(Je=n,n=R):(i=[i,r],n=i)}else Je=n,n=R;return n!==R&&(et=e,n=$e(n)),e=n,e}function k(){var e,n,i,r,o;return e=Je,n=Je,ve.test(t.charAt(Je))?(i=t.charAt(Je),Je++):(i=R,a(fe)),i===R?(Je=n,n=R):(ye.test(t.charAt(Je))?(r=t.charAt(Je),Je++):(r=R,a(me)),r===R&&(r=null),r===R?(Je=n,n=R):(ye.test(t.charAt(Je))?(o=t.charAt(Je),Je++):(o=R,a(me)),o===R&&(o=null),o===R?(Je=n,n=R):(i=[i,r,o],n=i))),n!==R&&(et=e,n=Qe(n)),e=n,e}var S=1<arguments.length?arguments[1]:{},C=this,R={},A={chain:r},P=r,T=function(e){for(var t=[],n=[],a=0;a<e[1].length;a++)t.push(e[1][a]);for(var a=0,i;a<e[2].length;a++)i=e[2][a][0]?e[2][a][0]:"-",n.push({bond:i,id:e[2][a][1]});for(var a=0;a<e[3].length;a++)t.push(e[3][a]);for(var a=0;a<e[6].length;a++)t.push(e[6][a]);return{atom:e[0],isBracket:!!e[0].element,branches:t,branchCount:t.length,ringbonds:n,ringbondCount:n.length,bond:e[4]?e[4]:"-",next:e[5],hasNext:!!e[5]}},j="(",I={type:"literal",value:"(",description:"\"(\""},w=")",L={type:"literal",value:")",description:"\")\""},B=function(e){var t=e[1]?e[1]:"-";return e[2].branchBond=t,e[2]},N=function(e){return e},E=/^[\-=#$:\/\\.]/,_={type:"class",value:"[-=#$:/\\\\.]",description:"[-=#$:/\\\\.]"},O=function(e){return e},D="[",V={type:"literal",value:"[",description:"\"[\""},z="se",F={type:"literal",value:"se",description:"\"se\""},H="as",W={type:"literal",value:"as",description:"\"as\""},M="]",q={type:"literal",value:"]",description:"\"]\""},U=function(e){return{isotope:e[1],element:e[2],chirality:e[3],hcount:e[4],charge:e[5],class:e[6]}},G="B",X={type:"literal",value:"B",description:"\"B\""},Y="r",K={type:"literal",value:"r",description:"\"r\""},Z="C",$={type:"literal",value:"C",description:"\"C\""},Q="l",J={type:"literal",value:"l",description:"\"l\""},ee=/^[NOPSFI]/,te={type:"class",value:"[NOPSFI]",description:"[NOPSFI]"},ne=function(e){return 1<e.length?e.join(""):e},ie=/^[bcnops]/,ae={type:"class",value:"[bcnops]",description:"[bcnops]"},re="*",oe={type:"literal",value:"*",description:"\"*\""},le=function(e){return e},se=/^[A-Z]/,ge={type:"class",value:"[A-Z]",description:"[A-Z]"},de=/^[a-z]/,ue={type:"class",value:"[a-z]",description:"[a-z]"},he=function(t){return t.join("")},ce="%",pe={type:"literal",value:"%",description:"\"%\""},ve=/^[1-9]/,fe={type:"class",value:"[1-9]",description:"[1-9]"},ye=/^[0-9]/,me={type:"class",value:"[0-9]",description:"[0-9]"},be=function(e){return 1==e.length?+e:+e.join("").replace("%","")},xe="@",ke={type:"literal",value:"@",description:"\"@\""},Se="TH",Ce={type:"literal",value:"TH",description:"\"TH\""},Re=/^[12]/,Ae={type:"class",value:"[12]",description:"[12]"},Pe="AL",Te={type:"literal",value:"AL",description:"\"AL\""},je="SP",Ie={type:"literal",value:"SP",description:"\"SP\""},we=/^[1-3]/,Le={type:"class",value:"[1-3]",description:"[1-3]"},Be="TB",Ne={type:"literal",value:"TB",description:"\"TB\""},Ee="OH",_e={type:"literal",value:"OH",description:"\"OH\""},Oe=function(e){return e[1]?"@"==e[1]?"@@":e[1].join("").replace(",",""):"@"},De=function(e){return e},Ve="+",ze={type:"literal",value:"+",description:"\"+\""},Fe=function(e){return e[1]?"+"==e[1]?2:+e[1].join(""):1},He="-",We={type:"literal",value:"-",description:"\"-\""},Me=function(e){return e[1]?"-"==e[1]?-2:-+e[1].join(""):-1},qe="H",Ue={type:"literal",value:"H",description:"\"H\""},Ge=function(e){return e[1]?+e[1]:1},Xe=":",Ye={type:"literal",value:":",description:"\":\""},Ke=/^[0]/,Ze={type:"class",value:"[0]",description:"[0]"},$e=function(e){return+(e[1][0]+e[1][1].join(""))},Qe=function(e){return+e.join("")},Je=0,et=0,tt=[{line:1,column:1,seenCR:!1}],nt=0,it=[],at;if("startRule"in S){if(!(S.startRule in A))throw new Error("Can't start parsing from rule \""+S.startRule+"\".");P=A[S.startRule]}if(at=P(),at!==R&&Je===t.length)return at;throw at!==R&&Je<t.length&&a({type:"end",description:"end of input"}),function(t,n,i,a){return null!==n&&function(e){var t=1;for(e.sort(function(e,t){return e.description<t.description?-1:e.description>t.description?1:0});t<e.length;)e[t-1]===e[t]?e.splice(t,1):t++}(n),new e(null===t?function(e,t){var n=Array(e.length),a,r,o;for(o=0;o<e.length;o++)n[o]=e[o].description;return a=1<e.length?n.slice(0,-1).join(", ")+" or "+n[e.length-1]:n[0],r=t?"\""+function(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,"\\\"").replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+t(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+t(e)}).replace(/[\u0100-\u0FFF]/g,function(e){return"\\u0"+t(e)}).replace(/[\u1000-\uFFFF]/g,function(e){return"\\u"+t(e)})}(t)+"\"":"end of input","Expected "+a+" but "+r+" found."}(n,i):t,n,i,a)}(null,it,nt<t.length?t.charAt(nt):null,nt<t.length?i(nt,nt+1):i(nt,nt))}}}()},{}],11:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0,i;n<t.length;n++)i=t[n],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=e("./ArrayHelper"),l=i(o),s=e("./Vector2"),g=i(s),d=e("./Vertex"),u=i(d),h=e("./RingConnection"),c=i(h),p=function(){function e(t){a(this,e),this.id=null,this.members=t,this.edges=[],this.insiders=[],this.neighbours=[],this.positioned=!1,this.center=new g.default(0,0),this.rings=[],this.isBridged=!1,this.isPartOfBridged=!1,this.isSpiro=!1,this.isFused=!1,this.centralAngle=0,this.canFlip=!0}return r(e,[{key:"clone",value:function(){var t=new e(this.members);return t.id=this.id,t.insiders=l.default.clone(this.insiders),t.neighbours=l.default.clone(this.neighbours),t.positioned=this.positioned,t.center=this.center.clone(),t.rings=l.default.clone(this.rings),t.isBridged=this.isBridged,t.isPartOfBridged=this.isPartOfBridged,t.isSpiro=this.isSpiro,t.isFused=this.isFused,t.centralAngle=this.centralAngle,t.canFlip=this.canFlip,t}},{key:"getSize",value:function(){return this.members.length}},{key:"getPolygon",value:function(e){for(var t=[],n=0;n<this.members.length;n++)t.push(e[this.members[n]].position);return t}},{key:"getAngle",value:function(){return Math.PI-this.centralAngle}},{key:"eachMember",value:function(e,t,n,i){n=n||0===n?n:this.members[0];for(var a=n,r=0,o;null!=a&&100>r;)o=a,t(o),a=e[a].getNextInRing(e,this.id,i),i=o,a==n&&(a=null),r++}},{key:"getOrderedNeighbours",value:function(e){for(var t=Array(this.neighbours.length),n=0,i;n<this.neighbours.length;n++)i=c.default.getVertices(e,this.id,this.neighbours[n]),t[n]={n:i.length,neighbour:this.neighbours[n]};return t.sort(function(e,t){return t.n-e.n}),t}},{key:"isBenzeneLike",value:function(e){var t=this.getDoubleBondCount(e),n=this.members.length;return 3===t&&6===n||2===t&&5===n}},{key:"getDoubleBondCount",value:function(e){for(var t=0,n=0,i;n<this.members.length;n++)i=e[this.members[n]].value,("="===i.bondType||"="===i.branchBond)&&t++;return t}},{key:"contains",value:function(e){for(var t=0;t<this.members.length;t++)if(this.members[t]==e)return!0;return!1}}]),e}();n.default=p},{"./ArrayHelper":2,"./RingConnection":12,"./Vector2":14,"./Vertex":15}],12:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0,i;n<t.length;n++)i=t[n],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),l=e("./Vertex"),s=i(l),g=e("./Ring"),d=i(g),u=function(){function e(t,i){r(this,e),this.id=null,this.firstRingId=t.id,this.secondRingId=i.id,this.vertices=new Set;for(var a=0,o;a<t.members.length;a++){o=t.members[a];for(var l=0,n;l<i.members.length;l++)n=i.members[l],o===n&&this.addVertex(o)}}return o(e,[{key:"addVertex",value:function(e){this.vertices.add(e)}},{key:"updateOther",value:function(e,t){this.firstRingId===t?this.secondRingId=e:this.firstRingId=e}},{key:"containsRing",value:function(e){return this.firstRingId===e||this.secondRingId===e}},{key:"isBridge",value:function(e){if(2<this.vertices.size)return!0;var t=!0,n=!1,i;try{for(var a=this.vertices[Symbol.iterator](),r,o;!(t=(r=a.next()).done);t=!0)if(o=r.value,2<e[o].value.rings.length)return!0}catch(e){n=!0,i=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw i}}return!1}}],[{key:"isBridge",value:function(e,t,n,a){for(var r=null,o=0;o<e.length;o++)if(r=e[o],r.firstRingId===n&&r.secondRingId===a||r.firstRingId===a&&r.secondRingId===n)return r.isBridge(t);return!1}},{key:"getNeighbours",value:function(e,t){for(var n=[],a=0,i;a<e.length;a++)i=e[a],i.firstRingId===t?n.push(i.secondRingId):i.secondRingId===t&&n.push(i.firstRingId);return n}},{key:"getVertices",value:function(e,t,n){for(var r=0,i;r<e.length;r++)if(i=e[r],i.firstRingId===t&&i.secondRingId===n||i.firstRingId===n&&i.secondRingId===t)return[].concat(a(i.vertices))}}]),e}();n.default=u},{"./Ring":11,"./Vertex":15}],13:[function(e,t,n){"use strict";function a(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0,i;n<t.length;n++)i=t[n],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=e("./Graph"),l=function(e){return e&&e.__esModule?e:{default:e}}(o),s=function(){function e(){i(this,e)}return r(e,null,[{key:"getRings",value:function(t){var n=t.getComponentsAdjacencyMatrix();if(0===n.length)return null;for(var r=l.default.getConnectedComponents(n),o=[],s=0;s<r.length;s++){for(var i=r[s],g=t.getSubgraphAdjacencyMatrix([].concat(a(i))),u=Array(g.length),h=Array(g.length),p=0;p<g.length;p++){h[p]=0,u[p]=0;for(var v=0;v<g[p].length;v++)u[p]+=g[p][v]}for(var f=e.getEdgeList(g).length,y=f-g.length+1,m=!0,p=0;p<u.length;p++)3!==u[p]&&(m=!1);m&&(y=2+f-g.length);for(var b=e.getPathIncludedDistanceMatrices(g),x=b.d,d=b.pe,k=b.pe_prime,S=e.getRingCandidates(x,d,k),c=e.getSSSR(S,x,g,d,k,u,h,y),C=0;C<c.length;C++){var R=Array(c[C].size),A=0,P=!0,T=!1,j=void 0;try{for(var I=c[C][Symbol.iterator](),w,L;!(P=(w=I.next()).done);P=!0)L=w.value,R[A++]=i[L]}catch(e){T=!0,j=e}finally{try{!P&&I.return&&I.return()}finally{if(T)throw j}}o.push(R)}}return o}},{key:"matrixToString",value:function(e){for(var t="",n=0;n<e.length;n++){for(var i=0;i<e[n].length;i++)t+=e[n][i]+" ";t+="\n"}return t}},{key:"getPathIncludedDistanceMatrices",value:function(e){for(var t=e.length,a=Array(t),r=Array(t),o=Array(t),s=0,l=0,g=0,n=t;n--;){a[n]=Array(t),r[n]=Array(t),o[n]=Array(t);for(var i=t;i--;)a[n][i]=n===i||1===e[n][i]?e[n][i]:Number.POSITIVE_INFINITY,r[n][i]=1===a[n][i]?[[[n,i]]]:[],o[n][i]=[]}for(var u=t,i;u--;)for(n=t;n--;)for(i=t;i--;){var h=a[n][i],c=a[n][u]+a[u][i];if(h>c){var s,l,g;if(h===c+1)for(o[n][i]=[r[n][i].length],s=r[n][i].length;s--;)for(o[n][i][s]=[r[n][i][s].length],l=r[n][i][s].length;l--;)for(o[n][i][s][l]=[r[n][i][s][l].length],g=r[n][i][s][l].length;g--;)o[n][i][s][l][g]=[r[n][i][s][l][0],r[n][i][s][l][1]];else o[n][i]=[];for(a[n][i]=c,r[n][i]=[[]],s=r[n][u][0].length;s--;)r[n][i][0].push(r[n][u][0][s]);for(s=r[u][i][0].length;s--;)r[n][i][0].push(r[u][i][0][s])}else if(h===c){if(r[n][u].length&&r[u][i].length){var s;if(r[n][i].length){var p=[];for(s=r[n][u][0].length;s--;)p.push(r[n][u][0][s]);for(s=r[u][i][0].length;s--;)p.push(r[u][i][0][s]);r[n][i].push(p)}else{var v=[];for(s=r[n][u][0].length;s--;)v.push(r[n][u][0][s]);for(s=r[u][i][0].length;s--;)v.push(r[u][i][0][s]);r[n][i][0]=v}}}else if(h===c-1){var s;if(o[n][i].length){var f=[];for(s=r[n][u][0].length;s--;)f.push(r[n][u][0][s]);for(s=r[u][i][0].length;s--;)f.push(r[u][i][0][s]);o[n][i].push(f)}else{var y=[];for(s=r[n][u][0].length;s--;)y.push(r[n][u][0][s]);for(s=r[u][i][0].length;s--;)y.push(r[u][i][0][s]);o[n][i][0]=y}}}return{d:a,pe:r,pe_prime:o}}},{key:"getRingCandidates",value:function(e,t,n){for(var a=e.length,r=[],o=0,l=0;l<a;l++)for(var i=0;i<a;i++)if(0===e[l][i]||1===t[l][i].length&&0===n[l][i])continue;else o=0===n[l][i].length?2*e[l][i]:2*(e[l][i]+0.5),o!=Infinity&&r.push([o,t[l][i],n[l][i]]);return r.sort(function(e,t){return e[0]-t[0]}),r}},{key:"getSSSR",value:function(t,n,a,r,o,l,s,g){for(var d=[],u=[],h=0;h<t.length;h++)if(0!=t[h][0]%2)for(var i=0,c;i<t[h][2].length;i++){c=t[h][1][0].concat(t[h][2][i]);for(var p=0;p<c.length;p++)c[p][0].constructor===Array&&(c[p]=c[p][0]);var v=e.bondsToAtoms(c);if(e.getBondCount(v,a)!==v.size||e.pathSetsContain(d,v,c,u,l,s)||(d.push(v),u=u.concat(c)),d.length>g)return d}else for(var f=0,y;f<t[h][1].length-1;f++){y=t[h][1][f].concat(t[h][1][f+1]);for(var p=0;p<y.length;p++)y[p][0].constructor===Array&&(y[p]=y[p][0]);var m=e.bondsToAtoms(y);if(e.getBondCount(m,a)!==m.size||e.pathSetsContain(d,m,y,u,l,s)||(d.push(m),u=u.concat(y)),d.length>g)return d}return d}},{key:"getEdgeCount",value:function(e){for(var t=0,n=e.length,a=n-1;a--;)for(var i=n;i--;)1===e[a][i]&&t++;return t}},{key:"getEdgeList",value:function(e){for(var t=e.length,n=[],a=t-1;a--;)for(var i=t;i--;)1===e[a][i]&&n.push([a,i]);return n}},{key:"bondsToAtoms",value:function(e){for(var t=new Set,n=e.length;n--;)t.add(e[n][0]),t.add(e[n][1]);return t}},{key:"getBondCount",value:function(e,t){var n=0,i=!0,a=!1,r;try{for(var o=e[Symbol.iterator](),l;!(i=(l=o.next()).done);i=!0){var s=l.value,g=!0,d=!1,u=void 0;try{for(var h=e[Symbol.iterator](),c,p;!(g=(c=h.next()).done);g=!0)(p=c.value,s!==p)&&(n+=t[s][p])}catch(e){d=!0,u=e}finally{try{!g&&h.return&&h.return()}finally{if(d)throw u}}}}catch(e){a=!0,r=e}finally{try{!i&&o.return&&o.return()}finally{if(a)throw r}}return n/2}},{key:"pathSetsContain",value:function(t,n,a,r,o,l){for(var s=t.length;s--;){if(e.isSupersetOf(n,t[s]))return!0;if(t[s].size===n.size&&e.areSetsEqual(t[s],n))return!0}var i=0,g=!1;for(s=a.length;s--;)for(var d=r.length;d--;)(a[s][0]===r[d][0]&&a[s][1]===r[d][1]||a[s][1]===r[d][0]&&a[s][0]===r[d][1])&&i++,i===a.length&&(g=!0);var u=!1;if(g){var h=!0,c=!1,p;try{for(var v=n[Symbol.iterator](),f,y;!(h=(f=v.next()).done);h=!0)if(y=f.value,l[y]<o[y]){u=!0;break}}catch(e){c=!0,p=e}finally{try{!h&&v.return&&v.return()}finally{if(c)throw p}}}if(g&&!u)return!0;var m=!0,b=!1,x;try{for(var k=n[Symbol.iterator](),S,C;!(m=(S=k.next()).done);m=!0)C=S.value,l[C]++}catch(e){b=!0,x=e}finally{try{!m&&k.return&&k.return()}finally{if(b)throw x}}return!1}},{key:"areSetsEqual",value:function(e,t){if(e.size!==t.size)return!1;var n=!0,i=!1,a;try{for(var r=e[Symbol.iterator](),o,l;!(n=(o=r.next()).done);n=!0)if(l=o.value,!t.has(l))return!1}catch(e){i=!0,a=e}finally{try{!n&&r.return&&r.return()}finally{if(i)throw a}}return!0}},{key:"isSupersetOf",value:function(e,t){var n=!0,i=!1,a;try{for(var r=t[Symbol.iterator](),o,l;!(n=(o=r.next()).done);n=!0)if(l=o.value,!e.has(l))return!1}catch(e){i=!0,a=e}finally{try{!n&&r.return&&r.return()}finally{if(i)throw a}}return!0}}]),e}();n.default=s},{"./Graph":7}],14:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=Math.sin,r=Math.cos,o=Math.sqrt;Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0,i;n<t.length;n++)i=t[n],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=function(){function e(t,n){i(this,e),0==arguments.length?(this.x=0,this.y=0):1==arguments.length?(this.x=t.x,this.y=t.y):(this.x=t,this.y=n)}var t=Math.acos;return l(e,[{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"toString",value:function(){return"("+this.x+","+this.y+")"}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:"subtract",value:function(e){return this.x-=e.x,this.y-=e.y,this}},{key:"divide",value:function(e){return this.x/=e,this.y/=e,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"invert",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"angle",value:function(){return Math.atan2(this.y,this.x)}},{key:"distance",value:function(e){return o((e.x-this.x)*(e.x-this.x)+(e.y-this.y)*(e.y-this.y))}},{key:"distanceSq",value:function(e){return(e.x-this.x)*(e.x-this.x)+(e.y-this.y)*(e.y-this.y)}},{key:"clockwise",value:function(e){var t=this.y*e.x,n=this.x*e.y;return t>n?-1:t==n?0:1}},{key:"rotate",value:function(t){var n=new e(0,0),i=r(t),o=a(t);return n.x=this.x*i-this.y*o,n.y=this.x*o+this.y*i,this.x=n.x,this.y=n.y,this}},{key:"rotateAround",value:function(e,t){var n=a(e),i=r(e);this.x-=t.x,this.y-=t.y;var o=this.x*i-this.y*n,l=this.x*n+this.y*i;return this.x=o+t.x,this.y=l+t.y,this}},{key:"rotateTo",value:function(t,n){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;this.x+=1e-3,this.y-=1e-3;var r=e.subtract(this,n),a=e.subtract(t,n),o=e.angle(a,r);return this.rotateAround(o+i,n),this}},{key:"rotateAwayFrom",value:function(e,t,n){this.rotateAround(n,t);var i=this.distanceSq(e);this.rotateAround(-2*n,t);var a=this.distanceSq(e);a<i&&this.rotateAround(2*n,t)}},{key:"getRotateAwayFromAngle",value:function(e,t,n){var i=this.clone();i.rotateAround(n,t);var a=i.distanceSq(e);i.rotateAround(-2*n,t);var r=i.distanceSq(e);return r<a?n:-n}},{key:"getRotateTowardsAngle",value:function(e,t,n){var i=this.clone();i.rotateAround(n,t);var a=i.distanceSq(e);i.rotateAround(-2*n,t);var r=i.distanceSq(e);return r>a?n:-n}},{key:"getRotateToAngle",value:function(t,n){var i=e.subtract(this,n),a=e.subtract(t,n),r=e.angle(a,i);return Number.isNaN(r)?0:r}},{key:"isInPolygon",value:function(e){for(var t=!1,n=0,i=e.length-1;n<e.length;i=n++)e[n].y>this.y!=e[i].y>this.y&&this.x<(e[i].x-e[n].x)*(this.y-e[n].y)/(e[i].y-e[n].y)+e[n].x&&(t=!t);return t}},{key:"length",value:function(){return o(this.x*this.x+this.y*this.y)}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"normalize",value:function(){return this.divide(this.length()),this}},{key:"normalized",value:function(){return e.divideScalar(this,this.length())}},{key:"whichSide",value:function(e,t){return(this.x-e.x)*(t.y-e.y)-(this.y-e.y)*(t.x-e.x)}},{key:"sameSideAs",value:function(e,t,n){var i=this.whichSide(e,t),a=n.whichSide(e,t);return 0>i&&0>a||0==i&&0==a||0<i&&0<a}}],[{key:"add",value:function(t,n){return new e(t.x+n.x,t.y+n.y)}},{key:"subtract",value:function(t,n){return new e(t.x-n.x,t.y-n.y)}},{key:"multiply",value:function(t,n){return new e(t.x*n.x,t.y*n.y)}},{key:"multiplyScalar",value:function(t,n){return new e(t).multiply(n)}},{key:"midpoint",value:function(t,n){return new e((t.x+n.x)/2,(t.y+n.y)/2)}},{key:"normals",value:function(t,n){var i=e.subtract(n,t);return[new e(-i.y,i.x),new e(i.y,-i.x)]}},{key:"units",value:function(t,n){var i=e.subtract(n,t);return[new e(-i.y,i.x).normalize(),new e(i.y,-i.x).normalize()]}},{key:"divide",value:function(t,n){return new e(t.x/n.x,t.y/n.y)}},{key:"divideScalar",value:function(t,n){return new e(t.x/n,t.y/n)}},{key:"dot",value:function(e,t){return e.x*t.x+e.y*t.y}},{key:"angle",value:function(n,i){var a=e.dot(n,i);return t(a/(n.length()*i.length()))}},{key:"threePointangle",value:function(n,i,a){var r=e.subtract(i,n),o=e.subtract(a,i),l=n.distance(i),s=i.distance(a);return t(e.dot(r,o)/(l*s))}},{key:"scalarProjection",value:function(t,n){var i=n.normalized();return e.dot(t,i)}},{key:"averageDirection",value:function(t){for(var n=new e(0,0),a=0,i;a<t.length;a++)i=t[a],n.add(i);return n.normalize()}}]),e}();n.default=s},{}],15:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=Math.round;Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0,i;n<t.length;n++)i=t[n],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),l=e("./MathHelper"),s=i(l),g=e("./ArrayHelper"),d=i(g),u=e("./Vector2"),h=i(u),c=e("./Atom"),p=i(c),v=function(){function e(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;a(this,e),this.id=null,this.value=t,this.position=new h.default(n?n:0,i?i:0),this.previousPosition=new h.default(0,0),this.parentVertexId=null,this.children=[],this.spanningTreeChildren=[],this.edges=[],this.positioned=!1,this.angle=0,this.globalAngle=0,this.dir=1,this.neighbourCount=0,this.neighbours=[],this.neighbouringElements=[],this.forcePositioned=!1}return o(e,[{key:"setPosition",value:function(e,t){this.position.x=e,this.position.y=t}},{key:"setPositionFromVector",value:function(e){this.position.x=e.x,this.position.y=e.y}},{key:"addChild",value:function(e){this.children.push(e),this.neighbours.push(e),this.neighbourCount++,this.value.bondCount++}},{key:"addAsSecondChild",value:function(e){if(this.children.push(e),this.value.bracket){var t=1;0===this.id&&0===this.value.bracket.hcount&&(t=0),1===this.value.bracket.hcount&&(t=2),2===this.value.ringbonds.length&&2<this.neighbours.length&&(t=3),this.neighbours.splice(t,0,e)}else this.neighbours.push(e);this.neighbourCount++,this.value.bondCount++}},{key:"setParentVertexId",value:function(e){this.neighbourCount++,this.parentVertexId=e,this.neighbours.push(e),this.value.bondCount++}},{key:"isTerminal",value:function(){return!!this.value.hasAttachedPseudoElements||null===this.parentVertexId&&2>this.children.length||0===this.children.length}},{key:"clone",value:function(){var t=new e(this.value,this.position.x,this.position.y);return t.id=this.id,t.previousPosition=new h.default(this.previousPosition.x,this.previousPosition.y),t.parentVertexId=this.parentVertexId,t.children=d.default.clone(this.children),t.spanningTreeChildren=d.default.clone(this.spanningTreeChildren),t.edges=d.default.clone(this.edges),t.positioned=this.positioned,t.angle=this.angle,t.forcePositioned=this.forcePositioned,t}},{key:"equals",value:function(e){return this.id===e.id}},{key:"getAngle",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=null;return n=e?h.default.subtract(this.position,e):h.default.subtract(this.position,this.previousPosition),t?s.default.toDeg(n.angle()):n.angle()}},{key:"getTextDirection",value:function(e){for(var t=this.getDrawnNeighbours(e),n=[],a=0;a<t.length;a++)n.push(this.getAngle(e[t[a]].position));var i=s.default.meanAngle(n),o=Math.PI/2;return i=r(r(i/o)*o),2===i?"down":-2===i?"up":0===i||-0===i?"right":3===i||-3===i?"left":"down"}},{key:"getNeighbours",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;if(null===e)return this.neighbours.slice();for(var t=[],n=0;n<this.neighbours.length;n++)this.neighbours[n]!==e&&t.push(this.neighbours[n]);return t}},{key:"getDrawnNeighbours",value:function(e){for(var t=[],n=0;n<this.neighbours.length;n++)e[this.neighbours[n]].value.isDrawn&&t.push(this.neighbours[n]);return t}},{key:"getNeighbourCount",value:function(){return this.neighbourCount}},{key:"getSpanningTreeNeighbours",value:function(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=[],n=0;n<this.spanningTreeChildren.length;n++)(void 0===e||e!=this.spanningTreeChildren[n])&&t.push(this.spanningTreeChildren[n]);return null!=this.parentVertexId&&(void 0===e||e!=this.parentVertexId)&&t.push(this.parentVertexId),t}},{key:"getNextInRing",value:function(e,t,n){for(var a=this.getNeighbours(),r=0;r<a.length;r++)if(d.default.contains(e[a[r]].value.rings,{value:t})&&a[r]!=n)return a[r];return null}}]),e}();n.default=v},{"./ArrayHelper":2,"./Atom":3,"./MathHelper":9,"./Vector2":14}]},{},[1]);
//# sourceMappingURL=smiles-drawer.min.js.map

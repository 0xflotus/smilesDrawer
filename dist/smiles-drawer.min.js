!function e(t,r,i){function n(o,s){if(!r[o]){if(!t[o]){var l="function"==typeof require&&require;if(!s&&l)return l(o,!0);if(a)return a(o,!0);var h=new Error("Cannot find module '"+o+"'");throw h.code="MODULE_NOT_FOUND",h}var u=r[o]={exports:{}};t[o][0].call(u.exports,function(e){var r=t[o][1][e];return n(r||e)},u,u.exports,e,t,r,i)}return r[o].exports}for(var a="function"==typeof require&&require,o=0;o<i.length;o++)n(i[o]);return n}({1:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}var n=e("./src/Drawer"),a=i(n),o=e("./src/Parser"),s=i(o);window.SmilesDrawer={Version:"1.0.0"},window.SmilesDrawer.Drawer=a.default,window.SmilesDrawer.Parser=s.default,window.SmilesDrawer.clean=function(e){return e.replace(/[^A-Za-z0-9@\.\+\-\?!\(\)\[\]\{\}\/\\=#\$:\*]/g,"")},window.SmilesDrawer.apply=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"canvas[data-smiles]",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"light",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=new a.default(e),o=document.querySelectorAll(t),s=0;s<o.length;s++)!function(){var e=o[s];SmilesDrawer.parse(e.getAttribute("data-smiles"),function(t){n.draw(t,e,r,!1)},function(e){i&&i(e)})}()},window.SmilesDrawer.parse=function(e,t,r){try{t&&t(s.default.parse(e))}catch(e){r&&r(e)}},Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{value:function(e){if(null==this)throw new TypeError("this is null or not defined");for(var t=Object(this),r=t.length>>>0,i=arguments[1],n=i>>0,a=n<0?Math.max(r+n,0):Math.min(n,r),o=arguments[2],s=void 0===o?r:o>>0,l=s<0?Math.max(r+s,0):Math.min(s,r);a<l;)t[a]=e,a++;return t}})},{"./src/Drawer":5,"./src/Parser":10}],2:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),o=function(){function e(){i(this,e)}return a(e,null,[{key:"clone",value:function(t){var r=Array.isArray(t)?Array():{};for(var i in t){var a=t[i];"function"==typeof a.clone?r[i]=a.clone():r[i]="object"===(void 0===a?"undefined":n(a))?e.clone(a):a}return r}},{key:"print",value:function(e){if(0==e.length)return"";for(var t="(",r=0;r<e.length;r++)t+=e[r].id?e[r].id+", ":e[r]+", ";return(t=t.substring(0,t.length-2))+")"}},{key:"each",value:function(e,t){for(var r=0;r<e.length;r++)t(e[r])}},{key:"get",value:function(e,t,r){for(var i=0;i<e.length;i++)if(e[i][t]==r)return e[i]}},{key:"contains",value:function(e,t){if(t.property||t.func){if(t.func){for(var r=0;r<e.length;r++)if(t.func(e[r]))return!0}else for(var i=0;i<e.length;i++)if(e[i][t.property]==t.value)return!0}else for(var n=0;n<e.length;n++)if(e[n]==t.value)return!0;return!1}},{key:"intersection",value:function(e,t){for(var r=new Array,i=0;i<e.length;i++)for(var n=0;n<t.length;n++)e[i]===t[n]&&r.push(e[i]);return r}},{key:"unique",value:function(e){var t={};return e.filter(function(e){return void 0===t[e]&&(t[e]=!0)})}},{key:"count",value:function(e,t){for(var r=0,i=0;i<e.length;i++)e[i]===t&&r++;return r}},{key:"toggle",value:function(e,t){for(var r=Array(),i=!1,n=0;n<e.length;n++)e[n]!==t?r.push(e[n]):i=!0;return i||r.push(t),r}},{key:"remove",value:function(e,t){for(var r=Array(),i=0;i<e.length;i++)e[i]!==t&&r.push(e[i]);return r}},{key:"removeUnique",value:function(e,t){var r=e.indexOf(t);return r>-1&&e.splice(r,1),e}},{key:"removeAll",value:function(e,t){return e.filter(function(e){return-1===t.indexOf(e)})}},{key:"merge",value:function(e,t){for(var r=new Array(e.length+t.length),i=0;i<e.length;i++)r[i]=e[i];for(var n=0;n<t.length;n++)r[e.length+n]=t[n];return r}},{key:"containsAll",value:function(e,t){for(var r=0,i=0;i<e.length;i++)for(var n=0;n<t.length;n++)e[i]===t[n]&&r++;return r===t.length}},{key:"sortByAtomicNumberDesc",value:function(e){var t=e.map(function(e,t){return{index:t,value:e.atomicNumber.split(".").map(Number)}});return t.sort(function(e,t){for(var r=Math.min(t.value.length,e.value.length),i=0;i<r&&t.value[i]===e.value[i];)i++;return i===r?t.value.length-e.value.length:t.value[i]-e.value[i]}),t.map(function(t){return e[t.index]})}},{key:"deepCopy",value:function(t){for(var r=Array(),i=0;i<t.length;i++){var n=t[i];n instanceof Array?r[i]=e.deepCopy(n):r[i]=n}return r}}]),e}();r.default=o},{}],3:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),o=e("./ArrayHelper"),s=i(o),l=e("./Vertex"),h=(i(l),e("./Ring")),u=(i(h),function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-";n(this,e),this.element=1===t.length?t.toUpperCase():t,this.drawExplicit=!1,this.ringbonds=[],this.rings=[],this.bondType=r,this.branchBond=null,this.isBridge=!1,this.isBridgeNode=!1,this.originalRings=[],this.bridgedRing=null,this.anchoredRings=[],this.bracket=null,this.plane=0,this.order={},this.attachedPseudoElements={},this.hasAttachedPseudoElements=!1,this.isDrawn=!0,this.isConnectedToRing=!1,this.neighbouringElements=[],this.isPartOfAromaticRing=t!==this.element,this.bondCount=0}return a(e,[{key:"addNeighbouringElement",value:function(e){this.neighbouringElements.push(e)}},{key:"attachPseudoElement",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=r+e;this.attachedPseudoElements[i]?this.attachedPseudoElements[i].count+=1:this.attachedPseudoElements[i]={element:e,count:1,hydrogenCount:r,previousElement:t},this.hasAttachedPseudoElements=!0}},{key:"getAttachedPseudoElements",value:function(){var e={},t=this;return Object.keys(this.attachedPseudoElements).sort().forEach(function(r){e[r]=t.attachedPseudoElements[r]}),e}},{key:"getAttachedPseudoElementsCount",value:function(){return Object.keys(this.attachedPseudoElements).length}},{key:"addAnchoredRing",value:function(e){s.default.contains(this.anchoredRings,{value:e})||this.anchoredRings.push(e)}},{key:"getRingbondCount",value:function(){return this.ringbonds.length}},{key:"backupRings",value:function(){this.originalRings=Array(this.rings.length);for(var e=0;e<this.rings.length;e++)this.originalRings[e]=this.rings[e]}},{key:"restoreRings",value:function(){this.rings=Array(this.originalRings.length);for(var e=0;e<this.originalRings.length;e++)this.rings[e]=this.originalRings[e]}},{key:"haveCommonRingbond",value:function(e,t){for(var r=0;r<e.ringbonds.length;r++)for(var i=0;i<t.ringbonds.length;i++)if(e.ringbonds[r].id==t.ringbonds[i].id)return!0;return!1}},{key:"getOrder",value:function(e){return this.order[e]}},{key:"setOrder",value:function(e,t){this.order[e]=t}},{key:"neighbouringElementsEqual",value:function(e){if(e.length!==this.neighbouringElements.length)return!1;e.sort(),this.neighbouringElements.sort();for(var t=0;t<this.neighbouringElements.length;t++)if(e[t]!==this.neighbouringElements[t])return!1;return!0}},{key:"getAtomicNumber",value:function(){return e.atomicNumbers[this.element]}}],[{key:"sortByAtomicNumber",value:function(t,r){for(var i=new Array(t.length),n=0;n<t.length;n++){var a=r[t[n]],o=e.atomicNumbers[a.value.element];i[n]={atomicNumber:o.toString(),vertexId:a.id}}return s.default.sortByAtomicNumberDesc(i)}},{key:"hasDuplicateAtomicNumbers",value:function(e){for(var t={},r=0;r<e.length;r++){var i=e[r];if(void 0!==t[i.atomicNumber])return!0;t[i.atomicNumber]=!0}return!1}},{key:"getDuplicateAtomicNumbers",value:function(e){for(var t={},r=[],i=0;i<e.length;i++){var n=e[i];void 0===t[n.atomicNumber]&&(t[n.atomicNumber]=[]),t[n.atomicNumber].push(i)}for(var a in t){var o=t[a];o.length>1&&r.push(o)}return r}},{key:"maxBonds",get:function(){return{C:4,N:3,O:2,P:3,S:2,B:3,F:1,I:1,Cl:1,Br:1}}},{key:"atomicNumbers",get:function(){return{H:1,He:2,Li:3,Be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,Ne:10,Na:11,Mg:12,Al:13,Si:14,P:15,p:15,S:16,s:16,Cl:17,Ar:18,K:19,Ca:20,Sc:21,Ti:22,V:23,Cr:24,Mn:25,Fe:26,Co:27,Ni:28,Cu:29,Zn:30,Ga:31,Ge:32,As:33,Se:34,Br:35,Kr:36,Rb:37,Sr:38,Y:39,Zr:40,Nb:41,Mo:42,Tc:43,Ru:44,Rh:45,Pd:46,Ag:47,Cd:48,In:49,Sn:50,Sb:51,Te:52,I:53,Xe:54,Cs:55,Ba:56,La:57,Ce:58,Pr:59,Nd:60,Pm:61,Sm:62,Eu:63,Gd:64,Tb:65,Dy:66,Ho:67,Er:68,Tm:69,Yb:70,Lu:71,Hf:72,Ta:73,W:74,Re:75,Os:76,Ir:77,Pt:78,Au:79,Hg:80,Tl:81,Pb:82,Bi:83,Po:84,At:85,Rn:86,Fr:87,Ra:88,Ac:89,Th:90,Pa:91,U:92,Np:93,Pu:94,Am:95,Cm:96,Bk:97,Cf:98,Es:99,Fm:100,Md:101,No:102,Lr:103,Rf:104,Db:105,Sg:106,Bh:107,Hs:108,Mt:109,Ds:110,Rg:111,Cn:112,Uut:113,Uuq:114,Uup:115,Uuh:116,Uus:117,Uuo:118}}},{key:"mass",get:function(){return{H:1,He:2,Li:3,Be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,Ne:10,Na:11,Mg:12,Al:13,Si:14,P:15,p:15,S:16,s:16,Cl:17,Ar:18,K:19,Ca:20,Sc:21,Ti:22,V:23,Cr:24,Mn:25,Fe:26,Co:27,Ni:28,Cu:29,Zn:30,Ga:31,Ge:32,As:33,Se:34,Br:35,Kr:36,Rb:37,Sr:38,Y:39,Zr:40,Nb:41,Mo:42,Tc:43,Ru:44,Rh:45,Pd:46,Ag:47,Cd:48,In:49,Sn:50,Sb:51,Te:52,I:53,Xe:54,Cs:55,Ba:56,La:57,Ce:58,Pr:59,Nd:60,Pm:61,Sm:62,Eu:63,Gd:64,Tb:65,Dy:66,Ho:67,Er:68,Tm:69,Yb:70,Lu:71,Hf:72,Ta:73,W:74,Re:75,Os:76,Ir:77,Pt:78,Au:79,Hg:80,Tl:81,Pb:82,Bi:83,Po:84,At:85,Rn:86,Fr:87,Ra:88,Ac:89,Th:90,Pa:91,U:92,Np:93,Pu:94,Am:95,Cm:96,Bk:97,Cf:98,Es:99,Fm:100,Md:101,No:102,Lr:103,Rf:104,Db:105,Sg:106,Bh:107,Hs:108,Mt:109,Ds:110,Rg:111,Cn:112,Uut:113,Uuq:114,Uup:115,Uuh:116,Uus:117,Uuo:118}}}]),e}());r.default=u},{"./ArrayHelper":2,"./Ring":11,"./Vertex":15}],4:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),o=e("./MathHelper"),s=i(o),l=e("./Vector2"),h=i(l),u=e("./Line"),g=(i(u),e("./Vertex")),c=(i(g),e("./Ring")),d=(i(c),function(){function e(t,r,i){n(this,e),"string"==typeof t||t instanceof String?this.canvas=document.getElementById(t):this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.colors=r,this.opts=i,this.drawingWidth=0,this.drawingHeight=0,this.offsetX=0,this.offsetY=0,this.fontLarge=this.opts.fontSizeLarge+"pt Helvetica, Arial, sans-serif",this.fontSmall=this.opts.fontSizeSmall+"pt Helvetica, Arial, sans-serif",this.updateSize(this.opts.width,this.opts.height),this.ctx.font=this.fontLarge,this.hydrogenWidth=this.ctx.measureText("H").width,this.halfHydrogenWidth=this.hydrogenWidth/2}return a(e,[{key:"updateSize",value:function(e,t){this.devicePixelRatio=window.devicePixelRatio||1,this.backingStoreRatio=this.ctx.webkitBackingStorePixelRatio||this.ctx.mozBackingStorePixelRatio||this.ctx.msBackingStorePixelRatio||this.ctx.oBackingStorePixelRatio||this.ctx.backingStorePixelRatio||1,this.ratio=this.devicePixelRatio/this.backingStoreRatio,1!==this.ratio?(this.canvas.width=e*this.ratio,this.canvas.height=t*this.ratio,this.canvas.style.width=e+"px",this.canvas.style.height=t+"px",this.ctx.setTransform(this.ratio,0,0,this.ratio,0,0)):(this.canvas.width=e*this.ratio,this.canvas.height=t*this.ratio)}},{key:"setTheme",value:function(e){this.colors=e}},{key:"scale",value:function(e){for(var t=-Number.MAX_VALUE,r=-Number.MAX_VALUE,i=Number.MAX_VALUE,n=Number.MAX_VALUE,a=0;a<e.length;a++){var o=e[a].position;t<o.x&&(t=o.x),r<o.y&&(r=o.y),i>o.x&&(i=o.x),n>o.y&&(n=o.y)}t+=20,r+=20,i-=20,n-=20,this.drawingWidth=t-i,this.drawingHeight=r-n;var s=this.canvas.offsetWidth/this.drawingWidth,l=this.canvas.offsetHeight/this.drawingHeight,h=s<l?s:l;this.ctx.scale(h,h),this.offsetX=-i,this.offsetY=-n,s<l?this.offsetY+=this.canvas.offsetHeight/(2*h)-this.drawingHeight/2:this.offsetX+=this.canvas.offsetWidth/(2*h)-this.drawingWidth/2}},{key:"reset",value:function(){this.ctx.setTransform(1,0,0,1,0,0)}},{key:"getColor",value:function(e){return e=e.toUpperCase(),e in this.colors?this.colors[e]:this.colors.C}},{key:"drawCircle",value:function(e,t,r,i){var n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"",l=this.ctx,h=this.offsetX,u=this.offsetY;l.save(),l.lineWidth=1.5,l.beginPath(),l.arc(e+h,t+u,r,0,s.default.twoPI,!0),l.closePath(),a?(n?(l.fillStyle="#f00",l.fill()):(l.strokeStyle="#f00",l.stroke()),this.drawDebugText(e,t,o)):n?(l.fillStyle=i,l.fill()):(l.strokeStyle=i,l.stroke()),l.restore()}},{key:"drawLine",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=this.ctx,n=this.offsetX,a=this.offsetY,o=e.clone().shorten(4),s=o.getLeftVector().clone(),l=o.getRightVector().clone();s.x+=n,s.y+=a,l.x+=n,l.y+=a,t||(i.save(),i.globalCompositeOperation="destination-out",i.beginPath(),i.moveTo(s.x,s.y),i.lineTo(l.x,l.y),i.lineCap="round",i.lineWidth=2.5*this.opts.bondThickness,i.strokeStyle=this.getColor("BACKGROUND"),i.stroke(),i.globalCompositeOperation="source-over",i.restore()),s=e.getLeftVector().clone(),l=e.getRightVector().clone(),s.x+=n,s.y+=a,l.x+=n,l.y+=a,i.save(),i.beginPath(),i.moveTo(s.x,s.y),i.lineTo(l.x,l.y),i.lineCap="round",i.lineWidth=this.opts.bondThickness;var h=this.ctx.createLinearGradient(s.x,s.y,l.x,l.y);h.addColorStop(.4,this.getColor(e.getLeftElement())||this.getColor("C")),h.addColorStop(.6,this.getColor(e.getRightElement())||this.getColor("C")),t&&(i.setLineDash([1,1]),i.lineWidth=this.opts.bondThickness),r<1&&(i.globalAlpha=r),i.strokeStyle=h,i.stroke(),i.restore()}},{key:"drawWedge",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(!(isNaN(e.from.x)||isNaN(e.from.y)||isNaN(e.to.x)||isNaN(e.to.y))){var r=this.ctx,i=this.offsetX,n=this.offsetY,a=e.clone().shorten(5),o=a.getLeftVector().clone(),s=a.getRightVector().clone();o.x+=i,o.y+=n,s.x+=i,s.y+=n,o=e.getLeftVector().clone(),s=e.getRightVector().clone(),o.x+=i,o.y+=n,s.x+=i,s.y+=n,r.save();var l=h.default.normals(o,s);l[0].normalize(),l[1].normalize();var u=e.getRightChiral(),g=o,c=s;u&&(g=s,c=o);var d=h.default.add(g,h.default.multiplyScalar(l[0],.75)),f=h.default.add(c,h.default.multiplyScalar(l[0],t)),v=h.default.add(c,h.default.multiplyScalar(l[1],t)),p=h.default.add(g,h.default.multiplyScalar(l[1],.75));r.beginPath(),r.moveTo(d.x,d.y),r.lineTo(f.x,f.y),r.lineTo(v.x,v.y),r.lineTo(p.x,p.y);var y=this.ctx.createRadialGradient(s.x,s.y,this.opts.bondLength,s.x,s.y,0);y.addColorStop(.4,this.getColor(e.getLeftElement())||this.getColor("C")),y.addColorStop(.6,this.getColor(e.getRightElement())||this.getColor("C")),r.fillStyle=y,r.fill(),r.restore()}}},{key:"drawDashedWedge",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6;if(!(isNaN(e.from.x)||isNaN(e.from.y)||isNaN(e.to.x)||isNaN(e.to.y))){var r=this.ctx,i=this.offsetX,n=this.offsetY,a=e.getLeftVector().clone(),o=e.getRightVector().clone();a.x+=i,a.y+=n,o.x+=i,o.y+=n,r.save();var s=h.default.normals(a,o);s[0].normalize(),s[1].normalize();var l=e.getRightChiral(),u=void 0,g=void 0,c=void 0,d=void 0,f=e.clone();l?(u=o,g=a,f.shortenRight(3),c=f.getRightVector().clone(),d=f.getLeftVector().clone()):(u=a,g=o,f.shortenLeft(3),c=f.getLeftVector().clone(),d=f.getRightVector().clone()),c.x+=i,c.y+=n,d.x+=i,d.y+=n;var v=h.default.add(u,h.default.multiplyScalar(s[0],.75)),p=h.default.add(g,h.default.multiplyScalar(s[0],t/2)),y=h.default.add(g,h.default.multiplyScalar(s[1],t/2)),m=h.default.add(u,h.default.multiplyScalar(s[1],.75));r.beginPath(),r.moveTo(v.x,v.y),r.lineTo(p.x,p.y),r.lineTo(y.x,y.y),r.lineTo(m.x,m.y);var b=this.ctx.createRadialGradient(o.x,o.y,this.opts.bondLength,o.x,o.y,0);b.addColorStop(.4,this.getColor(e.getLeftElement())||this.getColor("C")),b.addColorStop(.6,this.getColor(e.getRightElement())||this.getColor("C")),r.fillStyle=b,r.fill(),r.globalCompositeOperation="destination-out",r.beginPath(),r.moveTo(c.x,c.y),r.lineTo(d.x,d.y),r.lineCap="butt",r.lineWidth=t,r.setLineDash([1,1]),r.strokeStyle=this.getColor("BACKGROUND"),r.stroke(),r.globalCompositeOperation="source-over",r.restore()}}},{key:"drawDebugText",value:function(e,t,r){var i=this.ctx;i.save(),i.font="5px Droid Sans, sans-serif",i.textAlign="start",i.textBaseline="top",i.fillStyle="#ff0000",i.fillText(r,e+this.offsetX,t+this.offsetY),i.restore()}},{key:"drawBall",value:function(e,t,r){var i=this.ctx;i.save(),i.beginPath(),i.arc(e+this.offsetX,t+this.offsetY,this.opts.bondLength/4.5,0,s.default.twoPI,!1),i.fillStyle=this.getColor(r),i.fill(),i.restore()}},{key:"drawPoint",value:function(e,t,r){var i=this.ctx,n=this.offsetX,a=this.offsetY;i.save(),i.globalCompositeOperation="destination-out",i.beginPath(),i.arc(e+n,t+a,1.5,0,s.default.twoPI,!0),i.closePath(),i.fill(),i.globalCompositeOperation="source-over",i.beginPath(),i.arc(e+this.offsetX,t+this.offsetY,.75,0,s.default.twoPI,!1),i.fillStyle=this.getColor(r),i.fill(),i.restore()}},{key:"drawText",value:function(e,t,r,i,n,a,o,l){var h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{},u=this.ctx,g=this.offsetX,c=this.offsetY;u.save(),u.textAlign="start",u.textBaseline="alphabetic";var d="+",f=0;o&&(2===o?d="2+":-1===o?d="-":-2===o&&(d="2-"),u.font=this.fontSmall,f=u.measureText(d).width);var v="0",p=0;l>0&&(v=l,u.font=this.fontSmall,p=u.measureText(v).width),u.font=this.fontLarge,u.fillStyle=this.getColor("BACKGROUND");var y=u.measureText(r);y.totalWidth=y.width+f,y.height=parseInt(this.fontLarge,10);var m=y.width>this.opts.fontSizeLarge?y.width:this.opts.fontSizeLarge;m/=1.25,u.globalCompositeOperation="destination-out",u.beginPath(),u.arc(e+g,t+c,m,0,s.default.twoPI,!0),u.closePath(),u.fill(),u.globalCompositeOperation="source-over";var b=-y.width/2,A=-y.width/2;u.fillStyle=this.getColor(r),u.fillText(r,e+g+b,t+this.opts.halfFontSizeLarge+c),b+=y.width,o&&(u.font=this.fontSmall,u.fillText(d,e+g+b,t-this.opts.fifthFontSizeSmall+c),b+=f),l>0&&(u.font=this.fontSmall,u.fillText(v,e+g+A-p,t-this.opts.fifthFontSizeSmall+c),A-=p),u.font=this.fontLarge;var x=0,S=0;if(1===i){var k=e+g,w=t+c+this.opts.halfFontSizeLarge;x=this.hydrogenWidth,A-=x,"left"===n?k+=A:"right"===n?k+=b:"up"===n&&a?k+=b:"down"===n&&a?k+=b:"up"!==n||a?"down"!==n||a||(w+=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,k-=this.halfHydrogenWidth):(w-=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,k-=this.halfHydrogenWidth),u.fillText("H",k,w),b+=x}else if(i>1){var C=e+g,R=t+c+this.opts.halfFontSizeLarge;x=this.hydrogenWidth,u.font=this.fontSmall,S=u.measureText(i).width,A-=x+S,"left"===n?C+=A:"right"===n?C+=b:"up"===n&&a?C+=b:"down"===n&&a?C+=b:"up"!==n||a?"down"!==n||a||(R+=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,C-=this.halfHydrogenWidth):(R-=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,C-=this.halfHydrogenWidth),u.font=this.fontLarge,u.fillText("H",C,R),u.font=this.fontSmall,u.fillText(i,C+this.halfHydrogenWidth+S,R+this.opts.fifthFontSizeSmall),b+=x+this.halfHydrogenWidth+S}for(var P in h)if(h.hasOwnProperty(P)){var T=0,N=0,I=h[P].element,L=h[P].count,B=h[P].hydrogenCount;u.font=this.fontLarge,L>1&&B>0&&(T=u.measureText("(").width,N=u.measureText(")").width);var O=u.measureText(I).width,E=0;x=0,B>0&&(x=this.hydrogenWidth),u.font=this.fontSmall,L>1&&(E=u.measureText(L).width),S=0,B>1&&(S=u.measureText(B).width),u.font=this.fontLarge;var M=e+g,D=t+c+this.opts.halfFontSizeLarge;u.fillStyle=this.getColor(I),L>0&&(A-=E),L>1&&B>0&&("left"===n?(A-=N,u.fillText(")",M+A,D)):(u.fillText("(",M+b,D),b+=T)),"left"===n?(A-=O,u.fillText(I,M+A,D)):(u.fillText(I,M+b,D),b+=O),B>0&&("left"===n?(A-=x+S,u.fillText("H",M+A,D),B>1&&(u.font=this.fontSmall,u.fillText(B,M+A+x,D+this.opts.fifthFontSizeSmall))):(u.fillText("H",M+b,D),b+=x,B>1&&(u.font=this.fontSmall,u.fillText(B,M+b,D+this.opts.fifthFontSizeSmall),b+=S))),u.font=this.fontLarge,L>1&&B>0&&("left"===n?(A-=T,u.fillText("(",M+A,D)):(u.fillText(")",M+b,D),b+=N)),u.font=this.fontSmall,L>1&&("left"===n?u.fillText(L,M+A+T+N+x+S+O,D+this.opts.fifthFontSizeSmall):(u.fillText(L,M+b,D+this.opts.fifthFontSizeSmall),b+=E))}u.restore()}},{key:"drawDebugPoint",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"#f00";this.drawCircle(e,t,2,i,!0,!0,r)}},{key:"drawAromaticityRing",value:function(e){var t=this.ctx,r=s.default.apothemFromSideLength(this.opts.bondLength,e.getSize());t.save(),t.strokeStyle=this.getColor("C"),t.lineWidth=this.opts.bondThickness,t.beginPath(),t.arc(e.center.x+this.offsetX,e.center.y+this.offsetY,r-this.opts.bondSpacing,0,2*Math.PI,!0),t.closePath(),t.stroke(),t.restore()}},{key:"clear",value:function(){this.ctx.clearRect(0,0,this.canvas.offsetWidth,this.canvas.offsetHeight)}}]),e}());r.default=d},{"./Line":8,"./MathHelper":9,"./Ring":11,"./Vector2":14,"./Vertex":15}],5:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=e("./MathHelper"),l=i(s),h=e("./ArrayHelper"),u=i(h),g=e("./Vector2"),c=i(g),d=e("./Line"),f=i(d),v=e("./Vertex"),p=(i(v),e("./Edge")),y=i(p),m=e("./Atom"),b=i(m),A=e("./Ring"),x=i(A),S=e("./RingConnection"),k=i(S),w=e("./CanvasWrapper"),C=i(w),R=e("./Graph"),P=i(R),T=e("./SSSR"),N=i(T),I=function(){function e(t){a(this,e),this.graph=null,this.ringIdCounter=0,this.ringConnectionIdCounter=0,this.canvasWrapper=null,this.totalOverlapScore=0,this.defaultOptions={width:500,height:500,bondThickness:.6,bondLength:14.4,shortBondLength:12.24,bondSpacing:2.592,atomVisualization:"default",isomeric:!1,debug:!1,terminalCarbons:!1,explicitHydrogens:!0,compactDrawing:!0,fontSizeLarge:6,fontSizeSmall:4,themes:{dark:{C:"#fff",O:"#e74c3c",N:"#3498db",F:"#27ae60",CL:"#16a085",BR:"#d35400",I:"#8e44ad",P:"#d35400",S:"#f1c40f",B:"#e67e22",SI:"#e67e22",H:"#fff",BACKGROUND:"#141414"},light:{C:"#222",O:"#e74c3c",N:"#3498db",F:"#27ae60",CL:"#16a085",BR:"#d35400",I:"#8e44ad",P:"#d35400",S:"#f1c40f",B:"#e67e22",SI:"#e67e22",H:"#222",BACKGROUND:"#fff"}}},this.opts=this.extend(!0,this.defaultOptions,t),this.opts.halfBondSpacing=this.opts.bondSpacing/2,this.opts.bondLengthSq=this.opts.bondLength*this.opts.bondLength,this.opts.halfFontSizeLarge=this.opts.fontSizeLarge/2,this.opts.quarterFontSizeLarge=this.opts.fontSizeLarge/4,this.opts.fifthFontSizeSmall=this.opts.fontSizeSmall/5,this.theme=this.opts.themes.dark}return o(e,[{key:"extend",value:function(){var e=this,t={},r=!1,i=0,n=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(r=arguments[0],i++);for(;i<n;i++){var a=arguments[i];!function(i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r&&"[object Object]"===Object.prototype.toString.call(i[n])?t[n]=e.extend(!0,t[n],i[n]):t[n]=i[n])}(a)}return t}},{key:"draw",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"light",i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.data=e,this.canvasWrapper=new C.default(t,this.opts.themes[r],this.opts),this.infoOnly=i,this.ringIdCounter=0,this.ringConnectionIdCounter=0,this.graph=new P.default(e,this.opts.isomeric),this.rings=Array(),this.ringConnections=Array(),this.originalRings=Array(),this.originalRingConnections=Array(),this.bridgedRing=!1,this.initRings(),this.annotateStereochemistry(),!this.opts.explicitHydrogens)for(var n=0;n<this.graph.vertices.length;n++)"H"===this.graph.vertices[n].value.element&&(this.graph.vertices[n].value.isDrawn=!1);if(this.opts.isomeric&&this.annotateStereochemistry(),!this.infoOnly){this.position(),this.restoreRingInformation(),this.resolvePrimaryOverlaps();var a=this.getOverlapScore();this.totalOverlapScore=this.getOverlapScore().total;for(var n=0;n<this.graph.edges.length;n++){var o=this.graph.edges[n];if(this.isEdgeRotatable(o)){var s=this.graph.getTreeDepth(o.sourceId,o.targetId),h=this.graph.getTreeDepth(o.targetId,o.sourceId),u=o.targetId,g=o.sourceId;s>h&&(u=o.sourceId,g=o.targetId);if(this.getSubtreeOverlapScore(g,u,a.vertexScores).value>1){var c=this.graph.vertices[u],d=this.graph.vertices[g],f=d.getNeighbours(u);if(1===f.length){var v=this.graph.vertices[f[0]],p=v.position.getRotateAwayFromAngle(c.position,d.position,l.default.toRad(120));this.rotateSubtree(v.id,d.id,p,d.position);var y=this.getOverlapScore().total;y>this.totalOverlapScore?this.rotateSubtree(v.id,d.id,-p,d.position):this.totalOverlapScore=y}else if(2==f.length){if(d.value.rings.length+c.value.rings.length>0)continue;var m=this.graph.vertices[f[0]],b=this.graph.vertices[f[1]],A=m.position.getRotateAwayFromAngle(c.position,d.position,l.default.toRad(120)),x=b.position.getRotateAwayFromAngle(c.position,d.position,l.default.toRad(120));this.rotateSubtree(m.id,d.id,A,d.position),this.rotateSubtree(b.id,d.id,x,d.position);var S=this.getOverlapScore().total;S>this.totalOverlapScore?(this.rotateSubtree(m.id,d.id,-A,d.position),this.rotateSubtree(b.id,d.id,-x,d.position)):this.totalOverlapScore=S}a=this.getOverlapScore()}}}this.resolveSecondaryOverlaps(a.scores),this.canvasWrapper.scale(this.graph.vertices),this.opts.compactDrawing&&"default"===this.opts.atomVisualization&&this.initPseudoElements(),this.drawEdges(this.opts.debug),this.drawVertices(this.opts.debug),this.canvasWrapper.reset()}}},{key:"edgeRingCount",value:function(e){var t=this.graph.edges[e],r=this.graph.vertices[t.sourceId],i=this.graph.vertices[t.targetId];return Math.min(r.value.rings.length,i.value.rings.length)}},{key:"getBridgedRings",value:function(){for(var e=Array(),t=0;t<this.rings.length;t++)this.rings[t].isBridged&&e.push(this.rings[t]);return e}},{key:"getFusedRings",value:function(){for(var e=Array(),t=0;t<this.rings.length;t++)this.rings[t].isFused&&e.push(this.rings[t]);return e}},{key:"getSpiros",value:function(){for(var e=Array(),t=0;t<this.rings.length;t++)this.rings[t].isSpiro&&e.push(this.rings[t]);return e}},{key:"printRingInfo",value:function(){for(var e="",t=0;t<this.rings.length;t++){var r=this.rings[t];e+=r.id+";",e+=r.members.length+";",e+=r.neighbours.length+";",e+=r.isSpiro?"true;":"false;",e+=r.isFused?"true;":"false;",e+=r.isBridged?"true;":"false;",e+=r.rings.length+";",e+="\n"}return e}},{key:"getTotalOverlapScore",value:function(){return this.totalOverlapScore}},{key:"getRingCount",value:function(){return this.rings.length}},{key:"hasBridgedRing",value:function(){return this.bridgedRing}},{key:"getHeavyAtomCount",value:function(){for(var e=0,t=0;t<this.graph.vertices.length;t++)"H"!==this.graph.vertices[t].value.element&&e++;return e}},{key:"getRingbondType",value:function(e,t){if(e.value.getRingbondCount()<1||t.value.getRingbondCount()<1)return null;for(var r=0;r<e.value.ringbonds.length;r++)for(var i=0;i<t.value.ringbonds.length;i++)if(e.value.ringbonds[r].id===t.value.ringbonds[i].id)return"-"===e.value.ringbonds[r].bondType?t.value.ringbonds[i].bond:e.value.ringbonds[r].bond;return null}},{key:"initRings",value:function(){for(var e=new Map,t=this.graph.vertices.length-1;t>=0;t--){var r=this.graph.vertices[t];if(0!==r.value.ringbonds.length)for(var i=0;i<r.value.ringbonds.length;i++){var a=r.value.ringbonds[i].id;if(e.has(a)){var o=r.id,s=e.get(a),l=this.graph.addEdge(new y.default(o,s,1)),h=this.graph.vertices[s];r.addChild(s),r.value.addNeighbouringElement(h.value.element),h.addChild(o),h.value.addNeighbouringElement(r.value.element),r.edges.push(l),h.edges.push(l),e.delete(a)}else e.set(a,r.id)}}var u=N.default.getRings(this.graph);if(null!==u){for(var t=0;t<u.length;t++)for(var g=[].concat(n(u[t])),c=this.addRing(new x.default(g)),i=0;i<g.length;i++)this.graph.vertices[g[i]].value.rings.push(c);for(var t=0;t<this.rings.length-1;t++)for(var i=t+1;i<this.rings.length;i++){var d=this.rings[t],f=this.rings[i],v=new k.default(d,f);v.vertices.size>0&&this.addRingConnection(v)}for(var t=0;t<this.rings.length;t++){var p=this.rings[t];p.neighbours=k.default.getNeighbours(this.ringConnections,p.id)}for(var t=0;t<this.rings.length;t++){var m=this.rings[t];this.graph.vertices[m.members[0]].value.addAnchoredRing(m.id)}for(this.backupRingInformation();this.rings.length>0;){for(var b=-1,t=0;t<this.rings.length;t++){var A=this.rings[t];this.isPartOfBridgedRing(A.id)&&!A.isBridged&&(b=A.id)}if(-1===b)break;var S=this.getRing(b),w=this.getBridgedRingRings(S.id);this.bridgedRing=!0,this.createBridgedRing(w,S.members[0]);for(var t=0;t<w.length;t++)this.removeRing(w[t])}}}},{key:"getBridgedRingRings",value:function(e){var t=Array(),r=this;return function e(i){var n=r.getRing(i);t.push(i);for(var a=0;a<n.neighbours.length;a++){var o=n.neighbours[a];-1===t.indexOf(o)&&o!==i&&k.default.isBridge(r.ringConnections,r.graph.vertices,i,o)&&e(o)}}(e),u.default.unique(t)}},{key:"isPartOfBridgedRing",value:function(e){for(var t=0;t<this.ringConnections.length;t++)if(this.ringConnections[t].containsRing(e)&&this.ringConnections[t].isBridge(this.graph.vertices))return!0;return!1}},{key:"createBridgedRing",value:function(e,t){for(var r=new Set,i=new Set,a=new Set,o=0;o<e.length;o++){var s=this.getRing(e[o]);s.isPartOfBridged=!0;for(var l=0;l<s.members.length;l++)i.add(s.members[l]);for(var l=0;l<s.neighbours.length;l++){var h=s.neighbours[l];-1===e.indexOf(h)&&a.add(s.neighbours[l])}}var g=new Set,c=!0,d=!1,f=void 0;try{for(var v,p=i[Symbol.iterator]();!(c=(v=p.next()).done);c=!0){var y=v.value,m=this.graph.vertices[y],b=u.default.intersection(e,m.value.rings);1===m.value.rings.length||1===b.length?r.add(m.id):g.add(m.id)}}catch(e){d=!0,f=e}finally{try{!c&&p.return&&p.return()}finally{if(d)throw f}}var A=(Array(),Array()),S=!0,k=!1,w=void 0;try{for(var C,R=g[Symbol.iterator]();!(S=(C=R.next()).done);S=!0){for(var P=C.value,T=this.graph.vertices[P],N=!1,I=0;I<T.edges.length;I++)1===this.edgeRingCount(T.edges[I])&&(N=!0);N?(T.value.isBridgeNode=!0,r.add(T.id)):(T.value.isBridge=!0,r.add(T.id))}}catch(e){k=!0,w=e}finally{try{!S&&R.return&&R.return()}finally{if(k)throw w}}var L=new x.default([].concat(n(r)));L.isBridged=!0,L.neighbours=[].concat(n(a));for(var o=0;o<e.length;o++)L.rings.push(this.getRing(e[o]).clone());this.addRing(L);for(var o=0;o<L.members.length;o++)this.graph.vertices[L.members[o]].value.bridgedRing=L.id;for(var o=0;o<A.length;o++){this.graph.vertices[A[o]].value.rings=Array()}var B=!0,O=!1,E=void 0;try{for(var M,D=r[Symbol.iterator]();!(B=(M=D.next()).done);B=!0){var V=M.value,F=this.graph.vertices[V];F.value.rings=u.default.removeAll(F.value.rings,e),F.value.rings.push(L.id)}}catch(e){O=!0,E=e}finally{try{!B&&D.return&&D.return()}finally{if(O)throw E}}for(var o=0;o<e.length;o++)for(var l=o+1;l<e.length;l++)this.removeRingConnectionsBetween(e[o],e[l]);var z=!0,_=!1,H=void 0;try{for(var W,j=a[Symbol.iterator]();!(z=(W=j.next()).done);z=!0){for(var q=W.value,U=this.getRingConnections(q,e),l=0;l<U.length;l++)this.getRingConnection(U[l]).updateOther(L.id,q)
;this.getRing(q).neighbours.push(L.id)}}catch(e){_=!0,H=e}finally{try{!z&&j.return&&j.return()}finally{if(_)throw H}}return L}},{key:"areVerticesInSameRing",value:function(e,t){for(var r=0;r<e.value.rings.length;r++)for(var i=0;i<t.value.rings.length;i++)if(e.value.rings[r]===t.value.rings[i])return!0;return!1}},{key:"getCommonRings",value:function(e,t){for(var r=Array(),i=0;i<e.value.rings.length;i++)for(var n=0;n<t.value.rings.length;n++)e.value.rings[i]==t.value.rings[n]&&r.push(e.value.rings[i]);return r}},{key:"getLargestOrAromaticCommonRing",value:function(e,t){for(var r=this.getCommonRings(e,t),i=0,n=null,a=0;a<r.length;a++){var o=this.getRing(r[a]),s=o.getSize();if(o.isBenzeneLike(this.graph.vertices))return o;s>i&&(i=s,n=o)}return n}},{key:"getVerticesAt",value:function(e,t,r){for(var i=Array(),n=0;n<this.graph.vertices.length;n++){var a=this.graph.vertices[n];if(a.id!==r&&a.positioned){e.distanceSq(a.position)<=t*t&&i.push(a.id)}}return i}},{key:"getClosestVertex",value:function(e){for(var t=99999,r=null,i=0;i<this.graph.vertices.length;i++){var n=this.graph.vertices[i];if(n.id!==e.id){var a=e.position.distanceSq(n.position);a<t&&(t=a,r=n)}}return r}},{key:"addRing",value:function(e){return e.id=this.ringIdCounter++,this.rings.push(e),e.id}},{key:"removeRing",value:function(e){this.rings=this.rings.filter(function(t){return t.id!==e}),this.ringConnections=this.ringConnections.filter(function(t){return t.firstRingId!==e&&t.secondRingId!==e});for(var t=0;t<this.rings.length;t++){var r=this.rings[t];r.neighbours=r.neighbours.filter(function(t){return t!==e})}}},{key:"getRing",value:function(e){for(var t=0;t<this.rings.length;t++)if(this.rings[t].id==e)return this.rings[t]}},{key:"addRingConnection",value:function(e){return e.id=this.ringConnectionIdCounter++,this.ringConnections.push(e),e.id}},{key:"removeRingConnection",value:function(e){this.ringConnections=this.ringConnections.filter(function(t){return t.id!==e})}},{key:"removeRingConnectionsBetween",value:function(e,t){for(var r=Array(),i=0;i<this.ringConnections.length;i++){var n=this.ringConnections[i];(n.firstRingId===e&&n.secondRingId===t||n.firstRingId===t&&n.secondRingId===e)&&r.push(n.id)}for(var i=0;i<r.length;i++)this.removeRingConnection(r[i])}},{key:"getRingConnection",value:function(e){for(var t=0;t<this.ringConnections.length;t++)if(this.ringConnections[t].id==e)return this.ringConnections[t]}},{key:"getRingConnections",value:function(e,t){for(var r=Array(),i=0;i<this.ringConnections.length;i++)for(var n=this.ringConnections[i],a=0;a<t.length;a++){var o=t[a];(n.firstRingId===e&&n.secondRingId===o||n.firstRingId===o&&n.secondRingId===e)&&r.push(n.id)}return r}},{key:"getOverlapScore",value:function(){for(var e=0,t=new Float32Array(this.graph.vertices.length),r=0;r<this.graph.vertices.length;r++)t[r]=0;for(var r=0;r<this.graph.vertices.length;r++)for(var i=this.graph.vertices.length;--i>r;){var n=this.graph.vertices[r],a=this.graph.vertices[i];if(n.value.isDrawn&&a.value.isDrawn){var o=c.default.subtract(n.position,a.position).lengthSq();if(o<this.opts.bondLengthSq){var s=(this.opts.bondLength-Math.sqrt(o))/this.opts.bondLength;e+=s,t[r]+=s,t[i]+=s}}}for(var l=Array(),r=0;r<this.graph.vertices.length;r++)l.push({id:r,score:t[r]});return l.sort(function(e,t){return t.score-e.score}),{total:e,scores:l,vertexScores:t}}},{key:"chooseSide",value:function(e,t,r){for(var i=e.getNeighbours(t.id),n=t.getNeighbours(e.id),a=i.length,o=n.length,s=u.default.merge(i,n),l=[0,0],h=0;h<s.length;h++){this.graph.vertices[s[h]].position.sameSideAs(e.position,t.position,r[0])?l[0]++:l[1]++}for(var g=[0,0],h=0;h<this.graph.vertices.length;h++){this.graph.vertices[h].position.sameSideAs(e.position,t.position,r[0])?g[0]++:g[1]++}return{totalSideCount:g,totalPosition:g[0]>g[1]?0:1,sideCount:l,position:l[0]>l[1]?0:1,anCount:a,bnCount:o}}},{key:"setRingCenter",value:function(e){for(var t=e.getSize(),r=new c.default(0,0),i=0;i<t;i++)r.add(this.graph.vertices[e.members[i]].position);e.center=r.divide(t)}},{key:"getSubringCenter",value:function(e,t){for(var r=t.value.originalRings,i=e.center,n=Number.MAX_VALUE,a=0;a<r.length;a++)for(var o=0;o<e.rings.length;o++)r[a]===e.rings[o].id&&e.rings[o].getSize()<n&&(i=e.rings[o].center,n=e.rings[o].getSize());return i}},{key:"drawEdges",value:function(e){var t=this,r=Array(this.graph.edges.length);if(r.fill(!1),this.graph.traverseBF(0,function(i){for(var n=t.graph.getEdges(i.id),a=0;a<n.length;a++){var o=n[a];r[o]||(r[o]=!0,t.drawEdge(o,e))}}),!this.bridgedRing)for(var i=0;i<this.rings.length;i++){var n=this.rings[i];this.isRingAromatic(n)&&this.canvasWrapper.drawAromaticityRing(n)}}},{key:"drawEdge",value:function(e,t){var r=this,i=this.graph.edges[e],n=this.graph.vertices[i.sourceId],a=this.graph.vertices[i.targetId],o=n.value.element,s=a.value.element;if(n.value.isDrawn&&a.value.isDrawn||"default"!==this.opts.atomVisualization){var l=n.position,h=a.position,g=this.getEdgeNormals(i),d=u.default.clone(g);if(d[0].multiplyScalar(10).add(l),d[1].multiplyScalar(10).add(l),"="===i.bondType||"="===this.getRingbondType(n,a)||i.isPartOfAromaticRing&&this.bridgedRing){var v=this.areVerticesInSameRing(n,a),p=this.chooseSide(n,a,d);if(v){var y=this.getLargestOrAromaticCommonRing(n,a),m=y.center;g[0].multiplyScalar(r.opts.bondSpacing),g[1].multiplyScalar(r.opts.bondSpacing);var b=null;b=m.sameSideAs(n.position,a.position,c.default.add(l,g[0]))?new f.default(c.default.add(l,g[0]),c.default.add(h,g[0]),o,s):new f.default(c.default.add(l,g[1]),c.default.add(h,g[1]),o,s),b.shorten(this.opts.bondLength-this.opts.shortBondLength),i.isPartOfAromaticRing?this.canvasWrapper.drawLine(b,!0):this.canvasWrapper.drawLine(b),this.canvasWrapper.drawLine(new f.default(l,h,o,s))}else if(i.center){g[0].multiplyScalar(r.opts.halfBondSpacing),g[1].multiplyScalar(r.opts.halfBondSpacing);var A=new f.default(c.default.add(l,g[0]),c.default.add(h,g[0]),o,s),x=new f.default(c.default.add(l,g[1]),c.default.add(h,g[1]),o,s);this.canvasWrapper.drawLine(A),this.canvasWrapper.drawLine(x)}else if(0==p.anCount&&p.bnCount>1||0==p.bnCount&&p.anCount>1){g[0].multiplyScalar(r.opts.halfBondSpacing),g[1].multiplyScalar(r.opts.halfBondSpacing);var S=new f.default(c.default.add(l,g[0]),c.default.add(h,g[0]),o,s),k=new f.default(c.default.add(l,g[1]),c.default.add(h,g[1]),o,s);this.canvasWrapper.drawLine(S),this.canvasWrapper.drawLine(k)}else if(p.sideCount[0]>p.sideCount[1]){g[0].multiplyScalar(r.opts.bondSpacing),g[1].multiplyScalar(r.opts.bondSpacing);var w=new f.default(c.default.add(l,g[0]),c.default.add(h,g[0]),o,s);w.shorten(this.opts.bondLength-this.opts.shortBondLength),this.canvasWrapper.drawLine(w),this.canvasWrapper.drawLine(new f.default(l,h,o,s))}else if(p.sideCount[0]<p.sideCount[1]){g[0].multiplyScalar(r.opts.bondSpacing),g[1].multiplyScalar(r.opts.bondSpacing);var C=new f.default(c.default.add(l,g[1]),c.default.add(h,g[1]),o,s);C.shorten(this.opts.bondLength-this.opts.shortBondLength),this.canvasWrapper.drawLine(C),this.canvasWrapper.drawLine(new f.default(l,h,o,s))}else if(p.totalSideCount[0]>p.totalSideCount[1]){g[0].multiplyScalar(r.opts.bondSpacing),g[1].multiplyScalar(r.opts.bondSpacing);var R=new f.default(c.default.add(l,g[0]),c.default.add(h,g[0]),o,s);R.shorten(this.opts.bondLength-this.opts.shortBondLength),this.canvasWrapper.drawLine(R),this.canvasWrapper.drawLine(new f.default(l,h,o,s))}else if(p.totalSideCount[0]<=p.totalSideCount[1]){g[0].multiplyScalar(r.opts.bondSpacing),g[1].multiplyScalar(r.opts.bondSpacing);var P=new f.default(c.default.add(l,g[1]),c.default.add(h,g[1]),o,s);P.shorten(this.opts.bondLength-this.opts.shortBondLength),this.canvasWrapper.drawLine(P),this.canvasWrapper.drawLine(new f.default(l,h,o,s))}}else if("#"===i.bondType){g[0].multiplyScalar(r.opts.bondSpacing/1.5),g[1].multiplyScalar(r.opts.bondSpacing/1.5);var T=new f.default(c.default.add(l,g[0]),c.default.add(h,g[0]),o,s),N=new f.default(c.default.add(l,g[1]),c.default.add(h,g[1]),o,s);this.canvasWrapper.drawLine(T),this.canvasWrapper.drawLine(N),this.canvasWrapper.drawLine(new f.default(l,h,o,s))}else if("."===i.bondType);else{var I=n.value.bracket&&n.value.bracket.chirality,L=a.value.bracket&&a.value.bracket.chirality;"up"===i.chiral?this.canvasWrapper.drawWedge(new f.default(l,h,o,s,I,L)):"down"===i.chiral?this.canvasWrapper.drawDashedWedge(new f.default(l,h,o,s,I,L)):this.canvasWrapper.drawLine(new f.default(l,h,o,s,I,L))}if(t){var B=c.default.midpoint(l,h);this.canvasWrapper.drawDebugText(B.x,B.y,"e: "+e)}}}},{key:"drawVertices",value:function(e){for(var t=this.graph.vertices.length,t=0;t<this.graph.vertices.length;t++){var r=this.graph.vertices[t],i=r.value,n=0,a=0,o=this.getBondCount(r),s=i.element,l=b.default.maxBonds[s]-o,h=r.getTextDirection(this.graph.vertices),g=!(!this.opts.terminalCarbons&&"C"===s&&!i.hasAttachedPseudoElements)&&r.isTerminal(),d="C"===i.element;if(i.bracket&&(l=i.bracket.hcount,n=i.bracket.charge,a=i.bracket.isotope),"allballs"===this.opts.atomVisualization)this.canvasWrapper.drawBall(r.position.x,r.position.y,s);else if(i.isDrawn&&(!d||i.drawExplicit||g||i.hasAttachedPseudoElements))"default"===this.opts.atomVisualization?this.canvasWrapper.drawText(r.position.x,r.position.y,s,l,h,g,n,a,i.getAttachedPseudoElements()):"balls"===this.opts.atomVisualization&&this.canvasWrapper.drawBall(r.position.x,r.position.y,s);else if(2===r.getNeighbourCount()&&1==r.forcePositioned){var f=this.graph.vertices[r.neighbours[0]].position,v=this.graph.vertices[r.neighbours[1]].position,p=c.default.threePointangle(r.position,f,v);Math.abs(Math.PI-p)<.1&&this.canvasWrapper.drawPoint(r.position.x,r.position.y,s)}if(e){var y="v: "+r.id+" "+u.default.print(i.ringbonds);this.canvasWrapper.drawDebugText(r.position.x,r.position.y,y)}}if(this.opts.debug)for(var t=0;t<this.rings.length;t++){var m=this.rings[t].center;this.canvasWrapper.drawDebugPoint(m.x,m.y,"r: "+this.rings[t].id)}}},{key:"position",value:function(){for(var e=null,t=0;t<this.graph.vertices.length;t++)if(null!==this.graph.vertices[t].value.bridgedRing){e=this.graph.vertices[t];break}for(var t=0;t<this.rings.length;t++)this.rings[t].isBridged&&(e=this.graph.vertices[this.rings[t].members[0]]);this.rings.length>0&&null===e&&(e=this.graph.vertices[this.rings[0].members[0]]),null===e&&(e=this.graph.vertices[0]),this.createNextBond(e)}},{key:"backupRingInformation",value:function(){this.originalRings=Array(),this.originalRingConnections=Array();for(var e=0;e<this.rings.length;e++)this.originalRings.push(this.rings[e]);for(var e=0;e<this.ringConnections.length;e++)this.originalRingConnections.push(this.ringConnections[e]);for(var e=0;e<this.graph.vertices.length;e++)this.graph.vertices[e].value.backupRings()}},{key:"restoreRingInformation",value:function(){var e=this.getBridgedRings();this.rings=Array(),this.ringConnections=Array();for(var t=0;t<e.length;t++)for(var r=e[t],i=0;i<r.rings.length;i++){var n=r.rings[i];this.originalRings[n.id].center=n.center}for(var t=0;t<this.originalRings.length;t++)this.rings.push(this.originalRings[t]);for(var t=0;t<this.originalRingConnections.length;t++)this.ringConnections.push(this.originalRingConnections[t]);for(var t=0;t<this.graph.vertices.length;t++)this.graph.vertices[t].value.restoreRings()}},{key:"createRing",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!e.positioned){t=t||new c.default(0,0);var n=e.getOrderedNeighbours(this.ringConnections),a=r?c.default.subtract(r.position,t).angle():0,o=l.default.polyCircumradius(this.opts.bondLength,e.getSize()),s=l.default.centralAngle(e.getSize());e.centralAngle=s;var h=a,u=this,g=r?r.id:null;-1===e.members.indexOf(g)&&(r&&(r.positioned=!1),g=e.members[0]);var d=Array();if(e.isBridged){this.graph.kkLayout(e.members.slice(),d,t,r.id,e,this.opts.bondLength),e.positioned=!0,this.setRingCenter(e),t=e.center;for(var f=0;f<e.rings.length;f++)this.setRingCenter(e.rings[f])}else e.eachMember(this.graph.vertices,function(r){var i=u.graph.vertices[r];i.positioned||i.setPosition(t.x+Math.cos(h)*o,t.y+Math.sin(h)*o),h+=s,(!e.isBridged||e.rings.length<3)&&(i.positioned=!0)},g,i?i.id:null);e.positioned=!0,e.center=t;for(var f=0;f<n.length;f++){var v=this.getRing(n[f].neighbour);if(!v.positioned){var p=k.default.getVertices(this.ringConnections,e.id,v.id);if(2===p.length){e.isFused=!0,v.isFused=!0;var y=this.graph.vertices[p[0]],m=this.graph.vertices[p[1]],b=c.default.midpoint(y.position,m.position),A=c.default.normals(y.position,m.position);A[0].normalize(),A[1].normalize();var x=l.default.polyCircumradius(this.opts.bondLength,v.getSize()),S=l.default.apothem(x,v.getSize());A[0].multiplyScalar(S).add(b),A[1].multiplyScalar(S).add(b);var w=A[0];c.default.subtract(t,A[1]).lengthSq()>c.default.subtract(t,A[0]).lengthSq()&&(w=A[1]);var C=c.default.subtract(y.position,w),R=c.default.subtract(m.position,w);-1===C.clockwise(R)?v.positioned||this.createRing(v,w,y,m):v.positioned||this.createRing(v,w,m,y)}else if(1===p.length){e.isSpiro=!0,v.isSpiro=!0;var P=this.graph.vertices[p[0]],T=c.default.subtract(t,P.position);T.invert(),T.normalize();var N=l.default.polyCircumradius(this.opts.bondLength,v.getSize());T.multiplyScalar(N),T.add(P.position),v.positioned||this.createRing(v,T,P)}}}for(var f=0;f<e.members.length;f++)for(var I=this.graph.vertices[e.members[f]],L=I.getNeighbours(),B=0;B<L.length;B++){var O=this.graph.vertices[L[B]];O.positioned||(O.value.isConnectedToRing=!0,this.createNextBond(O,I))}for(var f=0;f<d.length;f++){var E=this.graph.vertices[d[f][1]],M=this.graph.vertices[d[f][0]];M.previousPosition=E.position,this.createNextBond(M,E,0,0,!0)}}}},{key:"rotateSubtree",value:function(e,t,r,i){var n=this;this.graph.traverseTree(e,t,function(e){e.position.rotateAround(r,i);for(var t=0;t<e.value.anchoredRings.length;t++){var a=n.rings[e.value.anchoredRings[t]];a&&a.center.rotateAround(r,i)}})}},{key:"getSubtreeOverlapScore",value:function(e,t,r){var i=this,n=0,a=new c.default(0,0);return this.graph.traverseTree(e,t,function(e){var t=r[e.id];n+=t;var o=i.graph.vertices[e.id].position.clone();o.multiplyScalar(t),a.add(o)}),a.divide(n),{value:n,center:a}}},{key:"getCurrentCenterOfMass",value:function(){for(var e=new c.default(0,0),t=0,r=0;r<this.graph.vertices.length;r++){var i=this.graph.vertices[r];i.positioned&&(e.add(i.position),t++)}return e.divide(t)}},{key:"getCurrentCenterOfMassInNeigbourhood",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2*this.opts.bondLength,r=new c.default(0,0),i=0,n=t*t,a=0;a<this.graph.vertices.length;a++){var o=this.graph.vertices[a];o.positioned&&e.distanceSq(o.position)<n&&(r.add(o.position),i++)}return r.divide(i)}},{key:"resolvePrimaryOverlaps",value:function(){for(var e=Array(),t=Array(this.graph.vertices.length),r=0;r<this.rings.length;r++)for(var i=this.rings[r],n=0;n<i.members.length;n++){var a=this.graph.vertices[i.members[n]];if(!t[a.id]){t[a.id]=!0;var o=this.getNonRingNeighbours(a.id);if(o.length>1){for(var s=Array(),l=0;l<a.value.rings.length;l++)s.push(a.value.rings[l]);e.push({common:a,rings:s,vertices:o})}}}for(var r=0;r<e.length;r++){var h=e[r];if(2===h.vertices.length){var u=h.vertices[0],g=h.vertices[1];if(!u.value.isDrawn||!g.value.isDrawn)continue;var c=(2*Math.PI-this.getRing(h.rings[0]).getAngle())/6;this.rotateSubtree(u.id,h.common.id,c,h.common.position),this.rotateSubtree(g.id,h.common.id,-c,h.common.position);var d=this.getOverlapScore(),f=this.getSubtreeOverlapScore(u.id,h.common.id,d.vertexScores),v=this.getSubtreeOverlapScore(g.id,h.common.id,d.vertexScores),p=f.value+v.value;this.rotateSubtree(u.id,h.common.id,-2*c,h.common.position),this.rotateSubtree(g.id,h.common.id,2*c,h.common.position),d=this.getOverlapScore(),f=this.getSubtreeOverlapScore(u.id,h.common.id,d.vertexScores),v=this.getSubtreeOverlapScore(g.id,h.common.id,d.vertexScores),f.value+v.value>p&&(this.rotateSubtree(u.id,h.common.id,2*c,h.common.position),this.rotateSubtree(g.id,h.common.id,-2*c,h.common.position))}}}},{key:"resolveSecondaryOverlaps",value:function(e){for(var t=0;t<e.length;t++)if(e[t].score>this.opts.bondLength/(4*this.opts.bondLength)){var r=this.graph.vertices[e[t].id];if(r.isTerminal()){var i=this.getClosestVertex(r);if(i){var n=null;n=i.isTerminal()?0===i.id?this.graph.vertices[1].position:i.previousPosition:0===i.id?this.graph.vertices[1].position:i.position;var a=0===r.id?this.graph.vertices[1].position:r.previousPosition;r.position.rotateAwayFrom(n,a,l.default.toRad(20))}}}}},{key:"createNextBond",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!e.positioned||n){if(!n)if(t)if(1===t.value.originalRings.length){for(var a=Array(),o=t.getNeighbours(),s=0;s<o.length;s++){var h=this.graph.vertices[o[s]];h.positioned&&h.value.originalRings.length>0&&a.push(c.default.subtract(h.position,t.position))}var g=c.default.averageDirection(a);e.setPositionFromVector(g.invert().multiplyScalar(this.opts.bondLength).add(t.position)),e.previousPosition=t.position,e.positioned=!0}else if(t.value.originalRings.length>1){for(var d=Array(),f=t.getNeighbours(),s=0;s<f.length;s++){var v=this.graph.vertices[f[s]];v.positioned&&v.value.originalRings.length>1&&d.push(c.default.subtract(v.position,t.position))}var p=c.default.averageDirection(d);p.invert().multiplyScalar(this.opts.bondLength).add(t.position);for(var s=0;s<f.length;s++){var y=this.graph.vertices[f[s]];if(y.positioned&&c.default.threePointangle(p,t.position,y.position)>3.1){p.rotateAround(Math.PI,t.position);break}}e.previousPosition=t.position,e.setPositionFromVector(p),e.positioned=!0}else{var m=new c.default(this.opts.bondLength,0);m.rotate(r),m.add(t.position),e.globalAngle=r,e.setPositionFromVector(m),e.previousPosition=t.position,e.positioned=!0}else{var b=new c.default(this.opts.bondLength,0);b.rotate(l.default.toRad(-120)),e.previousPosition=b,e.setPosition(this.opts.bondLength,0),e.angle=l.default.toRad(-120),e.globalAngle=e.angle,null===e.value.bridgedRing&&(e.positioned=!0)}if(null!==e.value.bridgedRing){var A=this.getRing(e.value.bridgedRing),x=c.default.subtract(e.previousPosition,e.position);x.invert(),x.normalize();var S=l.default.polyCircumradius(this.opts.bondLength,A.members.length);x.multiplyScalar(S),x.add(e.position),A.positioned||this.createRing(A,x,e)}else if(e.value.rings.length>0){var k=this.getRing(e.value.rings[0]),w=c.default.subtract(e.previousPosition,e.position);w.invert(),w.normalize();var C=l.default.polyCircumradius(this.opts.bondLength,k.getSize());w.multiplyScalar(C),w.add(e.position),k.positioned||this.createRing(k,w,e)}else{var R=e.getNeighbours();t&&(R=u.default.remove(R,t.id));var P=e.getAngle();if(1===R.length){var T=this.graph.vertices[R[0]];if("#"===e.value.bondType||t&&"#"===t.value.bondType||"="===e.value.bondType&&t&&"="===t.value.bondType){if(e.value.drawExplicit=!1,t){var N=this.graph.getEdge(e.id,t.id);N.center=!0}var I=this.graph.getEdge(e.id,T.id);I.center=!0,T.drawExplicit=!0,T.globalAngle=P,T.angle=0,this.createNextBond(T,e,T.globalAngle,-i)}else if(t&&t.value.rings.length>0){var L=l.default.toRad(60),B=-L,O=new c.default(this.opts.bondLength,0),E=new c.default(this.opts.bondLength,0);O.rotate(L).add(e.position),E.rotate(B).add(e.position);var M=this.getCurrentCenterOfMass(),D=O.distanceSq(M),V=E.distanceSq(M);T.angle=D<V?B:L,i=T.angle>0?-1:1,T.globalAngle=P+T.angle,this.createNextBond(T,e,T.globalAngle,i)}else{if(i)T.angle=l.default.toRad(60)*i,i=-i;else{var F=l.default.toRad(60),z=-F,_=new c.default(this.opts.bondLength,0),H=new c.default(this.opts.bondLength,0);_.rotate(F).add(e.position),H.rotate(z).add(e.position);var W=this.getCurrentCenterOfMass(),j=_.distanceSq(W),q=H.distanceSq(W);T.angle=j<q?z:F,i=T.angle>0?-1:1}T.globalAngle=P+T.angle,this.createNextBond(T,e,T.globalAngle,i)}}else if(2===R.length){var U=this.graph.getTreeDepth(R[0],e.id),G=this.graph.getTreeDepth(R[1],e.id),X=this.graph.getTreeDepth(t?t.id:null,e.id),Y=0,K=1;U>G&&(Y=1,K=0);var Z=this.graph.vertices[R[Y]],$=this.graph.vertices[R[K]];X<U&&X<G?1===e.position.clockwise(e.previousPosition)?($.angle=l.default.toRad(60),Z.angle=-l.default.toRad(60),$.globalAngle=P+$.angle,Z.globalAngle=P+Z.angle,this.createNextBond($,e,$.globalAngle,-i),this.createNextBond(Z,e,Z.globalAngle,i)):($.angle=-l.default.toRad(60),Z.angle=l.default.toRad(60),$.globalAngle=P+$.angle,Z.globalAngle=P+Z.angle,this.createNextBond(Z,e,Z.globalAngle,i),this.createNextBond($,e,$.globalAngle,-i)):1===e.position.clockwise(e.previousPosition)?($.angle=l.default.toRad(60),Z.angle=-l.default.toRad(60),$.globalAngle=P+$.angle,Z.globalAngle=P+Z.angle,this.createNextBond($,e,$.globalAngle,-i),this.createNextBond(Z,e,Z.globalAngle,-i)):($.angle=-l.default.toRad(60),Z.angle=l.default.toRad(60),$.globalAngle=P+$.angle,Z.globalAngle=P+Z.angle,this.createNextBond(Z,e,Z.globalAngle,-i),this.createNextBond($,e,$.globalAngle,-i))}else if(3===R.length){var J=this.graph.getTreeDepth(R[0],e.id),Q=this.graph.getTreeDepth(R[1],e.id),ee=this.graph.getTreeDepth(R[2],e.id),te=this.graph.vertices[R[0]],re=this.graph.vertices[R[1]],ie=this.graph.vertices[R[2]];if(Q>J&&Q>ee?(te=this.graph.vertices[R[1]],re=this.graph.vertices[R[0]],ie=this.graph.vertices[R[2]]):ee>J&&ee>Q&&(te=this.graph.vertices[R[2]],re=this.graph.vertices[R[0]],ie=this.graph.vertices[R[1]]),1===this.graph.getTreeDepth(re.id,e.id)&&1===this.graph.getTreeDepth(ie.id,e.id)&&this.graph.getTreeDepth(te.id,e.id)>1){if(i)te.angle=l.default.toRad(60)*i,i=-i;else{var ne=l.default.toRad(60),ae=-ne,oe=new c.default(this.opts.bondLength,0),se=new c.default(this.opts.bondLength,0);oe.rotate(ne).add(e.position),se.rotate(ae).add(e.position);var le=this.getCurrentCenterOfMass(),he=oe.distanceSq(le),ue=se.distanceSq(le);te.angle=he<ue?ae:ne,i=te.angle>0?-1:1}te.globalAngle=P+te.angle,this.createNextBond(te,e,te.globalAngle,-i),e.value.bracket&&"@@"===e.value.bracket.chirality?(ie.angle=l.default.toRad(30)*i,re.angle=l.default.toRad(90)*i,ie.globalAngle=P+ie.angle,re.globalAngle=P+re.angle,this.createNextBond(ie,e,ie.globalAngle),this.createNextBond(re,e,re.globalAngle)):(re.angle=l.default.toRad(30)*i,ie.angle=l.default.toRad(90)*i,re.globalAngle=P+re.angle,ie.globalAngle=P+ie.angle,this.createNextBond(re,e,re.globalAngle),this.createNextBond(ie,e,ie.globalAngle))}else te.angle=0,re.angle=l.default.toRad(90),ie.angle=-l.default.toRad(90),te.globalAngle=P+te.angle,re.globalAngle=P+re.angle,ie.globalAngle=P+ie.angle,this.createNextBond(te,e,te.globalAngle),this.createNextBond(re,e,re.globalAngle),this.createNextBond(ie,e,ie.globalAngle)}else if(4===R.length){var ge=this.graph.getTreeDepth(R[0],e.id),ce=this.graph.getTreeDepth(R[1],e.id),de=this.graph.getTreeDepth(R[2],e.id),fe=this.graph.getTreeDepth(R[3],e.id),ve=this.graph.vertices[R[0]],pe=this.graph.vertices[R[1]],ye=this.graph.vertices[R[2]],me=this.graph.vertices[R[3]];ce>ge&&ce>de&&ce>fe?(ve=this.graph.vertices[R[1]],pe=this.graph.vertices[R[0]],ye=this.graph.vertices[R[2]],me=this.graph.vertices[R[3]]):de>ge&&de>ce&&de>fe?(ve=this.graph.vertices[R[2]],pe=this.graph.vertices[R[0]],ye=this.graph.vertices[R[1]],me=this.graph.vertices[R[3]]):fe>ge&&fe>ce&&fe>de&&(ve=this.graph.vertices[R[3]],pe=this.graph.vertices[R[0]],ye=this.graph.vertices[R[1]],me=this.graph.vertices[R[2]]),ve.angle=-l.default.toRad(36),pe.angle=l.default.toRad(36),ye.angle=-l.default.toRad(108),me.angle=l.default.toRad(108),ve.globalAngle=P+ve.angle,pe.globalAngle=P+pe.angle,ye.globalAngle=P+ye.angle,me.globalAngle=P+me.angle,this.createNextBond(ve,e,ve.globalAngle),this.createNextBond(pe,e,pe.globalAngle),this.createNextBond(ye,e,ye.globalAngle),this.createNextBond(me,e,me.globalAngle)}}}}},{key:"getCommonRingbondNeighbour",value:function(e){for(var t=e.getNeighbours(),r=0;r<t.length;r++){var i=this.graph.vertices[t[r]];if(u.default.containsAll(i.value.rings,e.value.rings))return i}return null}},{key:"isPointInRing",value:function(e){for(var t=0;t<this.rings.length;t++){var r=this.rings[t];if(r.positioned){var i=l.default.polyCircumradius(this.opts.bondLength,r.getSize()),n=i*i;if(e.distanceSq(r.center)<n)return!0}}return!1}},{key:"isEdgeInRing",value:function(e){var t=this.graph.vertices[e.sourceId],r=this.graph.vertices[e.targetId];return this.areVerticesInSameRing(t,r)}},{key:"isEdgeRotatable",value:function(e){var t=this.graph.vertices[e.sourceId],r=this.graph.vertices[e.targetId];return"-"===e.bondType&&(!(t.getNeighbourCount()+r.getNeighbourCount()<5)&&!(t.value.rings.length>0&&r.value.rings.length>0&&this.areVerticesInSameRing(t,r)))}},{key:"isRingAromatic",value:function(e){for(var t=0;t<e.members.length;t++){if(!this.graph.vertices[e.members[t]].value.isPartOfAromaticRing)return!1}return!0}},{key:"getEdgeNormals",value:function(e){var t=this.graph.vertices[e.sourceId].position,r=this.graph.vertices[e.targetId].position;return c.default.units(t,r)}},{key:"getBondCount",value:function(e){for(var t=0,r=0;r<e.edges.length;r++)t+=this.graph.edges[e.edges[r]].weight;return t}},{key:"getNonRingNeighbours",value:function(e){for(var t=Array(),r=this.graph.vertices[e],i=r.getNeighbours(),n=0;n<i.length;n++){var a=this.graph.vertices[i[n]];0===u.default.intersection(r.value.rings,a.value.rings).length&&0==a.value.isBridge&&t.push(a)}return t}},{key:"annotateStereochemistry",value:function(){for(var e=this,t=0;t<this.graph.vertices.length;t++){var r,r;(function(){var i=e.graph.vertices[t];if(!i.value.bracket||!i.value.bracket.chirality)return"continue";var n=i.getNeighbours();n.sort();var a=n.length,o=Array(a);for(r=0;r<a;r++){var s=new Uint8Array(e.graph.vertices.length),l=new Uint16Array(21);s[i.id]=1,e.visitStereochemistry(n[r],s,l,10,0),l[20]=n[r],o[r]=[r,l]}o.sort(function(e,t){for(var r=0;r<a;r++){if(e[1][r]>t[1][r])return-1;if(e[1][r]<t[1][r])return 1}return 0});var h=new Uint8Array(a);for(r=0;r<a;r++)h[r]=o[r][0]})()}}},{key:"visitStereochemistry",value:function(e,t,r,i,n){t[e]=1;var a=this.graph.vertices[e].value.getAtomicNumber();r[i+n]+=a,r[n]=Math.max(r[n],a);for(var o=this.graph.vertices[e].getNeighbours(),s=0;s<o.length;s++)1!==t[o[s]]&&n<i-1&&this.visitStereochemistry(o[s],t,r,i,n+1)}},{key:"initPseudoElements",value:function(){for(var e=0;e<this.graph.vertices.length;e++){for(var t=this.graph.vertices[e],r=t.getNeighbours(),i=Array(r.length),n=0;n<r.length;n++)i[n]=this.graph.vertices[r[n]];if(!(t.getNeighbourCount()<3||t.value.rings.length>0)){for(var a=0,o=0,n=0;n<i.length;n++){var s=i[n],l=s.value.element,h=s.getNeighbourCount();"C"!==l&&"H"!==l&&1===h&&a++,h>1&&o++}if(!(o>1||a<2)){for(var u=null,n=0;n<i.length;n++){var g=i[n];g.getNeighbourCount()>1&&(u=g)}for(var n=0;n<i.length;n++){var c=i[n];if(!(c.getNeighbourCount()>1)){c.value.isDrawn=!1;var d=b.default.maxBonds[c.value.element]-this.getBondCount(c);c.value.bracket&&(d=c.value.bracket.hcount),t.value.attachPseudoElement(c.value.element,u?u.value.element:null,d)}}}}}for(var e=0;e<this.graph.vertices.length;e++){var f=this.graph.vertices[e],v=f.value,p=v.element;if("C"!==p&&"H"!==p&&v.isDrawn){for(var y=f.getNeighbours(),m=Array(y.length),n=0;n<y.length;n++)m[n]=this.graph.vertices[y[n]];for(var n=0;n<m.length;n++){var A=m[n].value;if(A.hasAttachedPseudoElements&&2===A.getAttachedPseudoElementsCount()){var x=A.getAttachedPseudoElements();x.hasOwnProperty("0O")&&x.hasOwnProperty("3C")&&(A.isDrawn=!1,f.value.attachPseudoElement("Ac","",0))}}}}}}]),e}();r.default=I},{"./ArrayHelper":2,"./Atom":3,"./CanvasWrapper":4,"./Edge":6,"./Graph":7,"./Line":8,"./MathHelper":9,"./Ring":11,"./RingConnection":12,"./SSSR":13,"./Vector2":14,"./Vertex":15}],6:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;i(this,e),this.id=null,this.sourceId=t,this.targetId=r,this.weight=n,this.bondType="-",this.isPartOfAromaticRing=!1,this.center=!1,this.chiral=""}return n(e,[{key:"setBondType",value:function(t){this.bondType=t,this.weight=e.bonds[t]}}],[{key:"bonds",get:function(){return{"-":1,"/":1,"\\":1,"=":2,"#":3,$:4}}}]),e}();r.default=a},{}],7:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){var r=[],i=!0,n=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);i=!0);}catch(e){n=!0,a=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw a}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=e("./MathHelper"),l=i(s),h=e("./Vector2"),u=(i(h),e("./Vertex")),g=i(u),c=e("./Edge"),d=i(c),f=e("./Ring"),v=(i(f),e("./Atom")),p=i(v),y=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];n(this,e),this.vertices=Array(),this.edges=Array(),this.vertexIdsToEdgeId={},this.elementCount={},this.isomeric=r,this._time=0,this._init(t),this._initInfos()}return o(e,[{key:"_init",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=new p.default(e.atom.element?e.atom.element:e.atom,e.bond);n.branchBond=e.branchBond,n.ringbonds=e.ringbonds,n.bracket=e.atom.element?e.atom:null,n.setOrder(r,t);var a=new g.default(n),o=this.vertices[r];if(this.addVertex(a),null!==r){a.setParentVertexId(r),a.value.addNeighbouringElement(o.value.element),o.addChild(a.id),o.value.addNeighbouringElement(n.element),o.spanningTreeChildren.push(a.id);var s=new d.default(r,a.id,1);i?s.setBondType(a.value.branchBond):s.setBondType(o.value.bondType);var l=this.addEdge(s);a.edges.push(l),o.edges.push(l)}if(n.bracket&&this.isomeric)for(var h=0;h<n.bracket.hcount;h++)this.isomeric&&this._init({atom:{element:"H",bond:"-"},ringbonds:Array()},h+1,a.id);var u=e.ringbondCount+1;n.bracket&&(u+=n.bracket.hcount);var c=0;if(n.bracket&&n.bracket.chirality){c=n.bracket.hcount;for(var h=0;h<c;h++)this._init({atom:"H",isBracket:"false",branches:Array(),branchCount:0,ringbonds:Array(),ringbondCount:!1,next:null,hasNext:!1,bond:"-"},h,a.id,!0)}for(var h=0;h<e.branchCount;h++)this._init(e.branches[h],h+u,a.id,!0);e.hasNext&&this._init(e.next,e.branchCount+u,a.id)}},{key:"_initInfos",value:function(){for(var e=0;e<this.vertices.length;e++){var t=this.vertices[e].value;void 0!==this.elementCount[t.element]?this.elementCount[t.element]+=1:this.elementCount[t.element]=0}}},{key:"clear",value:function(){this.vertices=Array(),this.edges=Array(),this.vertexIdsToEdgeId={}}},{key:"addVertex",value:function(e){return e.id=this.vertices.length,this.vertices.push(e),e.id}},{key:"addEdge",value:function(e){return e.id=this.edges.length,this.edges.push(e),this.vertexIdsToEdgeId[e.sourceId+"_"+e.targetId]=e.id,this.vertexIdsToEdgeId[e.targetId+"_"+e.sourceId]=e.id,
e.isPartOfAromaticRing=this.vertices[e.sourceId].value.isPartOfAromaticRing&&this.vertices[e.targetId].value.isPartOfAromaticRing,e.id}},{key:"getEdge",value:function(e,t){var r=this.vertexIdsToEdgeId[e+"_"+t];return void 0===r?null:this.edges[r]}},{key:"getEdges",value:function(e){for(var t=Array(),r=this.vertices[e],i=0;i<r.neighbours.length;i++)t.push(this.vertexIdsToEdgeId[e+"_"+r.neighbours[i]]);return t}},{key:"hasEdge",value:function(e,t){return void 0!==this.vertexIdsToEdgeId[e+"_"+t]}},{key:"getVertexList",value:function(){for(var e=[this.vertices.length],t=0;t<this.vertices.length;t++)e[t]=this.vertices[t].id;return e}},{key:"getEdgeList",value:function(){for(var e=Array(this.edges.length),t=0;t<this.edges.length;t++)e[t]=[this.edges[t].sourceId,this.edges[t].targetId];return e}},{key:"getAdjacencyMatrix",value:function(){for(var e=this.vertices.length,t=Array(e),r=0;r<e;r++)t[r]=new Array(e),t[r].fill(0);for(var r=0;r<this.edges.length;r++){var i=this.edges[r];t[i.sourceId][i.targetId]=1,t[i.targetId][i.sourceId]=1}return t}},{key:"getComponentsAdjacencyMatrix",value:function(){for(var e=this.vertices.length,t=Array(e),r=this.getBridges(),i=0;i<e;i++)t[i]=new Array(e),t[i].fill(0);for(var i=0;i<this.edges.length;i++){var n=this.edges[i];t[n.sourceId][n.targetId]=1,t[n.targetId][n.sourceId]=1}for(var i=0;i<r.length;i++)t[r[i][0]][r[i][1]]=0,t[r[i][1]][r[i][0]]=0;return t}},{key:"getSubgraphAdjacencyMatrix",value:function(e){for(var t=e.length,r=Array(t),i=0;i<t;i++){r[i]=new Array(t),r[i].fill(0);for(var n=0;n<t;n++)i!==n&&this.hasEdge(e[i],e[n])&&(r[i][n]=1)}return r}},{key:"getDistanceMatrix",value:function(){for(var e=this.vertices.length,t=this.getAdjacencyMatrix(),r=Array(e),i=0;i<e;i++)r[i]=Array(e),r[i].fill(1/0);for(var i=0;i<e;i++)for(var n=0;n<e;n++)1===t[i][n]&&(r[i][n]=1);for(var a=0;a<e;a++)for(var i=0;i<e;i++)for(var n=0;n<e;n++)r[i][n]>r[i][a]+r[a][n]&&(r[i][n]=r[i][a]+r[a][n]);return r}},{key:"getSubgraphDistanceMatrix",value:function(e){for(var t=e.length,r=this.getSubgraphAdjacencyMatrix(e),i=Array(t),n=0;n<t;n++)i[n]=Array(t),i[n].fill(1/0);for(var n=0;n<t;n++)for(var a=0;a<t;a++)1===r[n][a]&&(i[n][a]=1);for(var o=0;o<t;o++)for(var n=0;n<t;n++)for(var a=0;a<t;a++)i[n][a]>i[n][o]+i[o][a]&&(i[n][a]=i[n][o]+i[o][a]);return i}},{key:"getAdjacencyList",value:function(){for(var e=this.vertices.length,t=Array(e),r=0;r<e;r++){t[r]=[];for(var i=0;i<e;i++)r!==i&&this.hasEdge(this.vertices[r].id,this.vertices[i].id)&&t[r].push(i)}return t}},{key:"getSubgraphAdjacencyList",value:function(e){for(var t=e.length,r=Array(t),i=0;i<t;i++){r[i]=Array();for(var n=0;n<t;n++)i!==n&&this.hasEdge(e[i],e[n])&&r[i].push(n)}return r}},{key:"getBridges",value:function(){var e=this.vertices.length,t=new Array(e),r=new Array(e),i=new Array(e),n=new Array(e),a=this.getAdjacencyList(),o=Array();t.fill(!1),n.fill(null),this._time=0;for(var s=0;s<e;s++)t[s]||this._bridgeDfs(s,t,r,i,n,a,o);return o}},{key:"traverseBF",value:function(e,t){var r=this.vertices.length,i=new Array(r);i.fill(!1);for(var n=[e];n.length>0;){var a=n.shift(),o=this.vertices[a];t(o);for(var s=0;s<o.neighbours.length;s++){var l=o.neighbours[s];i[l]||(i[l]=!0,n.push(l))}}}},{key:"getTreeDepth",value:function(e,t){if(null===e||null===t)return 0;for(var r=this.vertices[e].getSpanningTreeNeighbours(t),i=0,n=0;n<r.length;n++){var a=r[n],o=this.getTreeDepth(a,e);o>i&&(i=o)}return i+1}},{key:"traverseTree",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Number.MAX_SAFE_INTEGER,n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;if(null===o&&(o=new Uint8Array(this.vertices.length)),!(a>i+1||1===o[e])){o[e]=1;var s=this.vertices[e],l=s.getNeighbours(t);(!n||a>1)&&r(s);for(var h=0;h<l.length;h++)this.traverseTree(l[h],e,r,i,n,a+1,o)}}},{key:"kkLayout",value:function(e,t,r,i,n,o){for(var s=o,h=e.length;h--;)for(var u=this.vertices[e[h]],g=u.neighbours.length;g--;){var c=this.vertices[u.neighbours[g]];0===c.value.rings.length&&-1===e.indexOf(c.id)&&(e.push(c.id),t.push([c.id,u.id]))}var d=this.getSubgraphDistanceMatrix(e),f=e.length,v=l.default.polyCircumradius(500,f),p=l.default.centralAngle(f),y=0,m=new Float32Array(f),b=new Float32Array(f),A=Array(f);for(h=f;h--;){var x=this.vertices[e[h]];x.positioned?(m[h]=x.position.x,b[h]=x.position.y):(m[h]=r.x+Math.cos(y)*v,b[h]=r.y+Math.sin(y)*v),A[h]=x.positioned,y+=p}var S=Array(f);for(h=f;h--;){S[h]=new Array(f);for(var g=f;g--;)S[h][g]=o*d[h][g]}var k=Array(f);for(h=f;h--;){k[h]=Array(f);for(var g=f;g--;)k[h][g]=s*Math.pow(d[h][g],-2)}var w=Array(f),C=new Float32Array(f),R=new Float32Array(f);for(h=f;h--;)w[h]=Array(f);h=f;for(var P=void 0,T=void 0,N=void 0,I=void 0,L=void 0,B=void 0,O=void 0;h--;){P=m[h],T=b[h],N=0,I=0;for(var E=f;E--;)h!==E&&(L=m[E],B=b[E],O=1/Math.sqrt((P-L)*(P-L)+(T-B)*(T-B)),w[h][E]=[k[h][E]*(P-L-S[h][E]*(P-L)*O),k[h][E]*(T-B-S[h][E]*(T-B)*O)],w[E][h]=w[h][E],N+=w[h][E][0],I+=w[h][E][1]);C[h]=N,R[h]=I}for(var M=function(e){return[C[e]*C[e]+R[e]*R[e],C[e],R[e]]},D=1e9,V=0,F=0,z=0,_=0,H=0,W=0;D>.1&&1e3>H;){H++;var j=function(){var e=0,t=0,r=0,i=0;for(h=f;h--;){var n=M(h),o=a(n,3),s=o[0],l=o[1],u=o[2];s>e&&!1===A[h]&&(e=s,t=h,r=l,i=u)}return[t,e,r,i]}(),q=a(j,4);for(V=q[0],D=q[1],F=q[2],z=q[3],_=D,W=0;_>.1&&50>W;){W++,function(e,t,r){var i=0,n=0,a=0,o=m[e],s=b[e],l=S[e],u=k[e];for(h=f;h--;)if(h!==e){var g=m[h],c=b[h],d=l[h],v=u[h],p=(o-g)*(o-g),y=1/Math.pow(p+(s-c)*(s-c),1.5);i+=v*(1-d*(s-c)*(s-c)*y),n+=v*(1-d*p*y),a+=v*(d*(o-g)*(s-c)*y)}0===i&&(i=.1),0===n&&(n=.1),0===a&&(a=.1);var A=t/i+r/a;A/=a/i-n/a;var x=-(a*A+t)/i;m[e]+=x,b[e]+=A;var P=w[e];t=0,r=0,o=m[e],s=b[e];var T=void 0,N=void 0,I=void 0,L=void 0,B=void 0;for(h=f;h--;)e!==h&&(T=m[h],N=b[h],I=P[h][0],L=P[h][1],B=1/Math.sqrt((o-T)*(o-T)+(s-N)*(s-N)),x=u[h]*(o-T-l[h]*(o-T)*B),A=u[h]*(s-N-l[h]*(s-N)*B),P[h]=[x,A],t+=x,r+=A,C[h]+=x-I,R[h]+=A-L);C[e]=t,R[e]=r}(V,F,z);var U=M(V),G=a(U,3);_=G[0],F=G[1],z=G[2]}}for(h=f;h--;){var X=e[h],Y=this.vertices[X];Y.position.x=m[h],Y.position.y=b[h],Y.positioned=!0,Y.forcePositioned=!0}}},{key:"_bridgeDfs",value:function(e,t,r,i,n,a,o){t[e]=!0,r[e]=i[e]=++this._time;for(var s=0;s<a[e].length;s++){var l=a[e][s];t[l]?l!==n[e]&&(i[e]=Math.min(i[e],r[l])):(n[l]=e,this._bridgeDfs(l,t,r,i,n,a,o),i[e]=Math.min(i[e],i[l]),i[l]>r[e]&&o.push([e,l]))}}}],[{key:"getConnectedComponents",value:function(t){var r=t.length,i=new Array(r),n=new Array,a=0;i.fill(!1);for(var o=0;o<r;o++)if(!i[o]){var s=Array();i[o]=!0,s.push(o),a++,e._ccGetDfs(o,i,t,s),s.length>1&&n.push(s)}return n}},{key:"getConnectedComponentCount",value:function(t){var r=t.length,i=new Array(r),n=0;i.fill(!1);for(var a=0;a<r;a++)i[a]||(i[a]=!0,n++,e._ccCountDfs(a,i,t));return n}},{key:"_ccCountDfs",value:function(t,r,i){for(var n=0;n<i[t].length;n++){i[t][n]&&!r[n]&&t!==n&&(r[n]=!0,e._ccCountDfs(n,r,i))}}},{key:"_ccGetDfs",value:function(t,r,i,n){for(var a=0;a<i[t].length;a++){i[t][a]&&!r[a]&&t!==a&&(r[a]=!0,n.push(a),e._ccGetDfs(a,r,i,n))}}}]),e}();r.default=y},{"./Atom":3,"./Edge":6,"./MathHelper":9,"./Ring":11,"./Vector2":14,"./Vertex":15}],8:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=e("./Vector2"),o=function(e){return e&&e.__esModule?e:{default:e}}(a),s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o.default(0,0),r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o.default(0,0),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],l=arguments.length>5&&void 0!==arguments[5]&&arguments[5];i(this,e),this.from=t,this.to=r,this.elementFrom=n,this.elementTo=a,this.chiralFrom=s,this.chiralTo=l}return n(e,[{key:"clone",value:function(){return new e(this.from.clone(),this.to.clone(),this.elementFrom,this.elementTo)}},{key:"getLength",value:function(){return Math.sqrt(Math.pow(this.to.x-this.from.x,2)+Math.pow(this.to.y-this.from.y,2))}},{key:"getAngle",value:function(){return o.default.subtract(this.getRightVector(),this.getLeftVector()).angle()}},{key:"getRightVector",value:function(){return this.from.x<this.to.x?this.to:this.from}},{key:"getLeftVector",value:function(){return this.from.x<this.to.x?this.from:this.to}},{key:"getRightElement",value:function(){return this.from.x<this.to.x?this.elementTo:this.elementFrom}},{key:"getLeftElement",value:function(){return this.from.x<this.to.x?this.elementFrom:this.elementTo}},{key:"getRightChiral",value:function(){return this.from.x<this.to.x?this.chiralTo:this.chiralFrom}},{key:"getLeftChiral",value:function(){return this.from.x<this.to.x?this.chiralFrom:this.chiralTo}},{key:"setRightVector",value:function(e,t){return this.from.x<this.to.x?(this.to.x=e,this.to.y=t):(this.from.x=e,this.from.y=t),this}},{key:"setLeftVector",value:function(e,t){return this.from.x<this.to.x?(this.from.x=e,this.from.y=t):(this.to.x=e,this.to.y=t),this}},{key:"rotateToXAxis",value:function(){var e=this.getLeftVector();return this.setRightVector(e.x+this.getLength(),e.y),this}},{key:"rotate",value:function(e){var t=this.getLeftVector(),r=this.getRightVector(),i=Math.sin(e),n=Math.cos(e),a=n*(r.x-t.x)-i*(r.y-t.y)+t.x,o=i*(r.x-t.x)-n*(r.y-t.y)+t.y;return this.setRightVector(a,o),this}},{key:"shortenFrom",value:function(e){var t=o.default.subtract(this.to,this.from);return t.normalize(),t.multiplyScalar(e),this.from.add(t),this}},{key:"shortenTo",value:function(e){var t=o.default.subtract(this.from,this.to);return t.normalize(),t.multiplyScalar(e),this.to.add(t),this}},{key:"shortenRight",value:function(e){return this.from.x<this.to.x?this.shortenTo(e):this.shortenFrom(e),this}},{key:"shortenLeft",value:function(e){return this.from.x<this.to.x?this.shortenFrom(e):this.shortenTo(e),this}},{key:"shorten",value:function(e){var t=o.default.subtract(this.from,this.to);return t.normalize(),t.multiplyScalar(e/2),this.to.add(t),this.from.subtract(t),this}}]),e}();r.default=s},{"./Vector2":14}],9:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=function(){function e(){i(this,e)}return n(e,null,[{key:"round",value:function(e,t){return t=t||1,Number(Math.round(e+"e"+t)+"e-"+t)}},{key:"meanAngle",value:function(e){for(var t=0,r=0,i=0;i<e.length;i++)t+=Math.sin(e[i]),r+=Math.cos(e[i]);return Math.atan2(t/e.length,r/e.length)}},{key:"innerAngle",value:function(t){return e.toRad(180*(t-2)/t)}},{key:"polyCircumradius",value:function(e,t){return e/(2*Math.sin(Math.PI/t))}},{key:"apothem",value:function(e,t){return e*Math.cos(Math.PI/t)}},{key:"apothemFromSideLength",value:function(t,r){var i=e.polyCircumradius(t,r);return e.apothem(i,r)}},{key:"centralAngle",value:function(t){return e.toRad(360/t)}},{key:"toDeg",value:function(t){return t*e.degFactor}},{key:"toRad",value:function(t){return t*e.radFactor}},{key:"parityOfPermutation",value:function(e){for(var t=new Uint8Array(e.length),r=0,i=0;i<e.length;i++)if(1!==t[i]){var n=function r(i){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return 1===t[i]?n:(n++,t[i]=1,r(e[i],n))}(i);r+=1-n%2}return r%2?-1:1}},{key:"radFactor",get:function(){return Math.PI/180}},{key:"degFactor",get:function(){return 180/Math.PI}},{key:"twoPI",get:function(){return 2*Math.PI}}]),e}();r.default=a},{}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(){function e(t,r,i,n){this.message=t,this.expected=r,this.found=i,this.location=n,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}function t(t){function r(e){var r,i,n=rt[e];if(n)return n;for(r=e-1;!rt[r];)r--;for(n=rt[r],n={line:n.line,column:n.column,seenCR:n.seenCR};r<e;)i=t.charAt(r),"\n"===i?(n.seenCR||n.line++,n.column=1,n.seenCR=!1):"\r"===i||"\u2028"===i||"\u2029"===i?(n.line++,n.column=1,n.seenCR=!0):(n.column++,n.seenCR=!1),r++;return rt[e]=n,n}function i(e,t){var i=r(e),n=r(t);return{start:{offset:e,line:i.line,column:i.column},end:{offset:t,line:n.line,column:n.column}}}function n(e){et<it||(et>it&&(it=et,nt=[]),nt.push(e))}function a(t,r,i,n){return null!==r&&function(e){var t=1;for(e.sort(function(e,t){return e.description<t.description?-1:e.description>t.description?1:0});t<e.length;)e[t-1]===e[t]?e.splice(t,1):t++}(r),new e(null!==t?t:function(e,t){var r,i,n,a=new Array(e.length);for(n=0;n<e.length;n++)a[n]=e[n].description;return r=e.length>1?a.slice(0,-1).join(", ")+" or "+a[e.length-1]:a[0],i=t?'"'+function(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+t(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+t(e)}).replace(/[\u0100-\u0FFF]/g,function(e){return"\\u0"+t(e)}).replace(/[\u1000-\uFFFF]/g,function(e){return"\\u"+t(e)})}(t)+'"':"end of input","Expected "+r+" but "+i+" found."}(r,i),r,i,n)}function o(){var e,t,r,i,n,a,u,g,c,d;if(e=et,t=et,(r=l())!==C){for(i=[],n=s();n!==C;)i.push(n),n=s();if(i!==C){for(n=[],a=et,u=h(),u===C&&(u=null),u!==C?(g=v(),g!==C?(u=[u,g],a=u):(et=a,a=C)):(et=a,a=C);a!==C;)n.push(a),a=et,u=h(),u===C&&(u=null),u!==C?(g=v(),g!==C?(u=[u,g],a=u):(et=a,a=C)):(et=a,a=C);if(n!==C){for(a=[],u=s();u!==C;)a.push(u),u=s();if(a!==C)if(u=h(),u===C&&(u=null),u!==C)if(g=o(),g===C&&(g=null),g!==C){for(c=[],d=s();d!==C;)c.push(d),d=s();c!==C?(r=[r,i,n,a,u,g,c],t=r):(et=t,t=C)}else et=t,t=C;else et=t,t=C;else et=t,t=C}else et=t,t=C}else et=t,t=C}else et=t,t=C;return t!==C&&(tt=e,t=T(t)),e=t}function s(){var e,r,i,a,s,l;return e=et,r=et,40===t.charCodeAt(et)?(i=N,et++):(i=C,0===at&&n(I)),i!==C?(a=h(),a===C&&(a=null),a!==C?(s=o(),s!==C?(41===t.charCodeAt(et)?(l=L,et++):(l=C,0===at&&n(B)),l!==C?(i=[i,a,s,l],r=i):(et=r,r=C)):(et=r,r=C)):(et=r,r=C)):(et=r,r=C),r!==C&&(tt=e,r=O(r)),e=r}function l(){var e,t;return e=et,t=g(),t===C&&(t=c())===C&&(t=u())===C&&(t=d()),t!==C&&(tt=e,t=E(t)),e=t}function h(){var e,r;return e=et,M.test(t.charAt(et))?(r=t.charAt(et),et++):(r=C,0===at&&n(D)),r!==C&&(tt=e,r=V(r)),e=r}function u(){var e,r,i,a,o,s,l,h,u,g;return e=et,r=et,91===t.charCodeAt(et)?(i=F,et++):(i=C,0===at&&n(z)),i!==C?(a=S(),a===C&&(a=null),a!==C?(t.substr(et,2)===_?(o=_,et+=2):(o=C,0===at&&n(H)),o===C&&(t.substr(et,2)===W?(o=W,et+=2):(o=C,0===at&&n(j)),o===C&&(o=c())===C&&(o=f())===C&&(o=d())),o!==C?(s=p(),s===C&&(s=null),s!==C?(l=A(),l===C&&(l=null),l!==C?(h=y(),h===C&&(h=null),h!==C?(u=x(),u===C&&(u=null),u!==C?(93===t.charCodeAt(et)?(g=q,et++):(g=C,0===at&&n(U)),g!==C?(i=[i,a,o,s,l,h,u,g],r=i):(et=r,r=C)):(et=r,r=C)):(et=r,r=C)):(et=r,r=C)):(et=r,r=C)):(et=r,r=C)):(et=r,r=C)):(et=r,r=C),r!==C&&(tt=e,r=G(r)),e=r}function g(){var e,r,i,a;return e=et,r=et,66===t.charCodeAt(et)?(i=X,et++):(i=C,0===at&&n(Y)),i!==C?(114===t.charCodeAt(et)?(a=K,et++):(a=C,0===at&&n(Z)),a===C&&(a=null),a!==C?(i=[i,a],r=i):(et=r,r=C)):(et=r,r=C),r===C&&(r=et,67===t.charCodeAt(et)?(i=$,et++):(i=C,0===at&&n(J)),i!==C?(108===t.charCodeAt(et)?(a=Q,et++):(a=C,0===at&&n(ee)),a===C&&(a=null),a!==C?(i=[i,a],r=i):(et=r,r=C)):(et=r,r=C),r===C&&(te.test(t.charAt(et))?(r=t.charAt(et),et++):(r=C,0===at&&n(re)))),r!==C&&(tt=e,r=ie(r)),e=r}function c(){var e,r;return e=et,ne.test(t.charAt(et))?(r=t.charAt(et),et++):(r=C,0===at&&n(ae)),r!==C&&(tt=e,r=E(r)),e=r}function d(){var e,r;return e=et,42===t.charCodeAt(et)?(r=oe,et++):(r=C,0===at&&n(se)),r!==C&&(tt=e,r=le(r)),e=r}function f(){var e,r,i,a;return e=et,r=et,he.test(t.charAt(et))?(i=t.charAt(et),et++):(i=C,0===at&&n(ue)),i!==C?(ge.test(t.charAt(et))?(a=t.charAt(et),et++):(a=C,0===at&&n(ce)),a===C&&(a=null),a!==C?(i=[i,a],r=i):(et=r,r=C)):(et=r,r=C),r!==C&&(tt=e,r=de(r)),e=r}function v(){var e,r,i,a,o;return e=et,r=et,37===t.charCodeAt(et)?(i=fe,et++):(i=C,0===at&&n(ve)),i!==C?(pe.test(t.charAt(et))?(a=t.charAt(et),et++):(a=C,0===at&&n(ye)),a!==C?(me.test(t.charAt(et))?(o=t.charAt(et),et++):(o=C,0===at&&n(be)),o!==C?(i=[i,a,o],r=i):(et=r,r=C)):(et=r,r=C)):(et=r,r=C),r===C&&(me.test(t.charAt(et))?(r=t.charAt(et),et++):(r=C,0===at&&n(be))),r!==C&&(tt=e,r=Ae(r)),e=r}function p(){var e,r,i,a,o,s,l;return e=et,r=et,64===t.charCodeAt(et)?(i=xe,et++):(i=C,0===at&&n(Se)),i!==C?(64===t.charCodeAt(et)?(a=xe,et++):(a=C,0===at&&n(Se)),a===C&&(a=et,t.substr(et,2)===ke?(o=ke,et+=2):(o=C,0===at&&n(we)),o!==C?(Ce.test(t.charAt(et))?(s=t.charAt(et),et++):(s=C,0===at&&n(Re)),s!==C?(o=[o,s],a=o):(et=a,a=C)):(et=a,a=C),a===C&&(a=et,t.substr(et,2)===Pe?(o=Pe,et+=2):(o=C,0===at&&n(Te)),o!==C?(Ce.test(t.charAt(et))?(s=t.charAt(et),et++):(s=C,0===at&&n(Re)),s!==C?(o=[o,s],a=o):(et=a,a=C)):(et=a,a=C),a===C&&(a=et,t.substr(et,2)===Ne?(o=Ne,et+=2):(o=C,0===at&&n(Ie)),o!==C?(Le.test(t.charAt(et))?(s=t.charAt(et),et++):(s=C,0===at&&n(Be)),s!==C?(o=[o,s],a=o):(et=a,a=C)):(et=a,a=C),a===C&&(a=et,t.substr(et,2)===Oe?(o=Oe,et+=2):(o=C,0===at&&n(Ee)),o!==C?(pe.test(t.charAt(et))?(s=t.charAt(et),et++):(s=C,0===at&&n(ye)),s!==C?(me.test(t.charAt(et))?(l=t.charAt(et),et++):(l=C,0===at&&n(be)),l===C&&(l=null),l!==C?(o=[o,s,l],a=o):(et=a,a=C)):(et=a,a=C)):(et=a,a=C),a===C&&(a=et,t.substr(et,2)===Me?(o=Me,et+=2):(o=C,0===at&&n(De)),o!==C?(pe.test(t.charAt(et))?(s=t.charAt(et),et++):(s=C,0===at&&n(ye)),s!==C?(me.test(t.charAt(et))?(l=t.charAt(et),et++):(l=C,0===at&&n(be)),l===C&&(l=null),l!==C?(o=[o,s,l],a=o):(et=a,a=C)):(et=a,a=C)):(et=a,a=C)))))),a===C&&(a=null),a!==C?(i=[i,a],r=i):(et=r,r=C)):(et=r,r=C),r!==C&&(tt=e,r=Ve(r)),e=r}function y(){var e,t;return e=et,t=m(),t===C&&(t=b()),t!==C&&(tt=e,t=Fe(t)),e=t}function m(){var e,r,i,a,o,s;return e=et,r=et,43===t.charCodeAt(et)?(i=ze,et++):(i=C,0===at&&n(_e)),i!==C?(43===t.charCodeAt(et)?(a=ze,et++):(a=C,0===at&&n(_e)),a===C&&(a=et,pe.test(t.charAt(et))?(o=t.charAt(et),et++):(o=C,0===at&&n(ye)),o!==C?(me.test(t.charAt(et))?(s=t.charAt(et),et++):(s=C,0===at&&n(be)),s===C&&(s=null),s!==C?(o=[o,s],a=o):(et=a,a=C)):(et=a,a=C)),a===C&&(a=null),a!==C?(i=[i,a],r=i):(et=r,r=C)):(et=r,r=C),r!==C&&(tt=e,r=He(r)),e=r}function b(){var e,r,i,a,o,s;return e=et,r=et,45===t.charCodeAt(et)?(i=We,et++):(i=C,0===at&&n(je)),i!==C?(45===t.charCodeAt(et)?(a=We,et++):(a=C,0===at&&n(je)),a===C&&(a=et,pe.test(t.charAt(et))?(o=t.charAt(et),et++):(o=C,0===at&&n(ye)),o!==C?(me.test(t.charAt(et))?(s=t.charAt(et),et++):(s=C,0===at&&n(be)),s===C&&(s=null),s!==C?(o=[o,s],a=o):(et=a,a=C)):(et=a,a=C)),a===C&&(a=null),a!==C?(i=[i,a],r=i):(et=r,r=C)):(et=r,r=C),r!==C&&(tt=e,r=qe(r)),e=r}function A(){var e,r,i,a;return e=et,r=et,72===t.charCodeAt(et)?(i=Ue,et++):(i=C,0===at&&n(Ge)),i!==C?(me.test(t.charAt(et))?(a=t.charAt(et),et++):(a=C,0===at&&n(be)),a===C&&(a=null),a!==C?(i=[i,a],r=i):(et=r,r=C)):(et=r,r=C),r!==C&&(tt=e,r=Xe(r)),e=r}function x(){var e,r,i,a,o,s,l;if(e=et,r=et,58===t.charCodeAt(et)?(i=Ye,et++):(i=C,0===at&&n(Ke)),i!==C){if(a=et,pe.test(t.charAt(et))?(o=t.charAt(et),et++):(o=C,0===at&&n(ye)),o!==C){for(s=[],me.test(t.charAt(et))?(l=t.charAt(et),et++):(l=C,0===at&&n(be));l!==C;)s.push(l),me.test(t.charAt(et))?(l=t.charAt(et),et++):(l=C,0===at&&n(be));s!==C?(o=[o,s],a=o):(et=a,a=C)}else et=a,a=C;a===C&&(Ze.test(t.charAt(et))?(a=t.charAt(et),et++):(a=C,0===at&&n($e))),a!==C?(i=[i,a],r=i):(et=r,r=C)}else et=r,r=C;return r!==C&&(tt=e,r=Je(r)),e=r}function S(){var e,r,i,a,o;return e=et,r=et,pe.test(t.charAt(et))?(i=t.charAt(et),et++):(i=C,0===at&&n(ye)),i!==C?(me.test(t.charAt(et))?(a=t.charAt(et),et++):(a=C,0===at&&n(be)),a===C&&(a=null),a!==C?(me.test(t.charAt(et))?(o=t.charAt(et),et++):(o=C,0===at&&n(be)),o===C&&(o=null),o!==C?(i=[i,a,o],r=i):(et=r,r=C)):(et=r,r=C)):(et=r,r=C),r!==C&&(tt=e,r=Qe(r)),e=r}var k,w=arguments.length>1?arguments[1]:{},C={},R={chain:o},P=o,T=function(e){for(var t=[],r=[],i=0;i<e[1].length;i++)t.push(e[1][i]);for(var i=0;i<e[2].length;i++){var n=e[2][i][0]?e[2][i][0]:"-";r.push({bond:n,id:e[2][i][1]})}for(var i=0;i<e[3].length;i++)t.push(e[3][i]);for(var i=0;i<e[6].length;i++)t.push(e[6][i]);return{atom:e[0],isBracket:!!e[0].element,branches:t,branchCount:t.length,ringbonds:r,ringbondCount:r.length,bond:e[4]?e[4]:"-",next:e[5],hasNext:!!e[5]}},N="(",I={type:"literal",value:"(",description:'"("'},L=")",B={type:"literal",value:")",description:'")"'},O=function(e){var t=e[1]?e[1]:"-";return e[2].branchBond=t,e[2]},E=function(e){return e},M=/^[\-=#$:\/\\.]/,D={type:"class",value:"[-=#$:/\\\\.]",description:"[-=#$:/\\\\.]"},V=function(e){return e},F="[",z={type:"literal",value:"[",description:'"["'},_="se",H={type:"literal",value:"se",description:'"se"'},W="as",j={type:"literal",value:"as",description:'"as"'},q="]",U={type:"literal",value:"]",description:'"]"'},G=function(e){return{isotope:e[1],element:e[2],chirality:e[3],hcount:e[4],charge:e[5],class:e[6]}},X="B",Y={type:"literal",value:"B",description:'"B"'},K="r",Z={type:"literal",value:"r",description:'"r"'},$="C",J={type:"literal",value:"C",description:'"C"'},Q="l",ee={type:"literal",value:"l",description:'"l"'},te=/^[NOPSFI]/,re={type:"class",value:"[NOPSFI]",description:"[NOPSFI]"},ie=function(e){return e.length>1?e.join(""):e},ne=/^[bcnops]/,ae={type:"class",value:"[bcnops]",description:"[bcnops]"},oe="*",se={type:"literal",value:"*",description:'"*"'},le=function(e){return e},he=/^[A-Z]/,ue={type:"class",value:"[A-Z]",description:"[A-Z]"},ge=/^[a-z]/,ce={type:"class",value:"[a-z]",description:"[a-z]"},de=function(e){return e.join("")},fe="%",ve={type:"literal",value:"%",description:'"%"'},pe=/^[1-9]/,ye={type:"class",value:"[1-9]",description:"[1-9]"},me=/^[0-9]/,be={type:"class",value:"[0-9]",description:"[0-9]"},Ae=function(e){return 1==e.length?Number(e):Number(e.join("").replace("%",""))},xe="@",Se={type:"literal",value:"@",description:'"@"'},ke="TH",we={type:"literal",value:"TH",description:'"TH"'},Ce=/^[12]/,Re={type:"class",value:"[12]",description:"[12]"},Pe="AL",Te={type:"literal",value:"AL",description:'"AL"'},Ne="SP",Ie={type:"literal",value:"SP",description:'"SP"'},Le=/^[1-3]/,Be={type:"class",value:"[1-3]",description:"[1-3]"},Oe="TB",Ee={type:"literal",value:"TB",description:'"TB"'},Me="OH",De={type:"literal",value:"OH",description:'"OH"'},Ve=function(e){return e[1]?"@"==e[1]?"@@":e[1].join("").replace(",",""):"@"},Fe=function(e){return e},ze="+",_e={type:"literal",value:"+",description:'"+"'},He=function(e){return e[1]?"+"!=e[1]?Number(e[1].join("")):2:1},We="-",je={type:"literal",value:"-",description:'"-"'},qe=function(e){return e[1]?"-"!=e[1]?-Number(e[1].join("")):-2:-1},Ue="H",Ge={type:"literal",value:"H",description:'"H"'},Xe=function(e){return e[1]?Number(e[1]):1},Ye=":",Ke={type:"literal",value:":",description:'":"'},Ze=/^[0]/,$e={type:"class",value:"[0]",description:"[0]"},Je=function(e){return Number(e[1][0]+e[1][1].join(""))},Qe=function(e){return Number(e.join(""))},et=0,tt=0,rt=[{line:1,column:1,seenCR:!1}],it=0,nt=[],at=0;if("startRule"in w){if(!(w.startRule in R))throw new Error("Can't start parsing from rule \""+w.startRule+'".');P=R[w.startRule]}if((k=P())!==C&&et===t.length)return k;throw k!==C&&et<t.length&&n({type:"end",description:"end of input"}),a(null,nt,it<t.length?t.charAt(it):null,it<t.length?i(it,it+1):i(it,it))}return function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}(e,Error),{SyntaxError:e,parse:t}}()},{}],11:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),o=e("./ArrayHelper"),s=i(o),l=e("./Vector2"),h=i(l),u=e("./Vertex"),g=(i(u),e("./RingConnection")),c=i(g),d=function(){function e(t){n(this,e),this.id=null,this.members=t,this.edges=[],this.insiders=[],this.neighbours=[],this.positioned=!1,this.center=new h.default(0,0),this.rings=[],this.isBridged=!1,this.isPartOfBridged=!1,this.isSpiro=!1,this.isFused=!1,this.centralAngle=0,this.canFlip=!0}return a(e,[{key:"clone",value:function(){var t=new e(this.members);return t.id=this.id,t.insiders=s.default.clone(this.insiders),t.neighbours=s.default.clone(this.neighbours),t.positioned=this.positioned,t.center=this.center.clone(),t.rings=s.default.clone(this.rings),t.isBridged=this.isBridged,t.isPartOfBridged=this.isPartOfBridged,t.isSpiro=this.isSpiro,t.isFused=this.isFused,t.centralAngle=this.centralAngle,t.canFlip=this.canFlip,t}},{key:"getSize",value:function(){return this.members.length}},{key:"getPolygon",value:function(e){for(var t=[],r=0;r<this.members.length;r++)t.push(e[this.members[r]].position);return t}},{key:"getAngle",value:function(){return Math.PI-this.centralAngle}},{key:"eachMember",value:function(e,t,r,i){r=r||0===r?r:this.members[0];for(var n=r,a=0;null!=n&&a<100;){var o=n;t(o),n=e[n].getNextInRing(e,this.id,i),i=o,n==r&&(n=null),a++}}},{key:"getOrderedNeighbours",value:function(e){for(var t=Array(this.neighbours.length),r=0;r<this.neighbours.length;r++){var i=c.default.getVertices(e,this.id,this.neighbours[r]);t[r]={n:i.length,neighbour:this.neighbours[r]}}return t.sort(function(e,t){return t.n-e.n}),t}},{key:"isBenzeneLike",value:function(e){var t=this.getDoubleBondCount(e),r=this.members.length;return 3===t&&6===r||2===t&&5===r}},{key:"getDoubleBondCount",value:function(e){for(var t=0,r=0;r<this.members.length;r++){var i=e[this.members[r]].value;"="!==i.bondType&&"="!==i.branchBond||t++}return t}},{key:"contains",value:function(e){for(var t=0;t<this.members.length;t++)if(this.members[t]==e)return!0;return!1}}]),e}();r.default=d},{"./ArrayHelper":2,"./RingConnection":12,"./Vector2":14,"./Vertex":15}],12:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=e("./Vertex"),l=(i(s),e("./Ring")),h=(i(l),function(){function e(t,r){a(this,e),this.id=null,this.firstRingId=t.id,this.secondRingId=r.id,this.vertices=new Set;for(var i=0;i<t.members.length;i++)for(var n=t.members[i],o=0;o<r.members.length;o++){var s=r.members[o];n===s&&this.addVertex(n)}}return o(e,[{key:"addVertex",value:function(e){this.vertices.add(e)}},{key:"updateOther",value:function(e,t){this.firstRingId===t?this.secondRingId=e:this.firstRingId=e}},{key:"containsRing",value:function(e){return this.firstRingId===e||this.secondRingId===e}},{key:"isBridge",value:function(e){if(this.vertices.size>2)return!0;var t=!0,r=!1,i=void 0;try{for(var n,a=this.vertices[Symbol.iterator]();!(t=(n=a.next()).done);t=!0){if(e[n.value].value.rings.length>2)return!0}}catch(e){r=!0,i=e}finally{try{!t&&a.return&&a.return()}finally{if(r)throw i}}return!1}}],[{key:"isBridge",value:function(e,t,r,i){for(var n=null,a=0;a<e.length;a++)if(n=e[a],n.firstRingId===r&&n.secondRingId===i||n.firstRingId===i&&n.secondRingId===r)return n.isBridge(t);return!1}},{key:"getNeighbours",value:function(e,t){for(var r=[],i=0;i<e.length;i++){var n=e[i];n.firstRingId===t?r.push(n.secondRingId):n.secondRingId===t&&r.push(n.firstRingId)}return r}},{key:"getVertices",value:function(e,t,r){for(var i=0;i<e.length;i++){var a=e[i];if(a.firstRingId===t&&a.secondRingId===r||a.firstRingId===r&&a.secondRingId===t)return[].concat(n(a.vertices))}}}]),e}());r.default=h},{"./Ring":11,"./Vertex":15}],13:[function(e,t,r){"use strict";function i(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),o=e("./Graph"),s=function(e){return e&&e.__esModule?e:{default:e}}(o),l=function(){function e(){n(this,e)}return a(e,null,[{key:"getRings",value:function(t){var r=t.getComponentsAdjacencyMatrix();if(0===r.length)return null;for(var n=s.default.getConnectedComponents(r),a=new Array,o=0;o<n.length;o++){for(var l=n[o],h=t.getSubgraphAdjacencyMatrix([].concat(i(l))),u=Array(h.length),g=Array(h.length),c=0;c<h.length;c++){g[c]=0,u[c]=0;for(var d=0;d<h[c].length;d++)u[c]+=h[c][d]}for(var f=e.getEdgeList(h).length,v=f-h.length+1,p=!0,c=0;c<u.length;c++)3!==u[c]&&(p=!1);p&&(v=2+f-h.length);for(var y=e.getPathIncludedDistanceMatrices(h),m=y.d,b=y.pe,A=y.pe_prime,x=e.getRingCandidates(m,b,A),S=e.getSSSR(x,m,h,b,A,u,g,v),k=0;k<S.length;k++){var w=new Array(S[k].size),C=0,R=!0,P=!1,T=void 0;try{for(var N,I=S[k][Symbol.iterator]();!(R=(N=I.next()).done);R=!0){var L=N.value;w[C++]=l[L]}}catch(e){P=!0,T=e}finally{try{!R&&I.return&&I.return()}finally{if(P)throw T}}a.push(w)}}return a}},{key:"matrixToString",value:function(e){for(var t="",r=0;r<e.length;r++){for(var i=0;i<e[r].length;i++)t+=e[r][i]+" ";t+="\n"}return t}},{key:"getPathIncludedDistanceMatrices",value:function(e){for(var t=e.length,r=Array(t),i=Array(t),n=Array(t),a=0,o=0,s=0,l=t;l--;){r[l]=Array(t),i[l]=Array(t),n[l]=Array(t);for(var h=t;h--;)r[l][h]=l===h||1===e[l][h]?e[l][h]:Number.POSITIVE_INFINITY,1===r[l][h]?i[l][h]=[[[l,h]]]:i[l][h]=Array(),n[l][h]=Array()}for(var h,u=t;u--;)for(l=t;l--;)for(h=t;h--;){var g=r[l][h],c=r[l][u]+r[u][h];if(g>c){var a,o,s;if(g===c+1)for(n[l][h]=[i[l][h].length],a=i[l][h].length;a--;)for(n[l][h][a]=[i[l][h][a].length],o=i[l][h][a].length;o--;)for(n[l][h][a][o]=[i[l][h][a][o].length],s=i[l][h][a][o].length;s--;)n[l][h][a][o][s]=[i[l][h][a][o][0],i[l][h][a][o][1]];else n[l][h]=Array();for(r[l][h]=c,i[l][h]=[[]],a=i[l][u][0].length;a--;)i[l][h][0].push(i[l][u][0][a]);for(a=i[u][h][0].length;a--;)i[l][h][0].push(i[u][h][0][a])}else if(g===c){if(i[l][u].length&&i[u][h].length){var a;if(i[l][h].length){var d=Array();for(a=i[l][u][0].length;a--;)d.push(i[l][u][0][a]);for(a=i[u][h][0].length;a--;)d.push(i[u][h][0][a]);i[l][h].push(d)}else{var f=Array();for(a=i[l][u][0].length;a--;)f.push(i[l][u][0][a]);for(a=i[u][h][0].length;a--;)f.push(i[u][h][0][a]);i[l][h][0]=f}}}else if(g===c-1){var a;if(n[l][h].length){var v=Array();for(a=i[l][u][0].length;a--;)v.push(i[l][u][0][a]);for(a=i[u][h][0].length;a--;)v.push(i[u][h][0][a]);n[l][h].push(v)}else{var p=Array();for(a=i[l][u][0].length;a--;)p.push(i[l][u][0][a]);for(a=i[u][h][0].length;a--;)p.push(i[u][h][0][a]);n[l][h][0]=p}}}return{d:r,pe:i,pe_prime:n}}},{key:"getRingCandidates",value:function(e,t,r){
for(var i=e.length,n=Array(),a=0,o=0;o<i;o++)for(var s=0;s<i;s++)0===e[o][s]||1===t[o][s].length&&0===r[o][s]||(a=0!==r[o][s].length?2*(e[o][s]+.5):2*e[o][s])!==1/0&&n.push([a,t[o][s],r[o][s]]);return n.sort(function(e,t){return e[0]-t[0]}),n}},{key:"getSSSR",value:function(t,r,i,n,a,o,s,l){for(var h=Array(),u=Array(),g=0;g<t.length;g++)if(t[g][0]%2!=0)for(var c=0;c<t[g][2].length;c++){for(var d=t[g][1][0].concat(t[g][2][c]),f=0;f<d.length;f++)d[f][0].constructor===Array&&(d[f]=d[f][0]);var v=e.bondsToAtoms(d);if(e.getBondCount(v,i)!==v.size||e.pathSetsContain(h,v,d,u,o,s)||(h.push(v),u=u.concat(d)),h.length>l)return h}else for(var p=0;p<t[g][1].length-1;p++){for(var y=t[g][1][p].concat(t[g][1][p+1]),f=0;f<y.length;f++)y[f][0].constructor===Array&&(y[f]=y[f][0]);var m=e.bondsToAtoms(y);if(e.getBondCount(m,i)!==m.size||e.pathSetsContain(h,m,y,u,o,s)||(h.push(m),u=u.concat(y)),h.length>l)return h}return h}},{key:"getEdgeCount",value:function(e){for(var t=0,r=e.length,i=r-1;i--;)for(var n=r;n--;)1===e[i][n]&&t++;return t}},{key:"getEdgeList",value:function(e){for(var t=e.length,r=Array(),i=t-1;i--;)for(var n=t;n--;)1===e[i][n]&&r.push([i,n]);return r}},{key:"bondsToAtoms",value:function(e){for(var t=new Set,r=e.length;r--;)t.add(e[r][0]),t.add(e[r][1]);return t}},{key:"getBondCount",value:function(e,t){var r=0,i=!0,n=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var l=o.value,h=!0,u=!1,g=void 0;try{for(var c,d=e[Symbol.iterator]();!(h=(c=d.next()).done);h=!0){var f=c.value;l!==f&&(r+=t[l][f])}}catch(e){u=!0,g=e}finally{try{!h&&d.return&&d.return()}finally{if(u)throw g}}}}catch(e){n=!0,a=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw a}}return r/2}},{key:"pathSetsContain",value:function(t,r,i,n,a,o){for(var s=t.length;s--;){if(e.isSupersetOf(r,t[s]))return!0;if(t[s].size===r.size&&e.areSetsEqual(t[s],r))return!0}var l=0,h=!1;for(s=i.length;s--;)for(var u=n.length;u--;)(i[s][0]===n[u][0]&&i[s][1]===n[u][1]||i[s][1]===n[u][0]&&i[s][0]===n[u][1])&&l++,l===i.length&&(h=!0);var g=!1;if(h){var c=!0,d=!1,f=void 0;try{for(var v,p=r[Symbol.iterator]();!(c=(v=p.next()).done);c=!0){var y=v.value;if(o[y]<a[y]){g=!0;break}}}catch(e){d=!0,f=e}finally{try{!c&&p.return&&p.return()}finally{if(d)throw f}}}if(h&&!g)return!0;var m=!0,b=!1,A=void 0;try{for(var x,S=r[Symbol.iterator]();!(m=(x=S.next()).done);m=!0){o[x.value]++}}catch(e){b=!0,A=e}finally{try{!m&&S.return&&S.return()}finally{if(b)throw A}}return!1}},{key:"areSetsEqual",value:function(e,t){if(e.size!==t.size)return!1;var r=!0,i=!1,n=void 0;try{for(var a,o=e[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=a.value;if(!t.has(s))return!1}}catch(e){i=!0,n=e}finally{try{!r&&o.return&&o.return()}finally{if(i)throw n}}return!0}},{key:"isSupersetOf",value:function(e,t){var r=!0,i=!1,n=void 0;try{for(var a,o=t[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=a.value;if(!e.has(s))return!1}}catch(e){i=!0,n=e}finally{try{!r&&o.return&&o.return()}finally{if(i)throw n}}return!0}}]),e}();r.default=l},{"./Graph":7}],14:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=function(){function e(t,r){i(this,e),0==arguments.length?(this.x=0,this.y=0):1==arguments.length?(this.x=t.x,this.y=t.y):(this.x=t,this.y=r)}return n(e,[{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"toString",value:function(){return"("+this.x+","+this.y+")"}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:"subtract",value:function(e){return this.x-=e.x,this.y-=e.y,this}},{key:"divide",value:function(e){return this.x/=e,this.y/=e,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"invert",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"angle",value:function(){return Math.atan2(this.y,this.x)}},{key:"distance",value:function(e){return Math.sqrt((e.x-this.x)*(e.x-this.x)+(e.y-this.y)*(e.y-this.y))}},{key:"distanceSq",value:function(e){return(e.x-this.x)*(e.x-this.x)+(e.y-this.y)*(e.y-this.y)}},{key:"clockwise",value:function(e){var t=this.y*e.x,r=this.x*e.y;return t>r?-1:t===r?0:1}},{key:"rotate",value:function(t){var r=new e(0,0),i=Math.cos(t),n=Math.sin(t);return r.x=this.x*i-this.y*n,r.y=this.x*n+this.y*i,this.x=r.x,this.y=r.y,this}},{key:"rotateAround",value:function(e,t){var r=Math.sin(e),i=Math.cos(e);this.x-=t.x,this.y-=t.y;var n=this.x*i-this.y*r,a=this.x*r+this.y*i;return this.x=n+t.x,this.y=a+t.y,this}},{key:"rotateTo",value:function(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.x+=.001,this.y-=.001;var n=e.subtract(this,r),a=e.subtract(t,r),o=e.angle(a,n);return this.rotateAround(o+i,r),this}},{key:"rotateAwayFrom",value:function(e,t,r){this.rotateAround(r,t);var i=this.distanceSq(e);this.rotateAround(-2*r,t),this.distanceSq(e)<i&&this.rotateAround(2*r,t)}},{key:"getRotateAwayFromAngle",value:function(e,t,r){var i=this.clone();i.rotateAround(r,t);var n=i.distanceSq(e);return i.rotateAround(-2*r,t),i.distanceSq(e)<n?r:-r}},{key:"getRotateTowardsAngle",value:function(e,t,r){var i=this.clone();i.rotateAround(r,t);var n=i.distanceSq(e);return i.rotateAround(-2*r,t),i.distanceSq(e)>n?r:-r}},{key:"getRotateToAngle",value:function(t,r){var i=e.subtract(this,r),n=e.subtract(t,r),a=e.angle(n,i);return Number.isNaN(a)?0:a}},{key:"isInPolygon",value:function(e){for(var t=!1,r=0,i=e.length-1;r<e.length;i=r++)e[r].y>this.y!=e[i].y>this.y&&this.x<(e[i].x-e[r].x)*(this.y-e[r].y)/(e[i].y-e[r].y)+e[r].x&&(t=!t);return t}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"normalize",value:function(){return this.divide(this.length()),this}},{key:"normalized",value:function(){return e.divideScalar(this,this.length())}},{key:"whichSide",value:function(e,t){return(this.x-e.x)*(t.y-e.y)-(this.y-e.y)*(t.x-e.x)}},{key:"sameSideAs",value:function(e,t,r){var i=this.whichSide(e,t),n=r.whichSide(e,t);return i<0&&n<0||0==i&&0==n||i>0&&n>0}}],[{key:"add",value:function(t,r){return new e(t.x+r.x,t.y+r.y)}},{key:"subtract",value:function(t,r){return new e(t.x-r.x,t.y-r.y)}},{key:"multiply",value:function(t,r){return new e(t.x*r.x,t.y*r.y)}},{key:"multiplyScalar",value:function(t,r){return new e(t).multiply(r)}},{key:"midpoint",value:function(t,r){return new e((t.x+r.x)/2,(t.y+r.y)/2)}},{key:"normals",value:function(t,r){var i=e.subtract(r,t);return[new e(-i.y,i.x),new e(i.y,-i.x)]}},{key:"units",value:function(t,r){var i=e.subtract(r,t);return[new e(-i.y,i.x).normalize(),new e(i.y,-i.x).normalize()]}},{key:"divide",value:function(t,r){return new e(t.x/r.x,t.y/r.y)}},{key:"divideScalar",value:function(t,r){return new e(t.x/r,t.y/r)}},{key:"dot",value:function(e,t){return e.x*t.x+e.y*t.y}},{key:"angle",value:function(t,r){var i=e.dot(t,r);return Math.acos(i/(t.length()*r.length()))}},{key:"threePointangle",value:function(t,r,i){var n=e.subtract(r,t),a=e.subtract(i,r),o=t.distance(r),s=r.distance(i);return Math.acos(e.dot(n,a)/(o*s))}},{key:"scalarProjection",value:function(t,r){var i=r.normalized();return e.dot(t,i)}},{key:"averageDirection",value:function(t){for(var r=new e(0,0),i=0;i<t.length;i++){var n=t[i];r.add(n)}return r.normalize()}}]),e}();r.default=a},{}],15:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),o=e("./MathHelper"),s=i(o),l=e("./ArrayHelper"),h=i(l),u=e("./Vector2"),g=i(u),c=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;n(this,e),this.id=null,this.value=t,this.position=new g.default(r||0,i||0),this.previousPosition=new g.default(0,0),this.parentVertexId=null,this.children=Array(),this.spanningTreeChildren=Array(),this.edges=Array(),this.positioned=!1,this.angle=0,this.globalAngle=0,this.dir=1,this.neighbourCount=0,this.neighbours=Array(),this.neighbouringElements=Array(),this.forcePositioned=!1}return a(e,[{key:"setPosition",value:function(e,t){this.position.x=e,this.position.y=t}},{key:"setPositionFromVector",value:function(e){this.position.x=e.x,this.position.y=e.y}},{key:"addChild",value:function(e){this.neighbourCount++,this.children.push(e),this.neighbours.push(e),this.value.bondCount++}},{key:"setParentVertexId",value:function(e){this.neighbourCount++,this.parentVertexId=e,this.neighbours.push(e),this.value.bondCount++}},{key:"isTerminal",value:function(){return!!this.value.hasAttachedPseudoElements||(null===this.parentVertexId&&this.children.length<2||0===this.children.length)}},{key:"clone",value:function(){var t=new e(this.value,this.position.x,this.position.y);return t.id=this.id,t.previousPosition=new g.default(this.previousPosition.x,this.previousPosition.y),t.parentVertexId=this.parentVertexId,t.children=h.default.clone(this.children),t.spanningTreeChildren=h.default.clone(this.spanningTreeChildren),t.edges=h.default.clone(this.edges),t.positioned=this.positioned,t.angle=this.angle,t.forcePositioned=this.forcePositioned,t}},{key:"equals",value:function(e){return this.id===e.id}},{key:"getAngle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=null;return r=e?g.default.subtract(this.position,e):g.default.subtract(this.position,this.previousPosition),t?s.default.toDeg(r.angle()):r.angle()}},{key:"getTextDirection",value:function(e){for(var t=this.getDrawnNeighbours(e),r=Array(),i=0;i<t.length;i++)r.push(this.getAngle(e[t[i]].position));var n=s.default.meanAngle(r),a=Math.PI/2;return n=Math.round(Math.round(n/a)*a),2===n?"down":-2===n?"up":0===n||-0===n?"right":3===n||-3===n?"left":"down"}},{key:"getNeighbours",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null===e)return this.neighbours;for(var t=Array(),r=0;r<this.neighbours.length;r++)this.neighbours[r]!==e&&t.push(this.neighbours[r]);return t}},{key:"getDrawnNeighbours",value:function(e){for(var t=Array(),r=0;r<this.neighbours.length;r++)e[this.neighbours[r]].value.isDrawn&&t.push(this.neighbours[r]);return t}},{key:"getNeighbourCount",value:function(){return this.neighbourCount}},{key:"getSpanningTreeNeighbours",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=Array(),r=0;r<this.spanningTreeChildren.length;r++)void 0!==e&&e==this.spanningTreeChildren[r]||t.push(this.spanningTreeChildren[r]);return null!=this.parentVertexId&&(void 0!==e&&e==this.parentVertexId||t.push(this.parentVertexId)),t}},{key:"getNextInRing",value:function(e,t,r){for(var i=this.getNeighbours(),n=0;n<i.length;n++)if(h.default.contains(e[i[n]].value.rings,{value:t})&&i[n]!=r)return i[n];return null}}]),e}();r.default=c},{"./ArrayHelper":2,"./MathHelper":9,"./Vector2":14}]},{},[1]);
//# sourceMappingURL=smiles-drawer.min.js.map

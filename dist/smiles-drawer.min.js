(function(){function s(g,e,n){function t(o,i){if(!e[o]){if(!g[o]){var d="function"==typeof require&&require;if(!i&&d)return d(o,!0);if(r)return r(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var a=e[o]={exports:{}};g[o][0].call(a.exports,function(e){var i=g[o][1][e];return t(i||e)},a,a.exports,s,g,e,n)}return e[o].exports}for(var r="function"==typeof require&&require,o=0;o<n.length;o++)t(n[o]);return t}return s})()({1:[function(e,t){"use strict";var i=Math.min,n=Math.max;const r=e("./src/Drawer"),o=e("./src/Parser");var a=!!("undefined"!=typeof window&&window.document&&window.document.createElement),s={Version:"1.0.0"};s.Drawer=r,s.Parser=o,s.clean=function(e){return e.replace(/[^A-Za-z0-9@\.\+\-\?!\(\)\[\]\{\}/\\=#\$:\*]/g,"")},s.apply=function(e,t="canvas[data-smiles]",n="light",o=null){let a=new r(e),g=document.querySelectorAll(t);for(var d=0;d<g.length;d++){let e=g[d];s.parse(e.getAttribute("data-smiles"),function(t){a.draw(t,e,n,!1)},function(e){o&&o(e)})}},s.parse=function(e,t,i){try{t&&t(o.parse(e))}catch(e){i&&i(e)}},a&&(window.SmilesDrawer=s),Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{value:function(e){if(null==this)throw new TypeError("this is null or not defined");for(var t=Object(this),r=t.length>>>0,o=arguments[1],a=o>>0,s=0>a?n(r+a,0):i(a,r),g=arguments[2],d=void 0===g?r:g>>0,l=0>d?n(r+d,0):i(d,r);s<l;)t[s]=e,s++;return t}}),t.exports=s},{"./src/Drawer":5,"./src/Parser":10}],2:[function(e,t){"use strict";var n=Math.min;class r{static clone(e){let t=Array.isArray(e)?[]:{};for(let i in e){let n=e[i];t[i]="function"==typeof n.clone?n.clone():"object"==typeof n?r.clone(n):n}return t}static equals(e,t){if(e.length!==t.length)return!1;let n=e.slice().sort(),r=t.slice().sort();for(var o=0;o<n.length;o++)if(n[o]!==r[o])return!1;return!0}static print(e){if(0==e.length)return"";let t="(";for(let n=0;n<e.length;n++)t+=e[n].id?e[n].id+", ":e[n]+", ";return t=t.substring(0,t.length-2),t+")"}static each(e,t){for(let n=0;n<e.length;n++)t(e[n])}static get(e,t,n){for(let r=0;r<e.length;r++)if(e[r][t]==n)return e[r]}static contains(e,t){if(!t.property&&!t.func){for(let n=0;n<e.length;n++)if(e[n]==t.value)return!0;}else if(t.func){for(let n=0;n<e.length;n++)if(t.func(e[n]))return!0;}else for(let n=0;n<e.length;n++)if(e[n][t.property]==t.value)return!0;return!1}static intersection(e,t){let n=[];for(let r=0;r<e.length;r++)for(let i=0;i<t.length;i++)e[r]===t[i]&&n.push(e[r]);return n}static unique(e){let t={};return e.filter(function(e){return!(t[e]!==void 0)&&(t[e]=!0)})}static count(e,t){let n=0;for(let r=0;r<e.length;r++)e[r]===t&&n++;return n}static toggle(e,t){let n=[],r=!1;for(let o=0;o<e.length;o++)e[o]===t?r=!0:n.push(e[o]);return r||n.push(t),n}static remove(e,t){let n=[];for(let r=0;r<e.length;r++)e[r]!==t&&n.push(e[r]);return n}static removeUnique(e,t){let i=e.indexOf(t);return-1<i&&e.splice(i,1),e}static removeAll(e,t){return e.filter(function(e){return-1===t.indexOf(e)})}static merge(e,t){let n=Array(e.length+t.length);for(let r=0;r<e.length;r++)n[r]=e[r];for(let r=0;r<t.length;r++)n[e.length+r]=t[r];return n}static containsAll(e,t){let n=0;for(let r=0;r<e.length;r++)for(let i=0;i<t.length;i++)e[r]===t[i]&&n++;return n===t.length}static sortByAtomicNumberDesc(t){let i=t.map(function(t,e){return{index:e,value:t.atomicNumber.split(".").map(Number)}});return i.sort(function(e,t){let r=n(t.value.length,e.value.length),o=0;for(;o<r&&t.value[o]===e.value[o];)o++;return o===r?t.value.length-e.value.length:t.value[o]-e.value[o]}),i.map(function(i){return t[i.index]})}static deepCopy(e){let t=[];for(let n,o=0;o<e.length;o++)n=e[o],t[o]=n instanceof Array?r.deepCopy(n):n;return t}}t.exports=r},{}],3:[function(e,t){"use strict";const i=e("./ArrayHelper"),n=e("./Vertex"),r=e("./Ring");class o{constructor(e,t="-"){this.element=1===e.length?e.toUpperCase():e,this.drawExplicit=!1,this.ringbonds=[],this.rings=[],this.bondType=t,this.branchBond=null,this.isBridge=!1,this.isBridgeNode=!1,this.originalRings=[],this.bridgedRing=null,this.anchoredRings=[],this.bracket=null,this.plane=0,this.attachedPseudoElements={},this.hasAttachedPseudoElements=!1,this.isDrawn=!0,this.isConnectedToRing=!1,this.neighbouringElements=[],this.isPartOfAromaticRing=e!==this.element,this.bondCount=0,this.chirality="",this.isStereoCenter=!1,this.priority=0,this.mainChain=!1,this.hydrogenDirection="down",this.subtreeDepth=1,this.hasHydrogen=!1}addNeighbouringElement(e){this.neighbouringElements.push(e)}attachPseudoElement(e,t,i=0,n=0){null===i&&(i=0),null===n&&(n=0);let r=i+e+n;this.attachedPseudoElements[r]?this.attachedPseudoElements[r].count+=1:this.attachedPseudoElements[r]={element:e,count:1,hydrogenCount:i,previousElement:t,charge:n},this.hasAttachedPseudoElements=!0}getAttachedPseudoElements(){let e={},t=this;return Object.keys(this.attachedPseudoElements).sort().forEach(function(i){e[i]=t.attachedPseudoElements[i]}),e}getAttachedPseudoElementsCount(){return Object.keys(this.attachedPseudoElements).length}isHeteroAtom(){return"C"!==this.element&&"H"!==this.element}addAnchoredRing(e){i.contains(this.anchoredRings,{value:e})||this.anchoredRings.push(e)}getRingbondCount(){return this.ringbonds.length}backupRings(){this.originalRings=Array(this.rings.length);for(let e=0;e<this.rings.length;e++)this.originalRings[e]=this.rings[e]}restoreRings(){this.rings=Array(this.originalRings.length);for(let e=0;e<this.originalRings.length;e++)this.rings[e]=this.originalRings[e]}haveCommonRingbond(e,t){for(let n=0;n<e.ringbonds.length;n++)for(let i=0;i<t.ringbonds.length;i++)if(e.ringbonds[n].id==t.ringbonds[i].id)return!0;return!1}neighbouringElementsEqual(e){if(e.length!==this.neighbouringElements.length)return!1;e.sort(),this.neighbouringElements.sort();for(var t=0;t<this.neighbouringElements.length;t++)if(e[t]!==this.neighbouringElements[t])return!1;return!0}getAtomicNumber(){return o.atomicNumbers[this.element]}getMaxBonds(){return o.maxBonds[this.element]}static get maxBonds(){return{H:1,C:4,N:3,O:2,P:3,S:2,B:3,F:1,I:1,Cl:1,Br:1}}static get atomicNumbers(){return{H:1,He:2,Li:3,Be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,Ne:10,Na:11,Mg:12,Al:13,Si:14,P:15,p:15,S:16,s:16,Cl:17,Ar:18,K:19,Ca:20,Sc:21,Ti:22,V:23,Cr:24,Mn:25,Fe:26,Co:27,Ni:28,Cu:29,Zn:30,Ga:31,Ge:32,As:33,Se:34,Br:35,Kr:36,Rb:37,Sr:38,Y:39,Zr:40,Nb:41,Mo:42,Tc:43,Ru:44,Rh:45,Pd:46,Ag:47,Cd:48,In:49,Sn:50,Sb:51,Te:52,I:53,Xe:54,Cs:55,Ba:56,La:57,Ce:58,Pr:59,Nd:60,Pm:61,Sm:62,Eu:63,Gd:64,Tb:65,Dy:66,Ho:67,Er:68,Tm:69,Yb:70,Lu:71,Hf:72,Ta:73,W:74,Re:75,Os:76,Ir:77,Pt:78,Au:79,Hg:80,Tl:81,Pb:82,Bi:83,Po:84,At:85,Rn:86,Fr:87,Ra:88,Ac:89,Th:90,Pa:91,U:92,Np:93,Pu:94,Am:95,Cm:96,Bk:97,Cf:98,Es:99,Fm:100,Md:101,No:102,Lr:103,Rf:104,Db:105,Sg:106,Bh:107,Hs:108,Mt:109,Ds:110,Rg:111,Cn:112,Uut:113,Uuq:114,Uup:115,Uuh:116,Uus:117,Uuo:118}}static get mass(){return{H:1,He:2,Li:3,Be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,Ne:10,Na:11,Mg:12,Al:13,Si:14,P:15,p:15,S:16,s:16,Cl:17,Ar:18,K:19,Ca:20,Sc:21,Ti:22,V:23,Cr:24,Mn:25,Fe:26,Co:27,Ni:28,Cu:29,Zn:30,Ga:31,Ge:32,As:33,Se:34,Br:35,Kr:36,Rb:37,Sr:38,Y:39,Zr:40,Nb:41,Mo:42,Tc:43,Ru:44,Rh:45,Pd:46,Ag:47,Cd:48,In:49,Sn:50,Sb:51,Te:52,I:53,Xe:54,Cs:55,Ba:56,La:57,Ce:58,Pr:59,Nd:60,Pm:61,Sm:62,Eu:63,Gd:64,Tb:65,Dy:66,Ho:67,Er:68,Tm:69,Yb:70,Lu:71,Hf:72,Ta:73,W:74,Re:75,Os:76,Ir:77,Pt:78,Au:79,Hg:80,Tl:81,Pb:82,Bi:83,Po:84,At:85,Rn:86,Fr:87,Ra:88,Ac:89,Th:90,Pa:91,U:92,Np:93,Pu:94,Am:95,Cm:96,Bk:97,Cf:98,Es:99,Fm:100,Md:101,No:102,Lr:103,Rf:104,Db:105,Sg:106,Bh:107,Hs:108,Mt:109,Ds:110,Rg:111,Cn:112,Uut:113,Uuq:114,Uup:115,Uuh:116,Uus:117,Uuo:118}}}t.exports=o},{"./ArrayHelper":2,"./Ring":11,"./Vertex":15}],4:[function(e,t){"use strict";var n=Number.MAX_VALUE;const o=e("./MathHelper"),a=e("./Vector2"),s=e("./Line"),g=e("./Vertex"),d=e("./Ring");t.exports=class{constructor(e,t,i){this.canvas="string"==typeof e||e instanceof String?document.getElementById(e):e,this.ctx=this.canvas.getContext("2d"),this.colors=t,this.opts=i,this.drawingWidth=0,this.drawingHeight=0,this.offsetX=0,this.offsetY=0,this.fontLarge=this.opts.fontSizeLarge+"pt Helvetica, Arial, sans-serif",this.fontSmall=this.opts.fontSizeSmall+"pt Helvetica, Arial, sans-serif",this.updateSize(this.opts.width,this.opts.height),this.ctx.font=this.fontLarge,this.hydrogenWidth=this.ctx.measureText("H").width,this.halfHydrogenWidth=this.hydrogenWidth/2,this.halfBondThickness=this.opts.bondThickness/2}updateSize(e,t){this.devicePixelRatio=window.devicePixelRatio||1,this.backingStoreRatio=this.ctx.webkitBackingStorePixelRatio||this.ctx.mozBackingStorePixelRatio||this.ctx.msBackingStorePixelRatio||this.ctx.oBackingStorePixelRatio||this.ctx.backingStorePixelRatio||1,this.ratio=this.devicePixelRatio/this.backingStoreRatio,1===this.ratio?(this.canvas.width=e*this.ratio,this.canvas.height=t*this.ratio):(this.canvas.width=e*this.ratio,this.canvas.height=t*this.ratio,this.canvas.style.width=e+"px",this.canvas.style.height=t+"px",this.ctx.setTransform(this.ratio,0,0,this.ratio,0,0))}setTheme(e){this.colors=e}scale(e){let t=-n,r=-n,o=n,a=n;for(var s=0;s<e.length;s++){if(!e[s].value.isDrawn)continue;let i=e[s].position;t<i.x&&(t=i.x),r<i.y&&(r=i.y),o>i.x&&(o=i.x),a>i.y&&(a=i.y)}var g=this.opts.padding;t+=g,r+=g,o-=g,a-=g,this.drawingWidth=t-o,this.drawingHeight=r-a;var d=this.canvas.offsetWidth/this.drawingWidth,l=this.canvas.offsetHeight/this.drawingHeight,h=d<l?d:l;this.ctx.scale(h,h),this.offsetX=-o,this.offsetY=-a,d<l?this.offsetY+=this.canvas.offsetHeight/(2*h)-this.drawingHeight/2:this.offsetX+=this.canvas.offsetWidth/(2*h)-this.drawingWidth/2}reset(){this.ctx.setTransform(1,0,0,1,0,0)}getColor(e){return e=e.toUpperCase(),e in this.colors?this.colors[e]:this.colors.C}drawCircle(e,t,i,n,r=!0,a=!1,s=""){let g=this.ctx,d=this.offsetX,l=this.offsetY;g.save(),g.lineWidth=1.5,g.beginPath(),g.arc(e+d,t+l,i,0,o.twoPI,!0),g.closePath(),a?(r?(g.fillStyle="#f00",g.fill()):(g.strokeStyle="#f00",g.stroke()),this.drawDebugText(e,t,s)):r?(g.fillStyle=n,g.fill()):(g.strokeStyle=n,g.stroke()),g.restore()}drawLine(e,t=!1,i=1){let n=this.ctx,o=this.offsetX,a=this.offsetY,s=e.clone().shorten(4),g=s.getLeftVector().clone(),d=s.getRightVector().clone();g.x+=o,g.y+=a,d.x+=o,d.y+=a,t||(n.save(),n.globalCompositeOperation="destination-out",n.beginPath(),n.moveTo(g.x,g.y),n.lineTo(d.x,d.y),n.lineCap="round",n.lineWidth=this.opts.bondThickness+1.2,n.strokeStyle=this.getColor("BACKGROUND"),n.stroke(),n.globalCompositeOperation="source-over",n.restore()),g=e.getLeftVector().clone(),d=e.getRightVector().clone(),g.x+=o,g.y+=a,d.x+=o,d.y+=a,n.save(),n.beginPath(),n.moveTo(g.x,g.y),n.lineTo(d.x,d.y),n.lineCap="round",n.lineWidth=this.opts.bondThickness;let h=this.ctx.createLinearGradient(g.x,g.y,d.x,d.y);h.addColorStop(.4,this.getColor(e.getLeftElement())||this.getColor("C")),h.addColorStop(.6,this.getColor(e.getRightElement())||this.getColor("C")),t&&(n.setLineDash([1,1.5]),n.lineWidth=this.opts.bondThickness/1.5),1>i&&(n.globalAlpha=i),n.strokeStyle=h,n.stroke(),n.restore()}drawWedge(e,i=1){if(isNaN(e.from.x)||isNaN(e.from.y)||isNaN(e.to.x)||isNaN(e.to.y))return;let n=this.ctx,o=this.offsetX,s=this.offsetY,g=e.clone().shorten(5),d=g.getLeftVector().clone(),h=g.getRightVector().clone();d.x+=o,d.y+=s,h.x+=o,h.y+=s,d=e.getLeftVector().clone(),h=e.getRightVector().clone(),d.x+=o,d.y+=s,h.x+=o,h.y+=s,n.save();let c=a.normals(d,h);c[0].normalize(),c[1].normalize();let p=e.getRightChiral(),f=d,m=h;p&&(f=h,m=d);let b=a.add(f,a.multiplyScalar(c[0],this.halfBondThickness)),t=a.add(m,a.multiplyScalar(c[0],1.5+this.halfBondThickness)),u=a.add(m,a.multiplyScalar(c[1],1.5+this.halfBondThickness)),v=a.add(f,a.multiplyScalar(c[1],this.halfBondThickness));n.beginPath(),n.moveTo(b.x,b.y),n.lineTo(t.x,t.y),n.lineTo(u.x,u.y),n.lineTo(v.x,v.y);let x=this.ctx.createRadialGradient(h.x,h.y,this.opts.bondLength,h.x,h.y,0);x.addColorStop(.4,this.getColor(e.getLeftElement())||this.getColor("C")),x.addColorStop(.6,this.getColor(e.getRightElement())||this.getColor("C")),n.fillStyle=x,n.fill(),n.restore()}drawDashedWedge(e){if(isNaN(e.from.x)||isNaN(e.from.y)||isNaN(e.to.x)||isNaN(e.to.y))return;let i=this.ctx,n=this.offsetX,o=this.offsetY,s=e.getLeftVector().clone(),g=e.getRightVector().clone();s.x+=n,s.y+=o,g.x+=n,g.y+=o,i.save();let r=a.normals(s,g);r[0].normalize(),r[1].normalize();let d,l,h,c,p=e.getRightChiral(),u=e.clone();p?(d=g,l=s,u.shortenRight(1),h=u.getRightVector().clone(),c=u.getLeftVector().clone()):(d=s,l=g,u.shortenLeft(1),h=u.getLeftVector().clone(),c=u.getRightVector().clone()),h.x+=n,h.y+=o,c.x+=n,c.y+=o;let v=a.subtract(l,d).normalize();i.strokeStyle=this.getColor("C"),i.lineCap="round",i.lineWidth=this.opts.bondThickness,i.beginPath();let f=e.getLength(),m=1.25/(f/(3*this.opts.bondThickness)),b=!1;for(var x=0;1>x;x+=m){let t=a.multiplyScalar(v,x*f),n=a.add(d,t),o=1.5*x,s=a.multiplyScalar(r[0],o);!b&&.5<x&&(i.stroke(),i.beginPath(),i.strokeStyle=this.getColor(e.getRightElement())||this.getColor("C"),b=!0),n.subtract(s),i.moveTo(n.x,n.y),n.add(a.multiplyScalar(s,2)),i.lineTo(n.x,n.y)}i.stroke(),i.restore()}drawDebugText(e,t,i){let n=this.ctx;n.save(),n.font="5px Droid Sans, sans-serif",n.textAlign="start",n.textBaseline="top",n.fillStyle="#ff0000",n.fillText(i,e+this.offsetX,t+this.offsetY),n.restore()}drawBall(e,t,i){let n=this.ctx;n.save(),n.beginPath(),n.arc(e+this.offsetX,t+this.offsetY,this.opts.bondLength/4.5,0,o.twoPI,!1),n.fillStyle=this.getColor(i),n.fill(),n.restore()}drawPoint(e,t,i){let n=this.ctx,r=this.offsetX,a=this.offsetY;n.save(),n.globalCompositeOperation="destination-out",n.beginPath(),n.arc(e+r,t+a,1.5,0,o.twoPI,!0),n.closePath(),n.fill(),n.globalCompositeOperation="source-over",n.beginPath(),n.arc(e+this.offsetX,t+this.offsetY,.75,0,o.twoPI,!1),n.fillStyle=this.getColor(i),n.fill(),n.restore()}drawText(e,t,i,n,a,s,g,d,l={}){let h=this.ctx,c=this.offsetX,p=this.offsetY;h.save(),h.textAlign="start",h.textBaseline="alphabetic";let u="",v=0;g&&(u=this.getChargeText(g),h.font=this.fontSmall,v=h.measureText(u).width);let f="0",m=0;0<d&&(f=d.toString(),h.font=this.fontSmall,m=h.measureText(f).width),1===g&&"N"===i&&l.hasOwnProperty("0O")&&l.hasOwnProperty("0O-1")&&(l={"0O":{element:"O",count:2,hydrogenCount:0,previousElement:"C",charge:""}},g=0),h.font=this.fontLarge,h.fillStyle=this.getColor("BACKGROUND");let b=h.measureText(i);b.totalWidth=b.width+v,b.height=parseInt(this.fontLarge,10);let x=b.width>this.opts.fontSizeLarge?b.width:this.opts.fontSizeLarge;x/=1.5,h.globalCompositeOperation="destination-out",h.beginPath(),h.arc(e+c,t+p,x,0,o.twoPI,!0),h.closePath(),h.fill(),h.globalCompositeOperation="source-over";let y=-b.width/2,S=-b.width/2;h.fillStyle=this.getColor(i),h.fillText(i,e+c+y,t+this.opts.halfFontSizeLarge+p),y+=b.width,g&&(h.font=this.fontSmall,h.fillText(u,e+c+y,t-this.opts.fifthFontSizeSmall+p),y+=v),0<d&&(h.font=this.fontSmall,h.fillText(f,e+c+S-m,t-this.opts.fifthFontSizeSmall+p),S-=m),h.font=this.fontLarge;let C=0,R=0;if(1===n){let i=e+c,n=t+p+this.opts.halfFontSizeLarge;C=this.hydrogenWidth,S-=C,"left"===a?i+=S:"right"===a?i+=y:"up"===a&&s?i+=y:"down"===a&&s?i+=y:"up"!==a||s?"down"===a&&!s&&(n+=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,i-=this.halfHydrogenWidth):(n-=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,i-=this.halfHydrogenWidth),h.fillText("H",i,n),y+=C}else if(1<n){let i=e+c,r=t+p+this.opts.halfFontSizeLarge;C=this.hydrogenWidth,h.font=this.fontSmall,R=h.measureText(n).width,S-=C+R,"left"===a?i+=S:"right"===a?i+=y:"up"===a&&s?i+=y:"down"===a&&s?i+=y:"up"!==a||s?"down"===a&&!s&&(r+=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,i-=this.halfHydrogenWidth):(r-=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,i-=this.halfHydrogenWidth),h.font=this.fontLarge,h.fillText("H",i,r),h.font=this.fontSmall,h.fillText(n,i+this.halfHydrogenWidth+R,r+this.opts.fifthFontSizeSmall),y+=C+this.halfHydrogenWidth+R}for(let r in l){if(!l.hasOwnProperty(r))continue;let i=0,n=0,o=l[r].element,s=l[r].count,g=l[r].hydrogenCount,d=l[r].charge;h.font=this.fontLarge,1<s&&0<g&&(i=h.measureText("(").width,n=h.measureText(")").width);let u=h.measureText(o).width,v=0,f="",m=0;C=0,0<g&&(C=this.hydrogenWidth),h.font=this.fontSmall,1<s&&(v=h.measureText(s).width),0!==d&&(f=this.getChargeText(d),m=h.measureText(f).width),R=0,1<g&&(R=h.measureText(g).width),h.font=this.fontLarge;let b=e+c,x=t+p+this.opts.halfFontSizeLarge;h.fillStyle=this.getColor(o),0<s&&(S-=v),1<s&&0<g&&("left"===a?(S-=n,h.fillText(")",b+S,x)):(h.fillText("(",b+y,x),y+=i)),"left"===a?(S-=u,h.fillText(o,b+S,x)):(h.fillText(o,b+y,x),y+=u),0<g&&("left"===a?(S-=C+R,h.fillText("H",b+S,x),1<g&&(h.font=this.fontSmall,h.fillText(g,b+S+C,x+this.opts.fifthFontSizeSmall))):(h.fillText("H",b+y,x),y+=C,1<g&&(h.font=this.fontSmall,h.fillText(g,b+y,x+this.opts.fifthFontSizeSmall),y+=R))),h.font=this.fontLarge,1<s&&0<g&&("left"===a?(S-=i,h.fillText("(",b+S,x)):(h.fillText(")",b+y,x),y+=n)),h.font=this.fontSmall,1<s&&("left"===a?h.fillText(s,b+S+i+n+C+R+u,x+this.opts.fifthFontSizeSmall):(h.fillText(s,b+y,x+this.opts.fifthFontSizeSmall),y+=v)),0!==d&&("left"===a?h.fillText(f,b+S+i+n+C+R+u,t-this.opts.fifthFontSizeSmall+p):(h.fillText(f,b+y,t-this.opts.fifthFontSizeSmall+p),y+=m))}h.restore()}getChargeText(e){return 1===e?"+":2===e?"2+":-1===e?"-":-2===e?"2-":""}drawDebugPoint(e,t,i="",n="#f00"){this.drawCircle(e,t,2,n,!0,!0,i)}drawAromaticityRing(e){let t=this.ctx,i=o.apothemFromSideLength(this.opts.bondLength,e.getSize());t.save(),t.strokeStyle=this.getColor("C"),t.lineWidth=this.opts.bondThickness,t.beginPath(),t.arc(e.center.x+this.offsetX,e.center.y+this.offsetY,i-this.opts.bondSpacing,0,2*Math.PI,!0),t.closePath(),t.stroke(),t.restore()}clear(){this.ctx.clearRect(0,0,this.canvas.offsetWidth,this.canvas.offsetHeight)}}},{"./Line":8,"./MathHelper":9,"./Ring":11,"./Vector2":14,"./Vertex":15}],5:[function(e,t){"use strict";var i=Math.sin,n=Math.cos,r=Math.sqrt,o=Math.PI,s=Math.min,g=Math.max;const d=e("./MathHelper"),l=e("./ArrayHelper"),h=e("./Vector2"),c=e("./Line"),p=e("./Vertex"),u=e("./Edge"),v=e("./Atom"),f=e("./Ring"),m=e("./RingConnection"),b=e("./CanvasWrapper"),x=e("./Graph"),y=e("./SSSR");t.exports=class{constructor(e){this.graph=null,this.doubleBondConfigCount=0,this.doubleBondConfig=null,this.ringIdCounter=0,this.ringConnectionIdCounter=0,this.canvasWrapper=null,this.totalOverlapScore=0,this.defaultOptions={width:500,height:500,bondThickness:.6,bondLength:15,shortBondLength:.85,bondSpacing:15*.18,atomVisualization:"default",isomeric:!0,debug:!1,terminalCarbons:!1,explicitHydrogens:!1,overlapSensitivity:.42,overlapResolutionIterations:1,compactDrawing:!0,fontSizeLarge:5,fontSizeSmall:3,padding:20,themes:{dark:{C:"#fff",O:"#e74c3c",N:"#3498db",F:"#27ae60",CL:"#16a085",BR:"#d35400",I:"#8e44ad",P:"#d35400",S:"#f1c40f",B:"#e67e22",SI:"#e67e22",H:"#fff",BACKGROUND:"#141414"},light:{C:"#222",O:"#e74c3c",N:"#3498db",F:"#27ae60",CL:"#16a085",BR:"#d35400",I:"#8e44ad",P:"#d35400",S:"#f1c40f",B:"#e67e22",SI:"#e67e22",H:"#222",BACKGROUND:"#fff"}}},this.opts=this.extend(!0,this.defaultOptions,e),this.opts.halfBondSpacing=this.opts.bondSpacing/2,this.opts.bondLengthSq=this.opts.bondLength*this.opts.bondLength,this.opts.halfFontSizeLarge=this.opts.fontSizeLarge/2,this.opts.quarterFontSizeLarge=this.opts.fontSizeLarge/4,this.opts.fifthFontSizeSmall=this.opts.fontSizeSmall/5,this.theme=this.opts.themes.dark}extend(){let e=this,t={},n=!1,r=0,o=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(n=arguments[0],r++);for(let i=function(i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=n&&"[object Object]"===Object.prototype.toString.call(i[r])?e.extend(!0,t[r],i[r]):i[r])};r<o;r++){let e=arguments[r];i(e)}return t}draw(e,t,n="light",r=!1){if(this.data=e,this.infoOnly=r,this.infoOnly||(this.canvasWrapper=new b(t,this.opts.themes[n],this.opts)),this.ringIdCounter=0,this.ringConnectionIdCounter=0,this.graph=new x(e,this.opts.isomeric),this.rings=[],this.ringConnections=[],this.originalRings=[],this.originalRingConnections=[],this.bridgedRing=!1,this.doubleBondConfigCount=null,this.doubleBondConfig=null,this.initRings(),this.initHydrogens(),!this.infoOnly){this.position(),this.restoreRingInformation(),this.resolvePrimaryOverlaps();let e=this.getOverlapScore();this.totalOverlapScore=this.getOverlapScore().total;for(var a=0;a<this.opts.overlapResolutionIterations;a++)for(var s=0;s<this.graph.edges.length;s++){let t=this.graph.edges[s];if(this.isEdgeRotatable(t)){let i=this.graph.getTreeDepth(t.sourceId,t.targetId),n=this.graph.getTreeDepth(t.targetId,t.sourceId),r=t.targetId,o=t.sourceId;i>n&&(r=t.sourceId,o=t.targetId);let a=this.getSubtreeOverlapScore(o,r,e.vertexScores);if(a.value>this.opts.overlapSensitivity){let t=this.graph.vertices[r],i=this.graph.vertices[o],n=i.getNeighbours(r);if(1===n.length){let e=this.graph.vertices[n[0]],r=e.position.getRotateAwayFromAngle(t.position,i.position,d.toRad(120));this.rotateSubtree(e.id,i.id,r,i.position);let o=this.getOverlapScore().total;o>this.totalOverlapScore?this.rotateSubtree(e.id,i.id,-r,i.position):this.totalOverlapScore=o}else if(2===n.length){if(0!==i.value.rings.length&&0!==t.value.rings.length)continue;let e=this.graph.vertices[n[0]],r=this.graph.vertices[n[1]];if(1===e.value.rings.length&&1===r.value.rings.length){if(e.value.rings[0]!==r.value.rings[0])continue;}else if(0!==e.value.rings.length||0!==r.value.rings.length)continue;else{let n=e.position.getRotateAwayFromAngle(t.position,i.position,d.toRad(120)),o=r.position.getRotateAwayFromAngle(t.position,i.position,d.toRad(120));this.rotateSubtree(e.id,i.id,n,i.position),this.rotateSubtree(r.id,i.id,o,i.position);let a=this.getOverlapScore().total;a>this.totalOverlapScore?(this.rotateSubtree(e.id,i.id,-n,i.position),this.rotateSubtree(r.id,i.id,-o,i.position)):this.totalOverlapScore=a}}e=this.getOverlapScore()}}}this.resolveSecondaryOverlaps(e.scores),this.opts.isomeric&&this.annotateStereochemistry(),this.opts.compactDrawing&&"default"===this.opts.atomVisualization&&this.initPseudoElements(),this.rotateDrawing(),this.canvasWrapper.scale(this.graph.vertices),this.drawEdges(this.opts.debug),this.drawVertices(this.opts.debug),this.canvasWrapper.reset()}}edgeRingCount(e){let t=this.graph.edges[e],i=this.graph.vertices[t.sourceId],n=this.graph.vertices[t.targetId];return s(i.value.rings.length,n.value.rings.length)}getBridgedRings(){let e=[];for(var t=0;t<this.rings.length;t++)this.rings[t].isBridged&&e.push(this.rings[t]);return e}getFusedRings(){let e=[];for(var t=0;t<this.rings.length;t++)this.rings[t].isFused&&e.push(this.rings[t]);return e}getSpiros(){let e=[];for(var t=0;t<this.rings.length;t++)this.rings[t].isSpiro&&e.push(this.rings[t]);return e}printRingInfo(){let e="";for(var t=0;t<this.rings.length;t++){const i=this.rings[t];e+=i.id+";",e+=i.members.length+";",e+=i.neighbours.length+";",e+=i.isSpiro?"true;":"false;",e+=i.isFused?"true;":"false;",e+=i.isBridged?"true;":"false;",e+=i.rings.length+";",e+="\n"}return e}rotateDrawing(){let e=0,t=0,n=0;for(var r=0;r<this.graph.vertices.length;r++){let i=this.graph.vertices[r];if(i.value.isDrawn)for(var o=r+1;o<this.graph.vertices.length;o++){let a=this.graph.vertices[o];if(!a.value.isDrawn)continue;let s=i.position.distanceSq(a.position);s>n&&(n=s,e=r,t=o)}}let s=-h.subtract(this.graph.vertices[e].position,this.graph.vertices[t].position).angle();if(!isNaN(s)){let e=s%.523599;.2617995>e?s-=e:s+=.523599-e;for(var r=0;r<this.graph.vertices.length;r++)r!==t&&this.graph.vertices[r].position.rotateAround(s,this.graph.vertices[t].position);for(var r=0;r<this.rings.length;r++)this.rings[r].center.rotateAround(s,this.graph.vertices[t].position)}}getTotalOverlapScore(){return this.totalOverlapScore}getRingCount(){return this.rings.length}hasBridgedRing(){return this.bridgedRing}getHeavyAtomCount(){let e=0;for(var t=0;t<this.graph.vertices.length;t++)"H"!==this.graph.vertices[t].value.element&&e++;return e}getMolecularFormula(){let t="",n=new Map;for(var r=0;r<this.graph.vertices.length;r++){let e=this.graph.vertices[r].value;if(n.has(e.element)?n.set(e.element,n.get(e.element)+1):n.set(e.element,1),e.bracket&&!e.bracket.chirality&&(n.has("H")?n.set("H",n.get("H")+e.bracket.hcount):n.set("H",e.bracket.hcount)),!e.bracket){let t=v.maxBonds[e.element]-e.bondCount;e.isPartOfAromaticRing&&t--,n.has("H")?n.set("H",n.get("H")+t):n.set("H",t)}}if(n.has("C")){let e=n.get("C");t+="C"+(1<e?e:""),n.delete("C")}if(n.has("H")){let e=n.get("H");t+="H"+(1<e?e:""),n.delete("H")}let e=Object.keys(v.atomicNumbers).sort();return e.map(i=>{if(n.has(i)){let e=n.get(i);t+=i+(1<e?e:"")}}),t}getRingbondType(e,t){if(1>e.value.getRingbondCount()||1>t.value.getRingbondCount())return null;for(var n=0;n<e.value.ringbonds.length;n++)for(var r=0;r<t.value.ringbonds.length;r++)if(e.value.ringbonds[n].id===t.value.ringbonds[r].id)return"-"===e.value.ringbonds[n].bondType?t.value.ringbonds[r].bond:e.value.ringbonds[n].bond;return null}initRings(){let e=new Map;for(var t=this.graph.vertices.length-1;0<=t;t--){let i=this.graph.vertices[t];if(0!==i.value.ringbonds.length)for(var n=0;n<i.value.ringbonds.length;n++){let t=i.value.ringbonds[n].id,r=i.value.ringbonds[n].bond;if(!e.has(t))e.set(t,[i.id,r]);else{let o=i.id,a=e.get(t)[0],s=e.get(t)[1],g=new u(o,a,1);g.setBondType(s||r||"-");let d=this.graph.addEdge(g),l=this.graph.vertices[a];i.addRingbondChild(a,n),i.value.addNeighbouringElement(l.value.element),l.addRingbondChild(o,n),l.value.addNeighbouringElement(i.value.element),i.edges.push(d),l.edges.push(d),e.delete(t)}}}let r=y.getRings(this.graph);if(null!==r){for(var t=0;t<r.length;t++){let e=[...r[t]],i=this.addRing(new f(e));for(var n=0;n<e.length;n++)this.graph.vertices[e[n]].value.rings.push(i)}for(var t=0;t<this.rings.length-1;t++)for(var n=t+1;n<this.rings.length;n++){let e=this.rings[t],i=this.rings[n],r=new m(e,i);0<r.vertices.size&&this.addRingConnection(r)}for(var t=0;t<this.rings.length;t++){let e=this.rings[t];e.neighbours=m.getNeighbours(this.ringConnections,e.id)}for(var t=0;t<this.rings.length;t++){let e=this.rings[t];this.graph.vertices[e.members[0]].value.addAnchoredRing(e.id)}for(this.backupRingInformation();0<this.rings.length;){let e=-1;for(var t=0;t<this.rings.length;t++){let i=this.rings[t];this.isPartOfBridgedRing(i.id)&&!i.isBridged&&(e=i.id)}if(-1===e)break;let i=this.getRing(e),n=this.getBridgedRingRings(i.id);this.bridgedRing=!0,this.createBridgedRing(n,i.members[0]);for(var t=0;t<n.length;t++)this.removeRing(n[t])}}}initHydrogens(){if(!this.opts.explicitHydrogens)for(var e=0;e<this.graph.vertices.length;e++){let t=this.graph.vertices[e];if("H"!==t.value.element)continue;let i=this.graph.vertices[t.neighbours[0]];i.value.hasHydrogen=!0,(!i.value.isStereoCenter||2>i.value.rings.length&&!i.value.bridgedRing||i.value.bridgedRing&&2>i.value.originalRings.length)&&(t.value.isDrawn=!1)}}getBridgedRingRings(e){let t=[],o=this,a=function(e){let r=o.getRing(e);t.push(e);for(var s=0;s<r.neighbours.length;s++){let i=r.neighbours[s];-1===t.indexOf(i)&&i!==e&&m.isBridge(o.ringConnections,o.graph.vertices,e,i)&&a(i)}};return a(e),l.unique(t)}isPartOfBridgedRing(e){for(var t=0;t<this.ringConnections.length;t++)if(this.ringConnections[t].containsRing(e)&&this.ringConnections[t].isBridge(this.graph.vertices))return!0;return!1}createBridgedRing(e,t){let n=new Set,r=new Set,o=new Set;for(var a=0;a<e.length;a++){let t=this.getRing(e[a]);t.isPartOfBridged=!0;for(var s=0;s<t.members.length;s++)r.add(t.members[s]);for(var s=0;s<t.neighbours.length;s++){let i=t.neighbours[s];-1===e.indexOf(i)&&o.add(t.neighbours[s])}}let g=new Set;for(let i of r){let t=this.graph.vertices[i],r=l.intersection(e,t.value.rings);1===t.value.rings.length||1===r.length?n.add(t.id):g.add(t.id)}let d=[];for(let i of g){let e=this.graph.vertices[i],t=!1;for(let i=0;i<e.edges.length;i++)1===this.edgeRingCount(e.edges[i])&&(t=!0);t?(e.value.isBridgeNode=!0,n.add(e.id)):(e.value.isBridge=!0,n.add(e.id))}let h=new f([...n]);h.isBridged=!0,h.neighbours=[...o];for(var a=0;a<e.length;a++)h.rings.push(this.getRing(e[a]).clone());this.addRing(h);for(var a=0;a<h.members.length;a++)this.graph.vertices[h.members[a]].value.bridgedRing=h.id;for(var a=0;a<d.length;a++){let e=this.graph.vertices[d[a]];e.value.rings=[]}for(let i of n){let t=this.graph.vertices[i];t.value.rings=l.removeAll(t.value.rings,e),t.value.rings.push(h.id)}for(var a=0;a<e.length;a++)for(var s=a+1;s<e.length;s++)this.removeRingConnectionsBetween(e[a],e[s]);for(let i of o){let t=this.getRingConnections(i,e);for(var s=0;s<t.length;s++)this.getRingConnection(t[s]).updateOther(h.id,i);this.getRing(i).neighbours.push(h.id)}return h}areVerticesInSameRing(e,t){for(var n=0;n<e.value.rings.length;n++)for(var r=0;r<t.value.rings.length;r++)if(e.value.rings[n]===t.value.rings[r])return!0;return!1}getCommonRings(e,t){let n=[];for(var r=0;r<e.value.rings.length;r++)for(var o=0;o<t.value.rings.length;o++)e.value.rings[r]==t.value.rings[o]&&n.push(e.value.rings[r]);return n}getLargestOrAromaticCommonRing(e,t){let n=this.getCommonRings(e,t),r=0,o=null;for(var a=0;a<n.length;a++){let e=this.getRing(n[a]),t=e.getSize();if(e.isBenzeneLike(this.graph.vertices))return e;t>r&&(r=t,o=e)}return o}getVerticesAt(e,t,n){let r=[];for(var o=0;o<this.graph.vertices.length;o++){let i=this.graph.vertices[o];if(i.id===n||!i.positioned)continue;let a=e.distanceSq(i.position);a<=t*t&&r.push(i.id)}return r}getClosestVertex(e){let t=99999,n=null;for(var r=0;r<this.graph.vertices.length;r++){let i=this.graph.vertices[r];if(i.id===e.id)continue;let o=e.position.distanceSq(i.position);o<t&&(t=o,n=i)}return n}addRing(e){return e.id=this.ringIdCounter++,this.rings.push(e),e.id}removeRing(e){this.rings=this.rings.filter(function(t){return t.id!==e}),this.ringConnections=this.ringConnections.filter(function(t){return t.firstRingId!==e&&t.secondRingId!==e});for(var t=0;t<this.rings.length;t++){let i=this.rings[t];i.neighbours=i.neighbours.filter(function(t){return t!==e})}}getRing(e){for(var t=0;t<this.rings.length;t++)if(this.rings[t].id==e)return this.rings[t]}addRingConnection(e){return e.id=this.ringConnectionIdCounter++,this.ringConnections.push(e),e.id}removeRingConnection(e){this.ringConnections=this.ringConnections.filter(function(t){return t.id!==e})}removeRingConnectionsBetween(e,t){let n=[];for(var r=0;r<this.ringConnections.length;r++){let i=this.ringConnections[r];(i.firstRingId===e&&i.secondRingId===t||i.firstRingId===t&&i.secondRingId===e)&&n.push(i.id)}for(var r=0;r<n.length;r++)this.removeRingConnection(n[r])}getRingConnection(e){for(var t=0;t<this.ringConnections.length;t++)if(this.ringConnections[t].id==e)return this.ringConnections[t]}getRingConnections(e,t){let n=[];for(var r=0;r<this.ringConnections.length;r++){let i=this.ringConnections[r];for(var o=0;o<t.length;o++){let r=t[o];(i.firstRingId===e&&i.secondRingId===r||i.firstRingId===r&&i.secondRingId===e)&&n.push(i.id)}}return n}getOverlapScore(){let e=0,t=new Float32Array(this.graph.vertices.length);for(var n=0;n<this.graph.vertices.length;n++)t[n]=0;for(var o,n=0;n<this.graph.vertices.length;n++)for(o=this.graph.vertices.length;--o>n;){let i=this.graph.vertices[n],a=this.graph.vertices[o];if(!i.value.isDrawn||!a.value.isDrawn)continue;let s=h.subtract(i.position,a.position).lengthSq();if(s<this.opts.bondLengthSq){let i=(this.opts.bondLength-r(s))/this.opts.bondLength;e+=i,t[n]+=i,t[o]+=i}}let a=[];for(var n=0;n<this.graph.vertices.length;n++)a.push({id:n,score:t[n]});return a.sort(function(e,t){return t.score-e.score}),{total:e,scores:a,vertexScores:t}}chooseSide(e,t,n){let r=e.getNeighbours(t.id),o=t.getNeighbours(e.id),a=r.length,s=o.length,g=l.merge(r,o),d=[0,0];for(var h=0;h<g.length;h++){let i=this.graph.vertices[g[h]].position;i.sameSideAs(e.position,t.position,n[0])?d[0]++:d[1]++}let c=[0,0];for(var h=0;h<this.graph.vertices.length;h++){let i=this.graph.vertices[h].position;i.sameSideAs(e.position,t.position,n[0])?c[0]++:c[1]++}return{totalSideCount:c,totalPosition:c[0]>c[1]?0:1,sideCount:d,position:d[0]>d[1]?0:1,anCount:a,bnCount:s}}setRingCenter(e){let t=e.getSize(),n=new h(0,0);for(var r=0;r<t;r++)n.add(this.graph.vertices[e.members[r]].position);e.center=n.divide(t)}getSubringCenter(e,t){let n=t.value.originalRings,r=e.center,o=Number.MAX_VALUE;for(var a=0;a<n.length;a++)for(var s=0;s<e.rings.length;s++)n[a]===e.rings[s].id&&e.rings[s].getSize()<o&&(r=e.rings[s].center,o=e.rings[s].getSize());return r}drawEdges(e){let t=this,n=Array(this.graph.edges.length);if(n.fill(!1),this.graph.traverseBF(0,function(r){let o=t.graph.getEdges(r.id);for(var a=0;a<o.length;a++){let i=o[a];n[i]||(n[i]=!0,t.drawEdge(i,e))}}),!this.bridgedRing)for(var r=0;r<this.rings.length;r++){let e=this.rings[r];this.isRingAromatic(e)&&this.canvasWrapper.drawAromaticityRing(e)}}drawEdge(e,t){let i=this,n=this.graph.edges[e],r=this.graph.vertices[n.sourceId],o=this.graph.vertices[n.targetId],s=r.value.element,g=o.value.element;if((!r.value.isDrawn||!o.value.isDrawn)&&"default"===this.opts.atomVisualization)return;let d=r.position,a=o.position,p=this.getEdgeNormals(n),u=l.clone(p);if(u[0].multiplyScalar(10).add(d),u[1].multiplyScalar(10).add(d),"="===n.bondType||"="===this.getRingbondType(r,o)||n.isPartOfAromaticRing&&this.bridgedRing){let e=this.areVerticesInSameRing(r,o),t=this.chooseSide(r,o,u);if(e){let e=this.getLargestOrAromaticCommonRing(r,o),t=e.center;p[0].multiplyScalar(i.opts.bondSpacing),p[1].multiplyScalar(i.opts.bondSpacing);let l=null;l=t.sameSideAs(r.position,o.position,h.add(d,p[0]))?new c(h.add(d,p[0]),h.add(a,p[0]),s,g):new c(h.add(d,p[1]),h.add(a,p[1]),s,g),l.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),n.isPartOfAromaticRing?this.canvasWrapper.drawLine(l,!0):this.canvasWrapper.drawLine(l),this.canvasWrapper.drawLine(new c(d,a,s,g))}else if(n.center||r.isTerminal()&&o.isTerminal()){p[0].multiplyScalar(i.opts.halfBondSpacing),p[1].multiplyScalar(i.opts.halfBondSpacing);let e=new c(h.add(d,p[0]),h.add(a,p[0]),s,g),t=new c(h.add(d,p[1]),h.add(a,p[1]),s,g);this.canvasWrapper.drawLine(e),this.canvasWrapper.drawLine(t)}else if(0==t.anCount&&1<t.bnCount||0==t.bnCount&&1<t.anCount){p[0].multiplyScalar(i.opts.halfBondSpacing),p[1].multiplyScalar(i.opts.halfBondSpacing);let e=new c(h.add(d,p[0]),h.add(a,p[0]),s,g),t=new c(h.add(d,p[1]),h.add(a,p[1]),s,g);this.canvasWrapper.drawLine(e),this.canvasWrapper.drawLine(t)}else if(t.sideCount[0]>t.sideCount[1]){p[0].multiplyScalar(i.opts.bondSpacing),p[1].multiplyScalar(i.opts.bondSpacing);let e=new c(h.add(d,p[0]),h.add(a,p[0]),s,g);e.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine(e),this.canvasWrapper.drawLine(new c(d,a,s,g))}else if(t.sideCount[0]<t.sideCount[1]){p[0].multiplyScalar(i.opts.bondSpacing),p[1].multiplyScalar(i.opts.bondSpacing);let e=new c(h.add(d,p[1]),h.add(a,p[1]),s,g);e.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine(e),this.canvasWrapper.drawLine(new c(d,a,s,g))}else if(t.totalSideCount[0]>t.totalSideCount[1]){p[0].multiplyScalar(i.opts.bondSpacing),p[1].multiplyScalar(i.opts.bondSpacing);let e=new c(h.add(d,p[0]),h.add(a,p[0]),s,g);e.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine(e),this.canvasWrapper.drawLine(new c(d,a,s,g))}else if(t.totalSideCount[0]<=t.totalSideCount[1]){p[0].multiplyScalar(i.opts.bondSpacing),p[1].multiplyScalar(i.opts.bondSpacing);let e=new c(h.add(d,p[1]),h.add(a,p[1]),s,g);e.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine(e),this.canvasWrapper.drawLine(new c(d,a,s,g))}else;}else if("#"===n.bondType){p[0].multiplyScalar(i.opts.bondSpacing/1.5),p[1].multiplyScalar(i.opts.bondSpacing/1.5);let e=new c(h.add(d,p[0]),h.add(a,p[0]),s,g),t=new c(h.add(d,p[1]),h.add(a,p[1]),s,g);this.canvasWrapper.drawLine(e),this.canvasWrapper.drawLine(t),this.canvasWrapper.drawLine(new c(d,a,s,g))}else if("."===n.bondType);else{let e=r.value.isStereoCenter,t=o.value.isStereoCenter;"up"===n.wedge?this.canvasWrapper.drawWedge(new c(d,a,s,g,e,t)):"down"===n.wedge?this.canvasWrapper.drawDashedWedge(new c(d,a,s,g,e,t)):this.canvasWrapper.drawLine(new c(d,a,s,g,e,t))}if(t){let t=h.midpoint(d,a);this.canvasWrapper.drawDebugText(t.x,t.y,"e: "+e)}}drawVertices(e){for(var t=Math.abs,n=this.graph.vertices.length,n=0;n<this.graph.vertices.length;n++){let i=this.graph.vertices[n],r=i.value,a=0,s=0,g=i.value.bondCount,d=r.element,c=v.maxBonds[d]-g,p=i.getTextDirection(this.graph.vertices),u=!!(this.opts.terminalCarbons||"C"!==d||r.hasAttachedPseudoElements)&&i.isTerminal(),f="C"===r.element;if("N"===r.element&&r.isPartOfAromaticRing&&(c=0),r.bracket&&(c=r.bracket.hcount,a=r.bracket.charge,s=r.bracket.isotope),"allballs"===this.opts.atomVisualization)this.canvasWrapper.drawBall(i.position.x,i.position.y,d);else if(r.isDrawn&&(!f||r.drawExplicit||u||r.hasAttachedPseudoElements)||1===this.graph.vertices.length)"default"===this.opts.atomVisualization?this.canvasWrapper.drawText(i.position.x,i.position.y,d,c,p,u,a,s,r.getAttachedPseudoElements()):"balls"===this.opts.atomVisualization&&this.canvasWrapper.drawBall(i.position.x,i.position.y,d);else if(2===i.getNeighbourCount()&&!0==i.forcePositioned){let e=this.graph.vertices[i.neighbours[0]].position,n=this.graph.vertices[i.neighbours[1]].position,r=h.threePointangle(i.position,e,n);.1>t(o-r)&&this.canvasWrapper.drawPoint(i.position.x,i.position.y,d)}if(e){let e="v: "+i.id+" "+l.print(r.ringbonds);this.canvasWrapper.drawDebugText(i.position.x,i.position.y,e)}else;}if(this.opts.debug)for(var n=0;n<this.rings.length;n++){let e=this.rings[n].center;this.canvasWrapper.drawDebugPoint(e.x,e.y,"r: "+this.rings[n].id)}}position(){let e=null;for(var t=0;t<this.graph.vertices.length;t++)if(null!==this.graph.vertices[t].value.bridgedRing){e=this.graph.vertices[t];break}for(var t=0;t<this.rings.length;t++)this.rings[t].isBridged&&(e=this.graph.vertices[this.rings[t].members[0]]);0<this.rings.length&&null===e&&(e=this.graph.vertices[this.rings[0].members[0]]),null===e&&(e=this.graph.vertices[0]),this.createNextBond(e,null,0)}backupRingInformation(){this.originalRings=[],this.originalRingConnections=[];for(var e=0;e<this.rings.length;e++)this.originalRings.push(this.rings[e]);for(var e=0;e<this.ringConnections.length;e++)this.originalRingConnections.push(this.ringConnections[e]);for(var e=0;e<this.graph.vertices.length;e++)this.graph.vertices[e].value.backupRings()}restoreRingInformation(){let e=this.getBridgedRings();this.rings=[],this.ringConnections=[];for(var t=0;t<e.length;t++){let i=e[t];for(var n=0;n<i.rings.length;n++){let e=i.rings[n];this.originalRings[e.id].center=e.center}}for(var t=0;t<this.originalRings.length;t++)this.rings.push(this.originalRings[t]);for(var t=0;t<this.originalRingConnections.length;t++)this.ringConnections.push(this.originalRingConnections[t]);for(var t=0;t<this.graph.vertices.length;t++)this.graph.vertices[t].value.restoreRings()}createRing(e,t=null,r=null,o=null){if(e.positioned)return;t=t?t:new h(0,0);let s=e.getOrderedNeighbours(this.ringConnections),g=r?h.subtract(r.position,t).angle():0,l=d.polyCircumradius(this.opts.bondLength,e.getSize()),c=d.centralAngle(e.getSize());e.centralAngle=c;let p=g,u=this,v=r?r.id:null;if(-1===e.members.indexOf(v)&&(r&&(r.positioned=!1),v=e.members[0]),e.isBridged){this.graph.kkLayout(e.members.slice(),t,r.id,e,this.opts.bondLength),e.positioned=!0,this.setRingCenter(e),t=e.center;for(var f=0;f<e.rings.length;f++)this.setRingCenter(e.rings[f])}else e.eachMember(this.graph.vertices,function(r){let o=u.graph.vertices[r];o.positioned||o.setPosition(t.x+n(p)*l,t.y+i(p)*l),p+=c,(!e.isBridged||3>e.rings.length)&&(o.angle=p,o.positioned=!0)},v,o?o.id:null);e.positioned=!0,e.center=t;for(var f=0;f<s.length;f++){let i=this.getRing(s[f].neighbour);if(i.positioned)continue;let n=m.getVertices(this.ringConnections,e.id,i.id);if(2===n.length){e.isFused=!0,i.isFused=!0;let o=this.graph.vertices[n[0]],a=this.graph.vertices[n[1]],s=h.midpoint(o.position,a.position),g=h.normals(o.position,a.position);g[0].normalize(),g[1].normalize();let l=d.polyCircumradius(this.opts.bondLength,i.getSize()),r=d.apothem(l,i.getSize());g[0].multiplyScalar(r).add(s),g[1].multiplyScalar(r).add(s);let c=g[0];h.subtract(t,g[1]).lengthSq()>h.subtract(t,g[0]).lengthSq()&&(c=g[1]);let p=h.subtract(o.position,c),u=h.subtract(a.position,c);-1===p.clockwise(u)?!i.positioned&&this.createRing(i,c,o,a):!i.positioned&&this.createRing(i,c,a,o)}else if(1===n.length){e.isSpiro=!0,i.isSpiro=!0;let o=this.graph.vertices[n[0]],a=h.subtract(t,o.position);a.invert(),a.normalize();let s=d.polyCircumradius(this.opts.bondLength,i.getSize());a.multiplyScalar(s),a.add(o.position),i.positioned||this.createRing(i,a,o)}}for(var f=0;f<e.members.length;f++){let t=this.graph.vertices[e.members[f]],i=t.neighbours;for(var b=0;b<i.length;b++){let e=this.graph.vertices[i[b]];e.positioned||(e.value.isConnectedToRing=!0,this.createNextBond(e,t,0))}}}rotateSubtree(e,t,n,r){let o=this;this.graph.traverseTree(e,t,function(e){e.position.rotateAround(n,r);for(var t=0;t<e.value.anchoredRings.length;t++){let i=o.rings[e.value.anchoredRings[t]];i&&i.center.rotateAround(n,r)}})}getSubtreeOverlapScore(e,t,i){let n=this,r=0,o=new h(0,0),a=0;return this.graph.traverseTree(e,t,function(e){if(e.value.isDrawn){let t=i[e.id];t>n.opts.overlapSensitivity&&(r+=t,a++);let s=n.graph.vertices[e.id].position.clone();s.multiplyScalar(t),o.add(s)}}),o.divide(r),{value:r/a,center:o}}getCurrentCenterOfMass(){let e=new h(0,0),t=0;for(var n=0;n<this.graph.vertices.length;n++){let i=this.graph.vertices[n];i.positioned&&(e.add(i.position),t++)}return e.divide(t)}getCurrentCenterOfMassInNeigbourhood(e,t=2*this.opts.bondLength){let n=new h(0,0),r=0;for(var o=0;o<this.graph.vertices.length;o++){let i=this.graph.vertices[o];i.positioned&&e.distanceSq(i.position)<t*t&&(n.add(i.position),r++)}return n.divide(r)}resolvePrimaryOverlaps(){let e=[],t=Array(this.graph.vertices.length);for(var n=0;n<this.rings.length;n++){let i=this.rings[n];for(var r=0;r<i.members.length;r++){let n=this.graph.vertices[i.members[r]];if(t[n.id])continue;t[n.id]=!0;let o=this.getNonRingNeighbours(n.id);if(1<o.length){let t=[];for(var a=0;a<n.value.rings.length;a++)t.push(n.value.rings[a]);e.push({common:n,rings:t,vertices:o})}else if(1===o.length&&2===n.value.rings.length){let t=[];for(var a=0;a<n.value.rings.length;a++)t.push(n.value.rings[a]);e.push({common:n,rings:t,vertices:o})}}}for(var n=0;n<e.length;n++){let t=e[n];if(2===t.vertices.length){let e=t.vertices[0],i=t.vertices[1];if(!e.value.isDrawn||!i.value.isDrawn)continue;let n=(2*o-this.getRing(t.rings[0]).getAngle())/6;this.rotateSubtree(e.id,t.common.id,n,t.common.position),this.rotateSubtree(i.id,t.common.id,-n,t.common.position);let r=this.getOverlapScore(),a=this.getSubtreeOverlapScore(e.id,t.common.id,r.vertexScores),s=this.getSubtreeOverlapScore(i.id,t.common.id,r.vertexScores),g=a.value+s.value;this.rotateSubtree(e.id,t.common.id,-2*n,t.common.position),this.rotateSubtree(i.id,t.common.id,2*n,t.common.position),r=this.getOverlapScore(),a=this.getSubtreeOverlapScore(e.id,t.common.id,r.vertexScores),s=this.getSubtreeOverlapScore(i.id,t.common.id,r.vertexScores),a.value+s.value>g&&(this.rotateSubtree(e.id,t.common.id,2*n,t.common.position),this.rotateSubtree(i.id,t.common.id,-2*n,t.common.position))}else 1!==t.vertices.length||2!==t.rings.length}}resolveSecondaryOverlaps(e){for(var t=0;t<e.length;t++)if(e[t].score>this.opts.overlapSensitivity){let i=this.graph.vertices[e[t].id];if(i.isTerminal()){let e=this.getClosestVertex(i);if(e){let t=null;t=e.isTerminal()?0===e.id?this.graph.vertices[1].position:e.previousPosition:0===e.id?this.graph.vertices[1].position:e.position;let n=0===i.id?this.graph.vertices[1].position:i.previousPosition;i.position.rotateAwayFrom(t,n,d.toRad(20))}}}}getLastVertexWithAngle(e){let t=0,i=null;for(;!t&&e;)i=this.graph.vertices[e],t=i.angle,e=i.parentVertexId;return i}createNextBond(e,t=null,n=0,r=!1,o=!1){if(e.positioned&&!o)return;let c=!1;if(t){let i=this.graph.getEdge(e.id,t.id);("/"===i.bondType||"\\"===i.bondType)&&1==++this.doubleBondConfigCount%2&&null===this.doubleBondConfig&&(this.doubleBondConfig=i.bondType,c=!0,null===t.parentVertexId&&e.value.branchBond&&("/"===this.doubleBondConfig?this.doubleBondConfig="\\":"\\"===this.doubleBondConfig&&(this.doubleBondConfig="/")))}if(!o)if(!t){let t=new h(this.opts.bondLength,0);t.rotate(d.toRad(-60)),e.previousPosition=t,e.setPosition(this.opts.bondLength,0),e.angle=d.toRad(-60),null===e.value.bridgedRing&&(e.positioned=!0)}else if(0<t.value.rings.length){let i=t.neighbours,n=null,r=new h(0,0);if(null===t.value.bridgedRing&&1<t.value.rings.length)for(var p=0;p<i.length;p++){let e=this.graph.vertices[i[p]];if(l.containsAll(e.value.rings,t.value.rings)){n=e;break}}if(null===n){for(var p=0;p<i.length;p++){let e=this.graph.vertices[i[p]];e.positioned&&this.areVerticesInSameRing(e,t)&&r.add(h.subtract(e.position,t.position))}r.invert().normalize().multiplyScalar(this.opts.bondLength).add(t.position)}else r=n.position.clone().rotateAround(Math.PI,t.position);e.previousPosition=t.position,e.setPositionFromVector(r),e.positioned=!0}else{let i=new h(this.opts.bondLength,0);i.rotate(n),i.add(t.position),e.setPositionFromVector(i),e.previousPosition=t.position,e.positioned=!0}if(null!==e.value.bridgedRing){let t=this.getRing(e.value.bridgedRing);if(!t.positioned){let i=h.subtract(e.previousPosition,e.position);i.invert(),i.normalize();let n=d.polyCircumradius(this.opts.bondLength,t.members.length);i.multiplyScalar(n),i.add(e.position),this.createRing(t,i,e)}}else if(0<e.value.rings.length){let t=this.getRing(e.value.rings[0]);if(!t.positioned){let i=h.subtract(e.previousPosition,e.position);i.invert(),i.normalize();let n=d.polyCircumradius(this.opts.bondLength,t.getSize());i.multiplyScalar(n),i.add(e.position),this.createRing(t,i,e)}}else{let i=e.value.isStereoCenter,n=e.getNeighbours(),o=[];for(var p=0;p<n.length;p++)this.graph.vertices[n[p]].value.isDrawn&&o.push(n[p]);t&&(o=l.remove(o,t.id));let u=e.getAngle();if(1===o.length){let i=this.graph.vertices[o[0]];if("#"===e.value.bondType||t&&"#"===t.value.bondType||"="===e.value.bondType&&t&&0===t.value.rings.length&&"="===t.value.bondType&&"-"!==e.value.branchBond){if(e.value.drawExplicit=!1,t){let i=this.graph.getEdge(e.id,t.id);i.center=!0}let n=this.graph.getEdge(e.id,i.id);n.center=!0,("#"===e.value.bondType||t&&"#"===t.value.bondType)&&(i.angle=0),i.drawExplicit=!0,this.createNextBond(i,e,u+i.angle)}else if(t&&0<t.value.rings.length){let t=d.toRad(60),n=-t,r=new h(this.opts.bondLength,0),o=new h(this.opts.bondLength,0);r.rotate(t).add(e.position),o.rotate(n).add(e.position);let a=this.getCurrentCenterOfMass(),s=r.distanceSq(a),g=o.distanceSq(a);i.angle=s<g?n:t,this.createNextBond(i,e,u+i.angle)}else{let n=e.angle;if(t&&3<t.neighbours.length)n=0<n?s(1.0472,n):0>n?g(-1.0472,n):1.0472;else if(!n){let t=this.getLastVertexWithAngle(e.id);n=t.angle,n||(n=1.0472)}if(t&&!c){let t=this.graph.getEdge(e.id,i.id).bondType;"/"===t?("/"===this.doubleBondConfig||"\\"===this.doubleBondConfig&&(n=-n),this.doubleBondConfig=null):"\\"===t&&("/"===this.doubleBondConfig?n=-n:"\\"===this.doubleBondConfig,this.doubleBondConfig=null)}i.angle=r?n:-n,this.createNextBond(i,e,u+i.angle)}}else if(2===o.length){let i=e.angle;i||(i=1.0472);let n=this.graph.getTreeDepth(o[0],e.id),a=this.graph.getTreeDepth(o[1],e.id),s=this.graph.vertices[o[0]],g=this.graph.vertices[o[1]];s.value.subtreeDepth=n,g.value.subtreeDepth=a;let r=this.graph.getTreeDepth(t?t.id:null,e.id);t&&(t.value.subtreeDepth=r);let d=0,l=1;"C"===g.value.element&&"C"!==s.value.element&&1<a&&5>n?(d=1,l=0):"C"!==g.value.element&&"C"===s.value.element&&1<n&&5>a?(d=0,l=1):a>n&&(d=1,l=0);let h=this.graph.vertices[o[d]],c=this.graph.vertices[o[l]],p=this.graph.getEdge(e.id,h.id),v=this.graph.getEdge(e.id,c.id),f=!1;r<n&&r<a&&(f=!0),c.angle=i,h.angle=-i,"\\"===this.doubleBondConfig?"\\"===c.value.branchBond&&(c.angle=-i,h.angle=i):"/"===this.doubleBondConfig&&"/"===c.value.branchBond&&(c.angle=-i,h.angle=i),this.createNextBond(c,e,u+c.angle,f),this.createNextBond(h,e,u+h.angle,f)}else if(3===o.length){let i=this.graph.getTreeDepth(o[0],e.id),n=this.graph.getTreeDepth(o[1],e.id),a=this.graph.getTreeDepth(o[2],e.id),g=this.graph.vertices[o[0]],s=this.graph.vertices[o[1]],l=this.graph.vertices[o[2]];g.value.subtreeDepth=i,s.value.subtreeDepth=n,l.value.subtreeDepth=a,n>i&&n>a?(g=this.graph.vertices[o[1]],s=this.graph.vertices[o[0]],l=this.graph.vertices[o[2]]):a>i&&a>n&&(g=this.graph.vertices[o[2]],s=this.graph.vertices[o[0]],l=this.graph.vertices[o[1]]),t&&1>t.value.rings.length&&1>g.value.rings.length&&1>s.value.rings.length&&1>l.value.rings.length&&1===this.graph.getTreeDepth(s.id,e.id)&&1===this.graph.getTreeDepth(l.id,e.id)&&1<this.graph.getTreeDepth(g.id,e.id)?(g.angle=-e.angle,0<=e.angle?(s.angle=d.toRad(30),l.angle=d.toRad(90)):(s.angle=-d.toRad(30),l.angle=-d.toRad(90)),this.createNextBond(g,e,u+g.angle),this.createNextBond(s,e,u+s.angle),this.createNextBond(l,e,u+l.angle)):(g.angle=0,s.angle=d.toRad(90),l.angle=-d.toRad(90),this.createNextBond(g,e,u+g.angle),this.createNextBond(s,e,u+s.angle),this.createNextBond(l,e,u+l.angle))}else if(4===o.length){let t=this.graph.getTreeDepth(o[0],e.id),i=this.graph.getTreeDepth(o[1],e.id),n=this.graph.getTreeDepth(o[2],e.id),r=this.graph.getTreeDepth(o[3],e.id),a=this.graph.vertices[o[0]],s=this.graph.vertices[o[1]],g=this.graph.vertices[o[2]],l=this.graph.vertices[o[3]];a.value.subtreeDepth=t,s.value.subtreeDepth=i,g.value.subtreeDepth=n,l.value.subtreeDepth=r,i>t&&i>n&&i>r?(a=this.graph.vertices[o[1]],s=this.graph.vertices[o[0]],g=this.graph.vertices[o[2]],l=this.graph.vertices[o[3]]):n>t&&n>i&&n>r?(a=this.graph.vertices[o[2]],s=this.graph.vertices[o[0]],g=this.graph.vertices[o[1]],l=this.graph.vertices[o[3]]):r>t&&r>i&&r>n&&(a=this.graph.vertices[o[3]],s=this.graph.vertices[o[0]],g=this.graph.vertices[o[1]],l=this.graph.vertices[o[2]]),a.angle=-d.toRad(36),s.angle=d.toRad(36),g.angle=-d.toRad(108),l.angle=d.toRad(108),this.createNextBond(a,e,u+a.angle),this.createNextBond(s,e,u+s.angle),this.createNextBond(g,e,u+g.angle),this.createNextBond(l,e,u+l.angle)}}}getCommonRingbondNeighbour(e){let t=e.neighbours;for(var n=0;n<t.length;n++){let i=this.graph.vertices[t[n]];if(l.containsAll(i.value.rings,e.value.rings))return i}return null}isPointInRing(e){for(var t=0;t<this.rings.length;t++){let i=this.rings[t];if(!i.positioned)continue;let n=d.polyCircumradius(this.opts.bondLength,i.getSize());if(e.distanceSq(i.center)<n*n)return!0}return!1}isEdgeInRing(e){let t=this.graph.vertices[e.sourceId],i=this.graph.vertices[e.targetId];return this.areVerticesInSameRing(t,i)}isEdgeRotatable(e){let t=this.graph.vertices[e.sourceId],i=this.graph.vertices[e.targetId];return!("-"!==e.bondType)&&!(t.isTerminal()||i.isTerminal())&&!(0<t.value.rings.length&&0<i.value.rings.length&&this.areVerticesInSameRing(t,i))}isRingAromatic(e){for(var t=0;t<e.members.length;t++){let i=this.graph.vertices[e.members[t]];if(!i.value.isPartOfAromaticRing)return!1}return!0}getEdgeNormals(e){let t=this.graph.vertices[e.sourceId].position,i=this.graph.vertices[e.targetId].position,n=h.units(t,i);return n}getNonRingNeighbours(e){let t=[],n=this.graph.vertices[e],r=n.neighbours;for(var o=0;o<r.length;o++){let e=this.graph.vertices[r[o]],i=l.intersection(n.value.rings,e.value.rings).length;0===i&&!1==e.value.isBridge&&t.push(e)}return t}annotateStereochemistry(){for(var e=0;e<this.graph.vertices.length;e++){let i=this.graph.vertices[e];if(!i.value.isStereoCenter)continue;let o=i.getNeighbours(),a=o.length,s=Array(a);for(var t=0;t<a;t++){let e=new Uint8Array(this.graph.vertices.length),r=[[]];e[i.id]=1,this.visitStereochemistry(o[t],i.id,e,r,10,0);for(var n=0;n<r.length;n++)r[n].sort(function(e,t){return t-e});s[t]=[t,r]}let g=0,l=0;for(var t=0;t<s.length;t++){s[t][1].length>g&&(g=s[t][1].length);for(var n=0;n<s[t][1].length;n++)s[t][1][n].length>l&&(l=s[t][1][n].length)}for(var t=0;t<s.length;t++){let e=g-s[t][1].length;for(var n=0;n<e;n++)s[t][1].push([]);s[t][1].push([o[t]]);for(var n=0;n<s[t][1].length;n++){let e=l-s[t][1][n].length;for(var r=0;r<e;r++)s[t][1][n].push(0)}}s.sort(function(e,t){for(var i=0;i<e[1].length;i++)for(var n=0;n<e[1][i].length;n++){if(e[1][i][n]>t[1][i][n])return-1;if(e[1][i][n]<t[1][i][n])return 1}return 0});let h=new Uint8Array(a);for(var t=0;t<a;t++)h[t]=s[t][0],i.value.priority=t;let c=this.graph.vertices[o[h[0]]].position,p=this.graph.vertices[o[h[1]]].position,u=this.graph.vertices[o[h[2]]].position,v=c.relativeClockwise(p,i.position),f=c.relativeClockwise(u,i.position),m=-1===v,b="@"===i.value.bracket.chirality?-1:1,x=1==d.parityOfPermutation(h)*b?"R":"S",y="down",S="up";(m&&"R"!==x||!m&&"S"!==x)&&(i.value.hydrogenDirection="up",y="up",S="down"),i.value.hasHydrogen&&(this.graph.getEdge(i.id,o[h[h.length-1]]).wedge=y);let C=Array(o.length-1),R=1<i.value.rings.length&&i.value.hasHydrogen,A=i.value.hasHydrogen?1:0;for(var t=0;t<h.length-A;t++){C[t]=new Uint32Array(2);let e=this.graph.vertices[o[h[t]]];C[t][0]+=e.value.isStereoCenter?0:1e5,C[t][0]+=this.areVerticesInSameRing(e,i)?0:1e4,C[t][0]+=e.value.isHeteroAtom()?1e3:0,C[t][0]-=0===e.value.subtreeDepth?1e3:0,C[t][0]+=1e3-e.value.subtreeDepth,C[t][1]=o[h[t]]}if(C.sort(function(e,t){return e[0]>t[0]?-1:e[0]<t[0]?1:0}),!R){let e=C[0][1];if(i.value.hasHydrogen)this.graph.getEdge(i.id,e).wedge=S;else{let n=S;for(var t=h.length-1;0<=t&&(n=n===y?S:y,o[h[t]]!==e);t--);this.graph.getEdge(i.id,e).wedge=n}}i.value.chirality=x}}visitStereochemistry(e,t,n,r,o,a,s=0){n[e]=1;let g=this.graph.vertices[e],d=g.value.getAtomicNumber();r.length<=a&&r.push([]);for(var l=0;l<this.graph.getEdge(e,t).weight;l++)r[a].push(1e3*s+d);let h=this.graph.vertices[e].neighbours;for(var l=0;l<h.length;l++)1!==n[h[l]]&&a<o-1&&this.visitStereochemistry(h[l],e,n.slice(),r,o,a+1,d);if(a<o-1){let t=0;for(var l=0;l<h.length;l++)t+=this.graph.getEdge(e,h[l]).weight;for(var l=0;l<g.value.getMaxBonds()-t;l++)r.length<=a+1&&r.push([]),r[a+1].push(1e3*d+1)}}initPseudoElements(){for(var e=0;e<this.graph.vertices.length;e++){const i=this.graph.vertices[e],n=i.neighbours;let r=Array(n.length);for(var t=0;t<n.length;t++)r[t]=this.graph.vertices[n[t]];if(3>i.getNeighbourCount()||0<i.value.rings.length)continue;if("P"===i.value.element)continue;if("C"===i.value.element&&3===r.length&&"N"===r[0].value.element&&"N"===r[1].value.element&&"N"===r[2].value.element)continue;let o=0,a=0;for(var t=0;t<r.length;t++){let e=r[t],i=e.value.element,n=e.getNeighbourCount();"C"!==i&&"H"!==i&&1===n&&o++,1<n&&a++}if(1<a||2>o)continue;let s=null;for(var t=0;t<r.length;t++){let e=r[t];1<e.getNeighbourCount()&&(s=e)}for(var t=0;t<r.length;t++){let e=r[t];if(1<e.getNeighbourCount())continue;e.value.isDrawn=!1;let n=v.maxBonds[e.value.element]-e.value.bondCount,o="";e.value.bracket&&(n=e.value.bracket.hcount,o=e.value.bracket.charge||0),i.value.attachPseudoElement(e.value.element,s?s.value.element:null,n,o)}}for(var e=0;e<this.graph.vertices.length;e++){const i=this.graph.vertices[e],n=i.value,r=n.element;if("C"===r||"H"===r||!n.isDrawn)continue;const o=i.neighbours;let a=Array(o.length);for(var t=0;t<o.length;t++)a[t]=this.graph.vertices[o[t]];for(var t=0;t<a.length;t++){let e=a[t].value;if(!e.hasAttachedPseudoElements||2!==e.getAttachedPseudoElementsCount())continue;const n=e.getAttachedPseudoElements();n.hasOwnProperty("0O")&&n.hasOwnProperty("3C")&&(e.isDrawn=!1,i.value.attachPseudoElement("Ac","",0))}}}}},{"./ArrayHelper":2,"./Atom":3,"./CanvasWrapper":4,"./Edge":6,"./Graph":7,"./Line":8,"./MathHelper":9,"./Ring":11,"./RingConnection":12,"./SSSR":13,"./Vector2":14,"./Vertex":15}],6:[function(e,t){"use strict";class i{constructor(e,t,i=1){this.id=null,this.sourceId=e,this.targetId=t,this.weight=i,this.bondType="-",this.isPartOfAromaticRing=!1,this.center=!1,this.wedge=""}setBondType(e){this.bondType=e,this.weight=i.bonds[e]}static get bonds(){return{"-":1,"/":1,"\\":1,"=":2,"#":3,$:4}}}t.exports=i},{}],7:[function(e,t){"use strict";var n=Math.pow,r=Math.sqrt,o=Math.min;const s=e("./MathHelper"),g=e("./Vector2"),d=e("./Vertex"),l=e("./Edge"),h=e("./Ring"),c=e("./Atom");class p{constructor(e,t=!1){this.vertices=[],this.edges=[],this.vertexIdsToEdgeId={},this.isomeric=t,this._time=0,this._init(e)}_init(e,t=0,n=null,r=!1){let o=new c(e.atom.element?e.atom.element:e.atom,e.bond);o.branchBond=e.branchBond,o.ringbonds=e.ringbonds,o.bracket=e.atom.element?e.atom:null;let a=new d(o),s=this.vertices[n];if(this.addVertex(a),null!==n){a.setParentVertexId(n),a.value.addNeighbouringElement(s.value.element),s.addChild(a.id),s.value.addNeighbouringElement(o.element),s.spanningTreeChildren.push(a.id);let e=new l(n,a.id,1),t=null;r?(e.setBondType(a.value.branchBond||"-"),t=a.id,e.setBondType(a.value.branchBond||"-"),t=a.id):(e.setBondType(s.value.bondType||"-"),t=s.id);this.addEdge(e)}let g=e.ringbondCount+1;o.bracket&&(g+=o.bracket.hcount);let h=0;if(o.bracket&&o.bracket.chirality){o.isStereoCenter=!0,h=o.bracket.hcount;for(var p=0;p<h;p++)this._init({atom:"H",isBracket:"false",branches:[],branchCount:0,ringbonds:[],ringbondCount:!1,next:null,hasNext:!1,bond:"-"},p,a.id,!0)}for(var p=0;p<e.branchCount;p++)this._init(e.branches[p],p+g,a.id,!0);e.hasNext&&this._init(e.next,e.branchCount+g,a.id)}clear(){this.vertices=[],this.edges=[],this.vertexIdsToEdgeId={}}addVertex(e){return e.id=this.vertices.length,this.vertices.push(e),e.id}addEdge(e){let t=this.vertices[e.sourceId],i=this.vertices[e.targetId];return e.id=this.edges.length,this.edges.push(e),this.vertexIdsToEdgeId[e.sourceId+"_"+e.targetId]=e.id,this.vertexIdsToEdgeId[e.targetId+"_"+e.sourceId]=e.id,e.isPartOfAromaticRing=t.value.isPartOfAromaticRing&&i.value.isPartOfAromaticRing,t.value.bondCount+=e.weight,i.value.bondCount+=e.weight,t.edges.push(e.id),i.edges.push(e.id),e.id}getEdge(e,t){let i=this.vertexIdsToEdgeId[e+"_"+t];return i===void 0?null:this.edges[i]}getEdges(e){let t=[],n=this.vertices[e];for(var r=0;r<n.neighbours.length;r++)t.push(this.vertexIdsToEdgeId[e+"_"+n.neighbours[r]]);return t}hasEdge(e,t){return this.vertexIdsToEdgeId[e+"_"+t]!==void 0}getVertexList(){let e=[this.vertices.length];for(var t=0;t<this.vertices.length;t++)e[t]=this.vertices[t].id;return e}getEdgeList(){let e=Array(this.edges.length);for(var t=0;t<this.edges.length;t++)e[t]=[this.edges[t].sourceId,this.edges[t].targetId];return e}getAdjacencyMatrix(){let e=this.vertices.length,t=Array(e);for(var n=0;n<e;n++)t[n]=Array(e),t[n].fill(0);for(var n=0;n<this.edges.length;n++){let e=this.edges[n];t[e.sourceId][e.targetId]=1,t[e.targetId][e.sourceId]=1}return t}getComponentsAdjacencyMatrix(){let e=this.vertices.length,t=Array(e),n=this.getBridges();for(var r=0;r<e;r++)t[r]=Array(e),t[r].fill(0);for(var r=0;r<this.edges.length;r++){let e=this.edges[r];t[e.sourceId][e.targetId]=1,t[e.targetId][e.sourceId]=1}for(var r=0;r<n.length;r++)t[n[r][0]][n[r][1]]=0,t[n[r][1]][n[r][0]]=0;return t}getSubgraphAdjacencyMatrix(e){let t=e.length,n=Array(t);for(var r=0;r<t;r++){n[r]=Array(t),n[r].fill(0);for(var o=0;o<t;o++)r!=o&&this.hasEdge(e[r],e[o])&&(n[r][o]=1)}return n}getDistanceMatrix(){let e=this.vertices.length,t=this.getAdjacencyMatrix(),n=Array(e);for(var r=0;r<e;r++)n[r]=Array(e),n[r].fill(1/0);for(var r=0;r<e;r++)for(var o=0;o<e;o++)1===t[r][o]&&(n[r][o]=1);for(var a=0;a<e;a++)for(var r=0;r<e;r++)for(var o=0;o<e;o++)n[r][o]>n[r][a]+n[a][o]&&(n[r][o]=n[r][a]+n[a][o]);return n}getSubgraphDistanceMatrix(e){let t=e.length,n=this.getSubgraphAdjacencyMatrix(e),r=Array(t);for(var o=0;o<t;o++)r[o]=Array(t),r[o].fill(1/0);for(var o=0;o<t;o++)for(var a=0;a<t;a++)1===n[o][a]&&(r[o][a]=1);for(var s=0;s<t;s++)for(var o=0;o<t;o++)for(var a=0;a<t;a++)r[o][a]>r[o][s]+r[s][a]&&(r[o][a]=r[o][s]+r[s][a]);return r}getAdjacencyList(){let e=this.vertices.length,t=Array(e);for(var n=0;n<e;n++){t[n]=[];for(var r=0;r<e;r++)n!=r&&this.hasEdge(this.vertices[n].id,this.vertices[r].id)&&t[n].push(r)}return t}getSubgraphAdjacencyList(e){let t=e.length,n=Array(t);for(var r=0;r<t;r++){n[r]=[];for(var o=0;o<t;o++)r!=o&&this.hasEdge(e[r],e[o])&&n[r].push(o)}return n}getBridges(){let e=this.vertices.length,t=Array(e),n=Array(e),r=Array(e),o=Array(e),a=this.getAdjacencyList(),s=[];t.fill(!1),o.fill(null),this._time=0;for(var g=0;g<e;g++)t[g]||this._bridgeDfs(g,t,n,r,o,a,s);return s}traverseBF(e,t){let n=this.vertices.length,r=Array(n);r.fill(!1);for(var o=[e];0<o.length;){let e=o.shift(),i=this.vertices[e];t(i);for(var a=0;a<i.neighbours.length;a++){let e=i.neighbours[a];r[e]||(r[e]=!0,o.push(e))}}}getTreeDepth(e,t){if(null===e||null===t)return 0;let n=this.vertices[e].getSpanningTreeNeighbours(t),r=0;for(var o=0;o<n.length;o++){let t=n[o],i=this.getTreeDepth(t,e);i>r&&(r=i)}return r+1}traverseTree(e,t,n,r=g,o=!1,a=1,s=null){var g=Number.MAX_SAFE_INTEGER;if(null===s&&(s=new Uint8Array(this.vertices.length)),a>r+1||1===s[e])return;s[e]=1;let d=this.vertices[e],l=d.getNeighbours(t);(!o||1<a)&&n(d);for(var h=0;h<l.length;h++)this.traverseTree(l[h],e,n,r,o,a+1,s)}kkLayout(e,t,o,g,d){for(var h=e.length;h--;){let t=this.vertices[e[h]];var l=t.neighbours.length}let c=this.getSubgraphDistanceMatrix(e),p=e.length,u=s.polyCircumradius(500,p),v=s.centralAngle(p),f=0,b=new Float32Array(p),x=new Float32Array(p),y=Array(p);for(h=p;h--;){let i=this.vertices[e[h]];i.positioned?(b[h]=i.position.x,x[h]=i.position.y):(b[h]=t.x+Math.cos(f)*u,x[h]=t.y+Math.sin(f)*u),y[h]=i.positioned,f+=v}let S=Array(p);for(h=p;h--;){S[h]=Array(p);for(var l=p;l--;)S[h][l]=d*c[h][l]}let C=Array(p);for(h=p;h--;){C[h]=Array(p);for(var l=p;l--;)C[h][l]=d*n(c[h][l],-2)}let R=Array(p),A=new Float32Array(p),T=new Float32Array(p);for(h=p;h--;)R[h]=Array(p);h=p;for(let i,n,a,s,l,c,u;h--;){i=b[h],n=x[h],a=0,s=0;for(let e=p;e--;)h!==e&&(l=b[e],c=x[e],u=1/r((i-l)*(i-l)+(n-c)*(n-c)),R[h][e]=[C[h][e]*(i-l-S[h][e]*(i-l)*u),C[h][e]*(n-c-S[h][e]*(n-c)*u)],R[e][h]=R[h][e],a+=R[h][e][0],s+=R[h][e][1]);A[h]=a,T[h]=s}let I=function(e){return[A[e]*A[e]+T[e]*T[e],A[e],T[e]]},B=function(){let e=0,t=0,i=0,n=0;for(h=p;h--;){let[r,o,a]=I(h);r>e&&!1===y[h]&&(e=r,t=h,i=o,n=a)}return[t,e,i,n]},k=function(e,t,i){let o=0,a=0,s=0,g=b[e],d=x[e],c=S[e],u=C[e];for(h=p;h--;){if(h===e)continue;let t=b[h],i=x[h],r=c[h],l=u[h],p=(g-t)*(g-t),v=1/n(p+(d-i)*(d-i),1.5);o+=l*(1-r*(d-i)*(d-i)*v),a+=l*(1-r*p*v),s+=l*(r*(g-t)*(d-i)*v)}0==o&&(o=.1),0===a&&(a=.1),0===s&&(s=.1);let v=t/o+i/s;v/=s/o-a/s;let l=-(s*v+t)/o;b[e]+=l,x[e]+=v;let f=R[e];t=0,i=0,g=b[e],d=x[e];let m,y,j,I,B;for(h=p;h--;)e!==h&&(m=b[h],y=x[h],j=f[h][0],I=f[h][1],B=1/r((g-m)*(g-m)+(d-y)*(d-y)),l=u[h]*(g-m-c[h]*(g-m)*B),v=u[h]*(d-y-c[h]*(d-y)*B),f[h]=[l,v],t+=l,i+=v,A[h]+=l-j,T[h]+=v-I);A[e]=t,T[e]=i},w=1e9,P=0,L=0,E=0,O=0,H=0,D=0;for(;w>.1&&2e3>H;)for(H++,[P,w,L,E]=B(),O=w,D=0;O>.1&&50>D;)D++,k(P,L,E),[O,L,E]=I(P);for(h=p;h--;){let t=e[h],i=this.vertices[t];i.position.x=b[h],i.position.y=x[h],i.positioned=!0,i.forcePositioned=!0}}_bridgeDfs(e,t,n,r,a,s,g){t[e]=!0,n[e]=r[e]=++this._time;for(var d=0;d<s[e].length;d++){let i=s[e][d];t[i]?i!==a[e]&&(r[e]=o(r[e],n[i])):(a[i]=e,this._bridgeDfs(i,t,n,r,a,s,g),r[e]=o(r[e],r[i]),r[i]>n[e]&&g.push([e,i]))}}static getConnectedComponents(e){let t=e.length,i=Array(t),n=[],r=0;i.fill(!1);for(var o=0;o<t;o++)if(!i[o]){let t=[];i[o]=!0,t.push(o),r++,p._ccGetDfs(o,i,e,t),1<t.length&&n.push(t)}return n}static getConnectedComponentCount(e){let t=e.length,i=Array(t),n=0;i.fill(!1);for(var r=0;r<t;r++)i[r]||(i[r]=!0,n++,p._ccCountDfs(r,i,e));return n}static _ccCountDfs(e,t,i){for(var n=0;n<i[e].length;n++){let r=i[e][n];r&&!t[n]&&e!==n&&(t[n]=!0,p._ccCountDfs(n,t,i))}}static _ccGetDfs(e,t,i,n){for(var r=0;r<i[e].length;r++){let o=i[e][r];o&&!t[r]&&e!==r&&(t[r]=!0,n.push(r),p._ccGetDfs(r,t,i,n))}}}t.exports=p},{"./Atom":3,"./Edge":6,"./MathHelper":9,"./Ring":11,"./Vector2":14,"./Vertex":15}],8:[function(e,t){"use strict";var i=Math.pow,n=Math.sin,o=Math.cos;const a=e("./Vector2");class s{constructor(e=new a(0,0),t=new a(0,0),i=null,n=null,r=!1,o=!1){this.from=e,this.to=t,this.elementFrom=i,this.elementTo=n,this.chiralFrom=r,this.chiralTo=o}clone(){return new s(this.from.clone(),this.to.clone(),this.elementFrom,this.elementTo)}getLength(){return Math.sqrt(i(this.to.x-this.from.x,2)+i(this.to.y-this.from.y,2))}getAngle(){let e=a.subtract(this.getRightVector(),this.getLeftVector());return e.angle()}getRightVector(){return this.from.x<this.to.x?this.to:this.from}getLeftVector(){return this.from.x<this.to.x?this.from:this.to}getRightElement(){return this.from.x<this.to.x?this.elementTo:this.elementFrom}getLeftElement(){return this.from.x<this.to.x?this.elementFrom:this.elementTo}getRightChiral(){return this.from.x<this.to.x?this.chiralTo:this.chiralFrom}getLeftChiral(){return this.from.x<this.to.x?this.chiralFrom:this.chiralTo}setRightVector(e,t){return this.from.x<this.to.x?(this.to.x=e,this.to.y=t):(this.from.x=e,this.from.y=t),this}setLeftVector(e,t){return this.from.x<this.to.x?(this.from.x=e,this.from.y=t):(this.to.x=e,this.to.y=t),this}rotateToXAxis(){let e=this.getLeftVector();return this.setRightVector(e.x+this.getLength(),e.y),this}rotate(e){let t=this.getLeftVector(),i=this.getRightVector(),r=n(e),a=o(e),s=a*(i.x-t.x)-r*(i.y-t.y)+t.x,g=r*(i.x-t.x)-a*(i.y-t.y)+t.y;return this.setRightVector(s,g),this}shortenFrom(e){let t=a.subtract(this.to,this.from);return t.normalize(),t.multiplyScalar(e),this.from.add(t),this}shortenTo(e){let t=a.subtract(this.from,this.to);return t.normalize(),t.multiplyScalar(e),this.to.add(t),this}shortenRight(e){return this.from.x<this.to.x?this.shortenTo(e):this.shortenFrom(e),this}shortenLeft(e){return this.from.x<this.to.x?this.shortenFrom(e):this.shortenTo(e),this}shorten(e){let t=a.subtract(this.from,this.to);return t.normalize(),t.multiplyScalar(e/2),this.to.add(t),this.from.subtract(t),this}}t.exports=s},{"./Vector2":14}],9:[function(e,t){"use strict";var i=Math.round,r=Math.sin,o=Math.cos,a=Math.PI;class g{static round(e,t){return t=t?t:1,+(i(e+"e"+t)+"e-"+t)}static meanAngle(e){let t=0,n=0;for(var a=0;a<e.length;a++)t+=r(e[a]),n+=o(e[a]);return Math.atan2(t/e.length,n/e.length)}static innerAngle(e){return g.toRad(180*(e-2)/e)}static polyCircumradius(e,t){return e/(2*r(a/t))}static apothem(e,t){return e*o(a/t)}static apothemFromSideLength(e,t){let i=g.polyCircumradius(e,t);return g.apothem(i,t)}static centralAngle(e){return g.toRad(360/e)}static toDeg(e){return e*g.degFactor}static toRad(e){return e*g.radFactor}static parityOfPermutation(e){let t=new Uint8Array(e.length),n=0,r=function(n,i=0){return 1===t[n]?i:(i++,t[n]=1,r(e[n],i))};for(var o=0;o<e.length;o++){if(1===t[o])continue;let e=r(o);n+=1-e%2}return n%2?-1:1}static get radFactor(){return a/180}static get degFactor(){return 180/a}static get twoPI(){return 2*a}}t.exports=g},{}],10:[function(e,t){"use strict";t.exports=function(){function e(t,i,n,r){this.message=t,this.expected=i,this.found=n,this.location=r,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}function t(t,i){function n(e,t){return{type:"literal",text:e,ignoreCase:t}}function r(e,t,i){return{type:"class",parts:e,inverted:t,ignoreCase:i}}function o(e){var i,n=Ne[e];if(n)return n;for(i=e-1;!Ne[i];)i--;for(n=Ne[i],n={line:n.line,column:n.column};i<e;)10===t.charCodeAt(i)?(n.line++,n.column=1):n.column++,i++;return Ne[e]=n,n}function a(e,t){var i=o(e),n=o(t);return{start:{offset:e,line:i.line,column:i.column},end:{offset:t,line:n.line,column:n.column}}}function s(e){He<Ve||(He>Ve&&(Ve=He,ze=[]),ze.push(e))}function g(){var e,t,i,n,r,o,a,s,c,p;if(e=He,t=He,i=l(),i!==B){for(n=[],r=d();r!==B;)n.push(r),r=d();if(n!==B){for(r=[],o=He,a=h(),a===B&&(a=null),a===B?(He=o,o=B):(s=m(),s===B?(He=o,o=B):(a=[a,s],o=a));o!==B;)r.push(o),o=He,a=h(),a===B&&(a=null),a===B?(He=o,o=B):(s=m(),s===B?(He=o,o=B):(a=[a,s],o=a));if(r!==B){for(o=[],a=d();a!==B;)o.push(a),a=d();if(o===B)He=t,t=B;else if(a=h(),a===B&&(a=null),a===B)He=t,t=B;else if(s=g(),s===B&&(s=null),s!==B){for(c=[],p=d();p!==B;)c.push(p),p=d();c===B?(He=t,t=B):(i=[i,n,r,o,a,s,c],t=i)}else He=t,t=B}else He=t,t=B}else He=t,t=B}else He=t,t=B;return t!==B&&(De=e,t=P(t)),e=t,e}function d(){var e,i,n,r,o,a;return e=He,i=He,40===t.charCodeAt(He)?(n="(",He++):(n=B,s(L)),n===B?(He=i,i=B):(r=h(),r===B&&(r=null),r===B?(He=i,i=B):(o=g(),o===B?(He=i,i=B):(41===t.charCodeAt(He)?(a=")",He++):(a=B,s(E)),a===B?(He=i,i=B):(n=[n,r,o,a],i=n)))),i!==B&&(De=e,i=O(i)),e=i,e}function l(){var e,t;return e=He,t=p(),t===B&&(t=u(),t===B&&(t=c(),t===B&&(t=v()))),t!==B&&(De=e,t=H(t)),e=t,e}function h(){var e,i;return e=He,D.test(t.charAt(He))?(i=t.charAt(He),He++):(i=B,s(N)),i!==B&&(De=e,i=V(i)),e=i,e}function c(){var e,i,n,r,o,a,g,d,l,h;return e=He,i=He,91===t.charCodeAt(He)?(n="[",He++):(n=B,s(z)),n===B?(He=i,i=B):(r=A(),r===B&&(r=null),r===B?(He=i,i=B):("se"===t.substr(He,2)?(o="se",He+=2):(o=B,s(W)),o===B&&("as"===t.substr(He,2)?(o="as",He+=2):(o=B,s(F)),o===B&&(o=u(),o===B&&(o=f(),o===B&&(o=v())))),o===B?(He=i,i=B):(a=b(),a===B&&(a=null),a===B?(He=i,i=B):(g=C(),g===B&&(g=null),g===B?(He=i,i=B):(d=x(),d===B&&(d=null),d===B?(He=i,i=B):(l=R(),l===B&&(l=null),l===B?(He=i,i=B):(93===t.charCodeAt(He)?(h="]",He++):(h=B,s(M)),h===B?(He=i,i=B):(n=[n,r,o,a,g,d,l,h],i=n)))))))),i!==B&&(De=e,i=q(i)),e=i,e}function p(){var e,i,n,r;return e=He,i=He,66===t.charCodeAt(He)?(n="B",He++):(n=B,s(_)),n===B?(He=i,i=B):(114===t.charCodeAt(He)?(r="r",He++):(r=B,s(U)),r===B&&(r=null),r===B?(He=i,i=B):(n=[n,r],i=n)),i===B&&(i=He,67===t.charCodeAt(He)?(n="C",He++):(n=B,s(G)),n===B?(He=i,i=B):(108===t.charCodeAt(He)?(r="l",He++):(r=B,s(X)),r===B&&(r=null),r===B?(He=i,i=B):(n=[n,r],i=n)),i===B&&(Y.test(t.charAt(He))?(i=t.charAt(He),He++):(i=B,s(K)))),i!==B&&(De=e,i=Z(i)),e=i,e}function u(){var e,i;return e=He,$.test(t.charAt(He))?(i=t.charAt(He),He++):(i=B,s(J)),i!==B&&(De=e,i=H(i)),e=i,e}function v(){var e,i;return e=He,42===t.charCodeAt(He)?(i="*",He++):(i=B,s(Q)),i!==B&&(De=e,i=ee(i)),e=i,e}function f(){var e,i,n,r;return e=He,i=He,te.test(t.charAt(He))?(n=t.charAt(He),He++):(n=B,s(ie)),n===B?(He=i,i=B):(ne.test(t.charAt(He))?(r=t.charAt(He),He++):(r=B,s(re)),r===B&&(r=null),r===B?(He=i,i=B):(n=[n,r],i=n)),i!==B&&(De=e,i=oe(i)),e=i,e}function m(){var e,i,n,r,o;return e=He,i=He,37===t.charCodeAt(He)?(n="%",He++):(n=B,s(ae)),n===B?(He=i,i=B):(se.test(t.charAt(He))?(r=t.charAt(He),He++):(r=B,s(ge)),r===B?(He=i,i=B):(de.test(t.charAt(He))?(o=t.charAt(He),He++):(o=B,s(le)),o===B?(He=i,i=B):(n=[n,r,o],i=n))),i===B&&(de.test(t.charAt(He))?(i=t.charAt(He),He++):(i=B,s(le))),i!==B&&(De=e,i=he(i)),e=i,e}function b(){var e,i,n,r,o,a,g;return e=He,i=He,64===t.charCodeAt(He)?(n="@",He++):(n=B,s(ce)),n===B?(He=i,i=B):(64===t.charCodeAt(He)?(r="@",He++):(r=B,s(ce)),r===B&&(r=He,"TH"===t.substr(He,2)?(o="TH",He+=2):(o=B,s(pe)),o===B?(He=r,r=B):(ue.test(t.charAt(He))?(a=t.charAt(He),He++):(a=B,s(ve)),a===B?(He=r,r=B):(o=[o,a],r=o)),r===B&&(r=He,"AL"===t.substr(He,2)?(o="AL",He+=2):(o=B,s(fe)),o===B?(He=r,r=B):(ue.test(t.charAt(He))?(a=t.charAt(He),He++):(a=B,s(ve)),a===B?(He=r,r=B):(o=[o,a],r=o)),r===B&&(r=He,"SP"===t.substr(He,2)?(o="SP",He+=2):(o=B,s(me)),o===B?(He=r,r=B):(be.test(t.charAt(He))?(a=t.charAt(He),He++):(a=B,s(xe)),a===B?(He=r,r=B):(o=[o,a],r=o)),r===B&&(r=He,"TB"===t.substr(He,2)?(o="TB",He+=2):(o=B,s(ye)),o===B?(He=r,r=B):(se.test(t.charAt(He))?(a=t.charAt(He),He++):(a=B,s(ge)),a===B?(He=r,r=B):(de.test(t.charAt(He))?(g=t.charAt(He),He++):(g=B,s(le)),g===B&&(g=null),g===B?(He=r,r=B):(o=[o,a,g],r=o))),r===B&&(r=He,"OH"===t.substr(He,2)?(o="OH",He+=2):(o=B,s(Se)),o===B?(He=r,r=B):(se.test(t.charAt(He))?(a=t.charAt(He),He++):(a=B,s(ge)),a===B?(He=r,r=B):(de.test(t.charAt(He))?(g=t.charAt(He),He++):(g=B,s(le)),g===B&&(g=null),g===B?(He=r,r=B):(o=[o,a,g],r=o)))))))),r===B&&(r=null),r===B?(He=i,i=B):(n=[n,r],i=n)),i!==B&&(De=e,i=Ce(i)),e=i,e}function x(){var e,t;return e=He,t=y(),t===B&&(t=S()),t!==B&&(De=e,t=Re(t)),e=t,e}function y(){var e,i,n,r,o,a;return e=He,i=He,43===t.charCodeAt(He)?(n="+",He++):(n=B,s(Ae)),n===B?(He=i,i=B):(43===t.charCodeAt(He)?(r="+",He++):(r=B,s(Ae)),r===B&&(r=He,se.test(t.charAt(He))?(o=t.charAt(He),He++):(o=B,s(ge)),o===B?(He=r,r=B):(de.test(t.charAt(He))?(a=t.charAt(He),He++):(a=B,s(le)),a===B&&(a=null),a===B?(He=r,r=B):(o=[o,a],r=o))),r===B&&(r=null),r===B?(He=i,i=B):(n=[n,r],i=n)),i!==B&&(De=e,i=je(i)),e=i,e}function S(){var e,i,n,r,o,a;return e=He,i=He,45===t.charCodeAt(He)?(n="-",He++):(n=B,s(Te)),n===B?(He=i,i=B):(45===t.charCodeAt(He)?(r="-",He++):(r=B,s(Te)),r===B&&(r=He,se.test(t.charAt(He))?(o=t.charAt(He),He++):(o=B,s(ge)),o===B?(He=r,r=B):(de.test(t.charAt(He))?(a=t.charAt(He),He++):(a=B,s(le)),a===B&&(a=null),a===B?(He=r,r=B):(o=[o,a],r=o))),r===B&&(r=null),r===B?(He=i,i=B):(n=[n,r],i=n)),i!==B&&(De=e,i=Ie(i)),e=i,e}function C(){var e,i,n,r;return e=He,i=He,72===t.charCodeAt(He)?(n="H",He++):(n=B,s(Be)),n===B?(He=i,i=B):(de.test(t.charAt(He))?(r=t.charAt(He),He++):(r=B,s(le)),r===B&&(r=null),r===B?(He=i,i=B):(n=[n,r],i=n)),i!==B&&(De=e,i=ke(i)),e=i,e}function R(){var e,i,n,r,o,a,g;if(e=He,i=He,58===t.charCodeAt(He)?(n=":",He++):(n=B,s(we)),n!==B){if(r=He,se.test(t.charAt(He))?(o=t.charAt(He),He++):(o=B,s(ge)),o!==B){for(a=[],de.test(t.charAt(He))?(g=t.charAt(He),He++):(g=B,s(le));g!==B;)a.push(g),de.test(t.charAt(He))?(g=t.charAt(He),He++):(g=B,s(le));a===B?(He=r,r=B):(o=[o,a],r=o)}else He=r,r=B;r===B&&(Pe.test(t.charAt(He))?(r=t.charAt(He),He++):(r=B,s(Le))),r===B?(He=i,i=B):(n=[n,r],i=n)}else He=i,i=B;return i!==B&&(De=e,i=Ee(i)),e=i,e}function A(){var e,i,n,r,o;return e=He,i=He,se.test(t.charAt(He))?(n=t.charAt(He),He++):(n=B,s(ge)),n===B?(He=i,i=B):(de.test(t.charAt(He))?(r=t.charAt(He),He++):(r=B,s(le)),r===B&&(r=null),r===B?(He=i,i=B):(de.test(t.charAt(He))?(o=t.charAt(He),He++):(o=B,s(le)),o===B&&(o=null),o===B?(He=i,i=B):(n=[n,r,o],i=n))),i!==B&&(De=e,i=Oe(i)),e=i,e}i=void 0===i?{}:i;var j=t.split("(").length-1,T=t.split(")").length-1;if(j!==T)throw function(t,i){return new e(t,null,null,i)}("The number of opening parentheses does not match the number of closing parentheses.",0);var I,B={},k={chain:g},w=g,P=function(e){for(var t=[],n=[],r=0;r<e[1].length;r++)t.push(e[1][r]);for(var o,r=0;r<e[2].length;r++)o=e[2][r][0]?e[2][r][0]:"-",n.push({bond:o,id:e[2][r][1]});for(var r=0;r<e[3].length;r++)t.push(e[3][r]);for(var r=0;r<e[6].length;r++)t.push(e[6][r]);return{atom:e[0],isBracket:!!e[0].element,branches:t,branchCount:t.length,ringbonds:n,ringbondCount:n.length,bond:e[4]?e[4]:"-",next:e[5],hasNext:!!e[5]}},L=n("(",!1),E=n(")",!1),O=function(e){var t=e[1]?e[1]:"-";return e[2].branchBond=t,e[2]},H=function(e){return e},D=/^[\-=#$:\/\\.]/,N=r(["-","=","#","$",":","/","\\","."],!1,!1),V=function(e){return e},z=n("[",!1),W=n("se",!1),F=n("as",!1),M=n("]",!1),q=function(e){return{isotope:e[1],element:e[2],chirality:e[3],hcount:e[4],charge:e[5],class:e[6]}},_=n("B",!1),U=n("r",!1),G=n("C",!1),X=n("l",!1),Y=/^[NOPSFI]/,K=r(["N","O","P","S","F","I"],!1,!1),Z=function(e){return 1<e.length?e.join(""):e},$=/^[bcnops]/,J=r(["b","c","n","o","p","s"],!1,!1),Q=n("*",!1),ee=function(e){return e},te=/^[A-Z]/,ie=r([["A","Z"]],!1,!1),ne=/^[a-z]/,re=r([["a","z"]],!1,!1),oe=function(t){return t.join("")},ae=n("%",!1),se=/^[1-9]/,ge=r([["1","9"]],!1,!1),de=/^[0-9]/,le=r([["0","9"]],!1,!1),he=function(e){return 1==e.length?+e:+e.join("").replace("%","")},ce=n("@",!1),pe=n("TH",!1),ue=/^[12]/,ve=r(["1","2"],!1,!1),fe=n("AL",!1),me=n("SP",!1),be=/^[1-3]/,xe=r([["1","3"]],!1,!1),ye=n("TB",!1),Se=n("OH",!1),Ce=function(e){return e[1]?"@"==e[1]?"@@":e[1].join("").replace(",",""):"@"},Re=function(e){return e},Ae=n("+",!1),je=function(e){return e[1]?"+"==e[1]?2:+e[1].join(""):1},Te=n("-",!1),Ie=function(e){return e[1]?"-"==e[1]?-2:-+e[1].join(""):-1},Be=n("H",!1),ke=function(e){return e[1]?+e[1]:1},we=n(":",!1),Pe=/^[0]/,Le=r(["0"],!1,!1),Ee=function(e){return+(e[1][0]+e[1][1].join(""))},Oe=function(e){return+e.join("")},He=0,De=0,Ne=[{line:1,column:1}],Ve=0,ze=[];if("startRule"in i){if(!(i.startRule in k))throw new Error("Can't start parsing from rule \""+i.startRule+"\".");w=k[i.startRule]}if(I=w(),I!==B&&He===t.length)return I;throw I!==B&&He<t.length&&s(function(){return{type:"end"}}()),function(t,i,n){return new e(e.buildMessage(t,i),t,i,n)}(ze,Ve<t.length?t.charAt(Ve):null,Ve<t.length?a(Ve,Ve+1):a(Ve,Ve))}return function(e,t){function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i}(e,Error),e.buildMessage=function(e,t){function i(e){return e.charCodeAt(0).toString(16).toUpperCase()}function n(e){return e.replace(/\\/g,"\\\\").replace(/"/g,"\\\"").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+i(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+i(e)})}function r(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+i(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+i(e)})}function o(e){return a[e.type](e)}var a={literal:function(e){return"\""+n(e.text)+"\""},class:function(e){var t,n="";for(t=0;t<e.parts.length;t++)n+=e.parts[t]instanceof Array?r(e.parts[t][0])+"-"+r(e.parts[t][1]):r(e.parts[t]);return"["+(e.inverted?"^":"")+n+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(e){return e.description}};return"Expected "+function(e){var t,n,r=Array(e.length);for(t=0;t<e.length;t++)r[t]=o(e[t]);if(r.sort(),0<r.length){for(t=1,n=1;t<r.length;t++)r[t-1]!==r[t]&&(r[n]=r[t],n++);r.length=n}switch(r.length){case 1:return r[0];case 2:return r[0]+" or "+r[1];default:return r.slice(0,-1).join(", ")+", or "+r[r.length-1];}}(e)+" but "+function(e){return e?"\""+n(e)+"\"":"end of input"}(t)+" found."},{SyntaxError:e,parse:t}}()},{}],11:[function(e,t){"use strict";const i=e("./ArrayHelper"),n=e("./Vector2"),r=e("./Vertex"),o=e("./RingConnection");class a{constructor(e){this.id=null,this.members=e,this.edges=[],this.insiders=[],this.neighbours=[],this.positioned=!1,this.center=new n(0,0),this.rings=[],this.isBridged=!1,this.isPartOfBridged=!1,this.isSpiro=!1,this.isFused=!1,this.centralAngle=0,this.canFlip=!0}clone(){let e=new a(this.members);return e.id=this.id,e.insiders=i.clone(this.insiders),e.neighbours=i.clone(this.neighbours),e.positioned=this.positioned,e.center=this.center.clone(),e.rings=i.clone(this.rings),e.isBridged=this.isBridged,e.isPartOfBridged=this.isPartOfBridged,e.isSpiro=this.isSpiro,e.isFused=this.isFused,e.centralAngle=this.centralAngle,e.canFlip=this.canFlip,e}getSize(){return this.members.length}getPolygon(e){let t=[];for(let n=0;n<this.members.length;n++)t.push(e[this.members[n]].position);return t}getAngle(){return Math.PI-this.centralAngle}eachMember(e,t,i,n){i=i||0===i?i:this.members[0];let r=i,o=0;for(;null!=r&&100>o;){let a=r;t(a),r=e[r].getNextInRing(e,this.id,n),n=a,r==i&&(r=null),o++}}getOrderedNeighbours(e){let t=Array(this.neighbours.length);for(let n,r=0;r<this.neighbours.length;r++)n=o.getVertices(e,this.id,this.neighbours[r]),t[r]={n:n.length,neighbour:this.neighbours[r]};return t.sort(function(e,t){return t.n-e.n}),t}isBenzeneLike(e){let t=this.getDoubleBondCount(e),i=this.members.length;return 3===t&&6===i||2===t&&5===i}getDoubleBondCount(e){let t=0;for(let n,r=0;r<this.members.length;r++)n=e[this.members[r]].value,("="===n.bondType||"="===n.branchBond)&&t++;return t}contains(e){for(let t=0;t<this.members.length;t++)if(this.members[t]==e)return!0;return!1}}t.exports=a},{"./ArrayHelper":2,"./RingConnection":12,"./Vector2":14,"./Vertex":15}],12:[function(e,t){"use strict";const i=e("./Vertex"),n=e("./Ring");t.exports=class{constructor(e,t){this.id=null,this.firstRingId=e.id,this.secondRingId=t.id,this.vertices=new Set;for(var i=0;i<e.members.length;i++){let r=e.members[i];for(let e,i=0;i<t.members.length;i++)e=t.members[i],r===e&&this.addVertex(r)}}addVertex(e){this.vertices.add(e)}updateOther(e,t){this.firstRingId===t?this.secondRingId=e:this.firstRingId=e}containsRing(e){return this.firstRingId===e||this.secondRingId===e}isBridge(e){if(2<this.vertices.size)return!0;for(let t of this.vertices)if(2<e[t].value.rings.length)return!0;return!1}static isBridge(e,t,n,r){let o=null;for(let a=0;a<e.length;a++)if(o=e[a],o.firstRingId===n&&o.secondRingId===r||o.firstRingId===r&&o.secondRingId===n)return o.isBridge(t);return!1}static getNeighbours(e,t){let n=[];for(let r,o=0;o<e.length;o++)r=e[o],r.firstRingId===t?n.push(r.secondRingId):r.secondRingId===t&&n.push(r.firstRingId);return n}static getVertices(e,t,n){for(let r,o=0;o<e.length;o++)if(r=e[o],r.firstRingId===t&&r.secondRingId===n||r.firstRingId===n&&r.secondRingId===t)return[...r.vertices]}}},{"./Ring":11,"./Vertex":15}],13:[function(e,t){"use strict";const n=e("./Graph");class r{static getRings(e){let t=e.getComponentsAdjacencyMatrix();if(0===t.length)return null;let o=n.getConnectedComponents(t),a=[];for(var s=0;s<o.length;s++){let t=o[s],i=e.getSubgraphAdjacencyMatrix([...t]),n=new Uint16Array(i.length),l=new Uint16Array(i.length);for(var g=0;g<i.length;g++){l[g]=0,n[g]=0;for(var d=0;d<i[g].length;d++)n[g]+=i[g][d]}let h=0;for(var g=0;g<i.length;g++)for(var d=g+1;d<i.length;d++)h+=i[g][d];let p=h-i.length+1,u=!0;for(var g=0;g<n.length;g++)3!==n[g]&&(u=!1);if(u&&(p=2+h-i.length),1==p){a.push([...t]);continue}let{d:v,pe:f,pe_prime:m}=r.getPathIncludedDistanceMatrices(i),b=r.getRingCandidates(v,f,m),c=r.getSSSR(b,v,i,f,m,n,l,p);for(var g=0;g<c.length;g++){let e=Array(c[g].size),i=0;for(let n of c[g])e[i++]=t[n];a.push(e)}}return a}static matrixToString(e){let t="";for(var n=0;n<e.length;n++){for(var r=0;r<e[n].length;r++)t+=e[n][r]+" ";t+="\n"}return t}static getPathIncludedDistanceMatrices(e){var t=Number.POSITIVE_INFINITY;let r=e.length,o=Array(r),a=Array(r),s=Array(r);for(var g=0,d=0,h=0,c=r;c--;){o[c]=Array(r),a[c]=Array(r),s[c]=Array(r);for(var p=r;p--;)o[c][p]=c===p||1===e[c][p]?e[c][p]:t,a[c][p]=1===o[c][p]?[[[c,p]]]:[],s[c][p]=[]}for(var p,u=r;u--;)for(c=r;c--;)for(p=r;p--;){const e=o[c][p],t=o[c][u]+o[u][p];if(e>t){var g,d,h;if(e===t+1)for(s[c][p]=[a[c][p].length],g=a[c][p].length;g--;)for(s[c][p][g]=[a[c][p][g].length],d=a[c][p][g].length;d--;)for(s[c][p][g][d]=[a[c][p][g][d].length],h=a[c][p][g][d].length;h--;)s[c][p][g][d][h]=[a[c][p][g][d][0],a[c][p][g][d][1]];else s[c][p]=[];for(o[c][p]=t,a[c][p]=[[]],g=a[c][u][0].length;g--;)a[c][p][0].push(a[c][u][0][g]);for(g=a[u][p][0].length;g--;)a[c][p][0].push(a[u][p][0][g])}else if(e===t){if(a[c][u].length&&a[u][p].length){var g;if(a[c][p].length){let e=[];for(g=a[c][u][0].length;g--;)e.push(a[c][u][0][g]);for(g=a[u][p][0].length;g--;)e.push(a[u][p][0][g]);a[c][p].push(e)}else{let e=[];for(g=a[c][u][0].length;g--;)e.push(a[c][u][0][g]);for(g=a[u][p][0].length;g--;)e.push(a[u][p][0][g]);a[c][p][0]=e}}}else if(e===t-1){var g;if(s[c][p].length){let e=[];for(g=a[c][u][0].length;g--;)e.push(a[c][u][0][g]);for(g=a[u][p][0].length;g--;)e.push(a[u][p][0][g]);s[c][p].push(e)}else{let e=[];for(g=a[c][u][0].length;g--;)e.push(a[c][u][0][g]);for(g=a[u][p][0].length;g--;)e.push(a[u][p][0][g]);s[c][p][0]=e}}}return{d:o,pe:a,pe_prime:s}}static getRingCandidates(e,t,n){let r=e.length,o=[],a=0;for(let s=0;s<r;s++)for(let i=0;i<r;i++)if(0===e[s][i]||1===t[s][i].length&&0===n[s][i])continue;else a=0===n[s][i].length?2*e[s][i]:2*(e[s][i]+.5),a!==1/0&&o.push([a,t[s][i],n[s][i]]);return o.sort(function(e,t){return e[0]-t[0]}),o}static getSSSR(e,t,n,o,i,a,s,g){let d=[],l=[];for(let c=0;c<e.length;c++)if(0!=e[c][0]%2)for(let t,i=0;i<e[c][2].length;i++){t=e[c][1][0].concat(e[c][2][i]);for(var h=0;h<t.length;h++)t[h][0].constructor===Array&&(t[h]=t[h][0]);let o=r.bondsToAtoms(t);if(r.getBondCount(o,n)!==o.size||r.pathSetsContain(d,o,t,l,a,s)||(d.push(o),l=l.concat(t)),d.length>g)return d}else for(let t,i=0;i<e[c][1].length-1;i++){t=e[c][1][i].concat(e[c][1][i+1]);for(var h=0;h<t.length;h++)t[h][0].constructor===Array&&(t[h]=t[h][0]);let o=r.bondsToAtoms(t);if(r.getBondCount(o,n)!==o.size||r.pathSetsContain(d,o,t,l,a,s)||(d.push(o),l=l.concat(t)),d.length>g)return d}return d}static getEdgeCount(e){let t=0,n=e.length;for(var r=n-1;r--;)for(var o=n;o--;)1===e[r][o]&&t++;return t}static getEdgeList(e){let t=e.length,n=[];for(var r=t-1;r--;)for(var o=t;o--;)1===e[r][o]&&n.push([r,o]);return n}static bondsToAtoms(e){let t=new Set;for(var n=e.length;n--;)t.add(e[n][0]),t.add(e[n][1]);return t}static getBondCount(e,t){let i=0;for(let n of e)for(let r of e)n!==r&&(i+=t[n][r]);return i/2}static pathSetsContain(e,t,n,o,a,s){for(var g=e.length;g--;){if(r.isSupersetOf(t,e[g]))return!0;if(e[g].size===t.size&&r.areSetsEqual(e[g],t))return!0}let d=0,l=!1;for(g=n.length;g--;)for(var h=o.length;h--;)(n[g][0]===o[h][0]&&n[g][1]===o[h][1]||n[g][1]===o[h][0]&&n[g][0]===o[h][1])&&d++,d===n.length&&(l=!0);let c=!1;if(l)for(let e of t)if(s[e]<a[e]){c=!0;break}if(l&&!c)return!0;for(let i of t)s[i]++;return!1}static areSetsEqual(e,t){if(e.size!==t.size)return!1;for(let i of e)if(!t.has(i))return!1;return!0}static isSupersetOf(e,t){for(var i of t)if(!e.has(i))return!1;return!0}}t.exports=r},{"./Graph":7}],14:[function(e,t){"use strict";var i=Math.acos,n=Math.sin,r=Math.cos,o=Math.sqrt;class g{constructor(e,t){0==arguments.length?(this.x=0,this.y=0):1==arguments.length?(this.x=e.x,this.y=e.y):(this.x=e,this.y=t)}clone(){return new g(this.x,this.y)}toString(){return"("+this.x+","+this.y+")"}add(e){return this.x+=e.x,this.y+=e.y,this}subtract(e){return this.x-=e.x,this.y-=e.y,this}divide(e){return this.x/=e,this.y/=e,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}invert(){return this.x=-this.x,this.y=-this.y,this}angle(){return Math.atan2(this.y,this.x)}distance(e){return o((e.x-this.x)*(e.x-this.x)+(e.y-this.y)*(e.y-this.y))}distanceSq(e){return(e.x-this.x)*(e.x-this.x)+(e.y-this.y)*(e.y-this.y)}clockwise(e){let t=this.y*e.x,i=this.x*e.y;if(t>i)return-1;return t===i?0:1}relativeClockwise(e,t){let i=(this.y-e.y)*(t.x-e.x),n=(this.x-e.x)*(t.y-e.y);if(i>n)return-1;return i===n?0:1}rotate(e){let t=new g(0,0),i=r(e),o=n(e);return t.x=this.x*i-this.y*o,t.y=this.x*o+this.y*i,this.x=t.x,this.y=t.y,this}rotateAround(e,t){let i=n(e),o=r(e);this.x-=t.x,this.y-=t.y;let a=this.x*o-this.y*i,s=this.x*i+this.y*o;return this.x=a+t.x,this.y=s+t.y,this}rotateTo(e,t,i=0){this.x+=.001,this.y-=.001;let n=g.subtract(this,t),r=g.subtract(e,t),o=g.angle(r,n);return this.rotateAround(o+i,t),this}rotateAwayFrom(e,t,i){this.rotateAround(i,t);let n=this.distanceSq(e);this.rotateAround(-2*i,t);let r=this.distanceSq(e);r<n&&this.rotateAround(2*i,t)}getRotateAwayFromAngle(e,t,i){let n=this.clone();n.rotateAround(i,t);let r=n.distanceSq(e);n.rotateAround(-2*i,t);let o=n.distanceSq(e);return o<r?i:-i}getRotateTowardsAngle(e,t,i){let n=this.clone();n.rotateAround(i,t);let r=n.distanceSq(e);n.rotateAround(-2*i,t);let o=n.distanceSq(e);return o>r?i:-i}getRotateToAngle(e,t){let i=g.subtract(this,t),n=g.subtract(e,t),r=g.angle(n,i);return Number.isNaN(r)?0:r}isInPolygon(e){let t=!1;for(let n=0,i=e.length-1;n<e.length;i=n++)e[n].y>this.y!=e[i].y>this.y&&this.x<(e[i].x-e[n].x)*(this.y-e[n].y)/(e[i].y-e[n].y)+e[n].x&&(t=!t);return t}length(){return o(this.x*this.x+this.y*this.y)}lengthSq(){return this.x*this.x+this.y*this.y}normalize(){return this.divide(this.length()),this}normalized(){return g.divideScalar(this,this.length())}whichSide(e,t){return(this.x-e.x)*(t.y-e.y)-(this.y-e.y)*(t.x-e.x)}sameSideAs(e,t,i){let n=this.whichSide(e,t),r=i.whichSide(e,t);return 0>n&&0>r||0==n&&0==r||0<n&&0<r}static add(e,t){return new g(e.x+t.x,e.y+t.y)}static subtract(e,t){return new g(e.x-t.x,e.y-t.y)}static multiply(e,t){return new g(e.x*t.x,e.y*t.y)}static multiplyScalar(e,t){return new g(e.x,e.y).multiplyScalar(t)}static midpoint(e,t){return new g((e.x+t.x)/2,(e.y+t.y)/2)}static normals(e,t){let i=g.subtract(t,e);return[new g(-i.y,i.x),new g(i.y,-i.x)]}static units(e,t){let i=g.subtract(t,e);return[new g(-i.y,i.x).normalize(),new g(i.y,-i.x).normalize()]}static divide(e,t){return new g(e.x/t.x,e.y/t.y)}static divideScalar(e,t){return new g(e.x/t,e.y/t)}static dot(e,t){return e.x*t.x+e.y*t.y}static angle(e,t){let n=g.dot(e,t);return i(n/(e.length()*t.length()))}static threePointangle(e,t,n){let r=g.subtract(t,e),o=g.subtract(n,t),a=e.distance(t),s=t.distance(n);return i(g.dot(r,o)/(a*s))}static scalarProjection(e,t){let i=t.normalized();return g.dot(e,i)}static averageDirection(e){let t=new g(0,0);for(var n=0;n<e.length;n++){let i=e[n];t.add(i)}return t.normalize()}}t.exports=g},{}],15:[function(e,t){"use strict";var i=Math.round,n=Math.PI;const r=e("./MathHelper"),o=e("./ArrayHelper"),a=e("./Vector2"),s=e("./Atom");class g{constructor(e,t=0,i=0){this.id=null,this.value=e,this.position=new a(t?t:0,i?i:0),this.previousPosition=new a(0,0),this.parentVertexId=null,this.children=[],this.spanningTreeChildren=[],this.edges=[],this.positioned=!1,this.angle=null,this.dir=1,this.neighbourCount=0,this.neighbours=[],this.neighbouringElements=[],this.forcePositioned=!1}setPosition(e,t){this.position.x=e,this.position.y=t}setPositionFromVector(e){this.position.x=e.x,this.position.y=e.y}addChild(e){this.children.push(e),this.neighbours.push(e),this.neighbourCount++}addRingbondChild(e,t){if(this.children.push(e),this.value.bracket){let i=1;0===this.id&&0===this.value.bracket.hcount&&(i=0),1===this.value.bracket.hcount&&0===t&&(i=2),1===this.value.bracket.hcount&&1===t&&(3>this.neighbours.length?i=2:i=3),null===this.value.bracket.hcount&&0===t&&(i=1),null===this.value.bracket.hcount&&1===t&&(3>this.neighbours.length?i=1:i=2),this.neighbours.splice(i,0,e)}else this.neighbours.push(e);this.neighbourCount++}setParentVertexId(e){this.neighbourCount++,this.parentVertexId=e,this.neighbours.push(e)}isTerminal(){return!!this.value.hasAttachedPseudoElements||null===this.parentVertexId&&2>this.children.length||0===this.children.length}clone(){let e=new g(this.value,this.position.x,this.position.y);return e.id=this.id,e.previousPosition=new a(this.previousPosition.x,this.previousPosition.y),e.parentVertexId=this.parentVertexId,e.children=o.clone(this.children),e.spanningTreeChildren=o.clone(this.spanningTreeChildren),e.edges=o.clone(this.edges),e.positioned=this.positioned,e.angle=this.angle,e.forcePositioned=this.forcePositioned,e}equals(e){return this.id===e.id}getAngle(e=null,t=!1){let i=null;return i=e?a.subtract(this.position,e):a.subtract(this.position,this.previousPosition),t?r.toDeg(i.angle()):i.angle()}getTextDirection(e){let t=this.getDrawnNeighbours(e),o=[];for(let n=0;n<t.length;n++)o.push(this.getAngle(e[t[n]].position));let a=r.meanAngle(o),s=n/2;return a=i(i(a/s)*s),2===a?"down":-2===a?"up":0===a||-0===a?"right":3===a||-3===a?"left":"down"}getNeighbours(e=null){if(null===e)return this.neighbours.slice();let t=[];for(let n=0;n<this.neighbours.length;n++)this.neighbours[n]!==e&&t.push(this.neighbours[n]);return t}getDrawnNeighbours(e){let t=[];for(let n=0;n<this.neighbours.length;n++)e[this.neighbours[n]].value.isDrawn&&t.push(this.neighbours[n]);return t}getNeighbourCount(){return this.neighbourCount}getSpanningTreeNeighbours(e=null){let t=[];for(let n=0;n<this.spanningTreeChildren.length;n++)(void 0===e||e!=this.spanningTreeChildren[n])&&t.push(this.spanningTreeChildren[n]);return null!=this.parentVertexId&&(void 0===e||e!=this.parentVertexId)&&t.push(this.parentVertexId),t}getNextInRing(e,t,n){let r=this.getNeighbours();for(let a=0;a<r.length;a++)if(o.contains(e[r[a]].value.rings,{value:t})&&r[a]!=n)return r[a];return null}}t.exports=g},{"./ArrayHelper":2,"./Atom":3,"./MathHelper":9,"./Vector2":14}]},{},[1]);
//# sourceMappingURL=smiles-drawer.min.js.map

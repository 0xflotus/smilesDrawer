<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>Smiles Drawer Example</title>
        <meta name="description" content="A minimal smiles drawer example.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
    </head>
    <body>
        <canvas id="example-canvas" width="500" height="500"></canvas>

        <script src="../dist/smiles-drawer.min.js"></script>
        <script src="drugbank.js"></script>
        <script src="schembl.js"></script>
        <script src="gdb17.js"></script>
        <script>
            let options = { compactDrawing: true };
            
            // Initialize the drawer
            let smilesDrawer = new SmilesDrawer.Drawer(options);
            let nErrors = 0;
            let nSuccesses = 0;
            let totalSpeed = 0;
            let totalOverlap = 0;
            let str = 'parsetime,rendertime,overlap,rings,hac,bridged,smiles\n';
            
            let failed = '';
            for (let i = 0; i < drugbank.length; i++) {                
                let td = null;
                let t2 = null;
                let td2 = null;
                let t = performance.now();
                
                SmilesDrawer.parse(drugbank[i], function(tree) {
                    td = performance.now() - t;
                    t2 = performance.now();
                    smilesDrawer.draw(tree, 'example-canvas', 'light', false);
                    td2 = performance.now() - t2;
                }, function(err) {
                    nErrors++;
                    failed += drugbank[i] + '\n';
                });

                if (td2 === null) {
                    continue;
                }

                totalSpeed += td + td2;
                totalOverlap += smilesDrawer.getTotalOverlapScore();
                nSuccesses++;
                str += td + ',' + 
                       td2 + ',' + 
                       smilesDrawer.getTotalOverlapScore() + ',' +
                       smilesDrawer.getRingCount() + ',' + 
                       smilesDrawer.getHeavyAtomCount() + ',' +
                       smilesDrawer.hasBridgedRing() + ',' + drugbank[i] + '\n';
            }

            console.log(str);
            console.log(failed);
            
            console.log('Failed count: ' + nErrors);
            console.log('Success count: ' + nSuccesses);
            console.log('Success rate: ' + (nSuccesses / drugbank.length));
            console.log('Avg speed: ' + totalSpeed / nSuccesses);
            console.log('Avg overlap: ' + totalOverlap / nSuccesses);
        </script>
    </body>
</html>

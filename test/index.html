<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>Smiles Drawer Example</title>
        <meta name="description" content="A minimal smiles drawer example.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
    </head>
    <body>
        <canvas id="example-canvas" width="500" height="500"></canvas>

        <script src="../dist/smiles-drawer.min.js"></script>
        <script src="drugbank.js"></script>
        <script src="schembl.js"></script>
        <script>
            let options = {};
            
            // Initialize the drawer
            let smilesDrawer = new SmilesDrawer(options);
            let nErrors = 0;
            let nSuccesses = 0;
            let totalSpeed = 0;
            let totalOverlap = 0;
            let str = 'parsetime,rendertime,overlap,rings,hac,bridged\n';
            
            let failed = '';
            for (let i = 0; i < drugbank.length; i++) {
                console.log(i);
                try {
                    let t = performance.now();
                    let data = SmilesDrawer.parse(SmilesDrawer.clean(drugbank[i]));
                    let td = performance.now() - t;
                    
                    let t2 = performance.now();
                    smilesDrawer.draw(data, 'example-canvas', 'light', false);
                    let td2 = performance.now() - t2;

                    totalSpeed += td + td2;
                    totalOverlap += smilesDrawer.getTotalOverlapScore();
                    nSuccesses++;

                    str += td + ',' + 
                           td2 + ',' + 
                           smilesDrawer.getTotalOverlapScore() + ',' +
                           smilesDrawer.getRingCount() + ',' + 
                           smilesDrawer.getHeavyAtomCount() + ',' +
                           smilesDrawer.hasBridgedRing() + '\n';
                    
                    // if (td > 1000) console.log(schembl[i]);
                } catch (exception) {
                    nErrors++;
                    failed += drugbank[i] + '\n';
                }
            }

            console.log(str);
            console.log(failed);
            
            console.log('Failed count: ' + nErrors);
            console.log('Success count: ' + nSuccesses);
            console.log('Success rate: ' + (nSuccesses / drugbank.length));
            console.log('Avg speed: ' + totalSpeed / nSuccesses);
            console.log('Avg overlap: ' + totalOverlap / nSuccesses);
        </script>
    </body>
</html>
